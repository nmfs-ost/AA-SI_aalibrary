
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../getting-started/usage/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../assets/noaa_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>AALibrary - AALibrary</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-aalibrary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AALibrary" class="md-header__button md-logo" aria-label="AALibrary" data-md-component="logo">
      
  <img src="../../assets/NOAA-color-logo-no-text-print.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AALibrary
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AALibrary
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AALibrary" class="md-nav__button md-logo" aria-label="AALibrary" data-md-component="logo">
      
  <img src="../../assets/NOAA-color-logo-no-text-print.png" alt="logo">

    </a>
    AALibrary
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/permissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    AALibrary
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    AALibrary
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aalibrary" class="md-nav__link">
    <span class="md-ellipsis">
      aalibrary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.extensions" class="md-nav__link">
    <span class="md-ellipsis">
      extensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names" class="md-nav__link">
    <span class="md-ellipsis">
      ices_ship_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ices_ship_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ices_ship_codes_and_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ices_ship_codes_and_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ices_ship_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ices_ship_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ship_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_ices_code_from_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_ices_code_from_ship_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      ingestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ingestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.check_for_assertion_errors" class="md-nav__link">
    <span class="md-ellipsis">
      check_for_assertion_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_file_from_azure_directory" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_azure_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_netcdf_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_netcdf_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file_from_azure" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file_from_azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_single_file_from_aws" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_file_from_aws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_specific_file_from_azure" class="md-nav__link">
    <span class="md-ellipsis">
      download_specific_file_from_azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_survey_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      download_survey_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.find_and_upload_survey_metadata_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      find_and_upload_survey_metadata_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.find_data_source_for_file" class="md-nav__link">
    <span class="md-ellipsis">
      find_data_source_for_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.upload_file_to_gcp_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcp_storage_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      metadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.create_and_upload_metadata_df" class="md-nav__link">
    <span class="md-ellipsis">
      create_and_upload_metadata_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.create_metadata_json_for_raw_files" class="md-nav__link">
    <span class="md-ellipsis">
      create_metadata_json_for_raw_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.get_metadata_in_df_format" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata_in_df_format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.upload_ncei_metadata_df_to_bigquery" class="md-nav__link">
    <span class="md-ellipsis">
      upload_ncei_metadata_df_to_bigquery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.queries" class="md-nav__link">
    <span class="md-ellipsis">
      queries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.queries.MetadataQueries" class="md-nav__link">
    <span class="md-ellipsis">
      MetadataQueries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../raw_file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RawFile
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/notice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/disclaimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disclaimer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aalibrary" class="md-nav__link">
    <span class="md-ellipsis">
      aalibrary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.extensions" class="md-nav__link">
    <span class="md-ellipsis">
      extensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names" class="md-nav__link">
    <span class="md-ellipsis">
      ices_ship_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ices_ship_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ices_ship_codes_and_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ices_ship_codes_and_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ices_ship_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ices_ship_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_all_ship_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ices_ship_names.get_ices_code_from_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_ices_code_from_ship_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      ingestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ingestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.check_for_assertion_errors" class="md-nav__link">
    <span class="md-ellipsis">
      check_for_assertion_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_file_from_azure_directory" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_azure_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_netcdf_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_netcdf_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file_from_azure" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file_from_azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_raw_file_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      download_raw_file_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_single_file_from_aws" class="md-nav__link">
    <span class="md-ellipsis">
      download_single_file_from_aws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_specific_file_from_azure" class="md-nav__link">
    <span class="md-ellipsis">
      download_specific_file_from_azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.download_survey_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      download_survey_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.find_and_upload_survey_metadata_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      find_and_upload_survey_metadata_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.find_data_source_for_file" class="md-nav__link">
    <span class="md-ellipsis">
      find_data_source_for_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.upload_file_to_gcp_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcp_storage_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.ingestion.upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      metadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.create_and_upload_metadata_df" class="md-nav__link">
    <span class="md-ellipsis">
      create_and_upload_metadata_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.create_metadata_json_for_raw_files" class="md-nav__link">
    <span class="md-ellipsis">
      create_metadata_json_for_raw_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.get_metadata_in_df_format" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata_in_df_format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.metadata.upload_ncei_metadata_df_to_bigquery" class="md-nav__link">
    <span class="md-ellipsis">
      upload_ncei_metadata_df_to_bigquery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.queries" class="md-nav__link">
    <span class="md-ellipsis">
      queries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.queries.MetadataQueries" class="md-nav__link">
    <span class="md-ellipsis">
      MetadataQueries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="documentation-for-aalibrary">Documentation for <code>aalibrary</code></h1>


<div class="doc doc-object doc-module">



<a id="aalibrary"></a>
    <div class="doc doc-contents first">






<p><span class="doc-section-title">Modules:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="config (aalibrary.config)" href="#aalibrary.config">config</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Used for storing environment-specific settings such as database URIs and</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="extensions (aalibrary.extensions)" href="#aalibrary.extensions">extensions</a></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ices_ship_names (aalibrary.ices_ship_names)" href="#aalibrary.ices_ship_names">ices_ship_names</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file contains the code to parse through the ICES API found here:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ingestion (aalibrary.ingestion)" href="#aalibrary.ingestion">ingestion</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This script contains functions used to ingest Active Acoustics data into GCP</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="metadata (aalibrary.metadata)" href="#aalibrary.metadata">metadata</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file contains functions that have to do with metadata.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="queries (aalibrary.queries)" href="#aalibrary.queries">queries</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This script contains classes that have SQL queries used for interaction</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="aalibrary.config" class="doc doc-heading">
            <code>config</code>


</h2>

    <div class="doc doc-contents ">

        <p>Used for storing environment-specific settings such as database URIs and
such.</p>













  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.extensions" class="doc doc-heading">
            <code>extensions</code>


</h2>

    <div class="doc doc-contents ">











    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.ices_ship_names" class="doc doc-heading">
            <code>ices_ship_names</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file contains the code to parse through the ICES API found here:
https://vocab.ices.dk/?ref=315
Specifically the <code>SHIPC</code> platform code which refers to ship names.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ices_ship_codes_and_names(normalize_ship_names=False) (aalibrary.ices_ship_names.get_all_ices_ship_codes_and_names)" href="#aalibrary.ices_ship_names.get_all_ices_ship_codes_and_names">get_all_ices_ship_codes_and_names</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the ices ship codes and their corresponding names in a</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ices_ship_names(normalize_ship_names=False) (aalibrary.ices_ship_names.get_all_ices_ship_names)" href="#aalibrary.ices_ship_names.get_all_ices_ship_names">get_all_ices_ship_names</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the ICES ship names. You can normalize them to our standards</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ship_info() (aalibrary.ices_ship_names.get_all_ship_info)" href="#aalibrary.ices_ship_names.get_all_ship_info">get_all_ship_info</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the ship's info from the following URL:</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_ices_code_from_ship_name(ship_name='', is_normalized=False) (aalibrary.ices_ship_names.get_ices_code_from_ship_name)" href="#aalibrary.ices_ship_names.get_ices_code_from_ship_name">get_ices_code_from_ship_name</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the ICES Code for a ship given a ship's name.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.ices_ship_names.get_all_ices_ship_codes_and_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ices_ship_codes_and_names</span><span class="p">(</span><span class="n">normalize_ship_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the ices ship codes and their corresponding names in a
dictionary format. The keys are the ICES code, and the name is the value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>normalize_ship_names</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to format the
ship name according to our own standards. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dict with all of the ICES ships. The keys are the ICES code,
and the name is the value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ices_ship_names.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ices_ship_codes_and_names</span><span class="p">(</span>
    <span class="n">normalize_ship_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the ices ship codes and their corresponding names in a</span>
<span class="sd">    dictionary format. The keys are the ICES code, and the name is the value.</span>

<span class="sd">    Args:</span>
<span class="sd">        normalize_ship_names (bool, optional): Whether or not to format the</span>
<span class="sd">            ship name according to our own standards. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dict with all of the ICES ships. The keys are the ICES code,</span>
<span class="sd">            and the name is the value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_ship_info</span> <span class="o">=</span> <span class="n">get_all_ship_info</span><span class="p">()</span>
    <span class="n">all_ship_codes_and_names</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ship_info</span> <span class="ow">in</span> <span class="n">all_ship_info</span><span class="p">:</span>
        <span class="n">all_ship_codes_and_names</span><span class="p">[</span><span class="n">ship_info</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ship_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">normalize_ship_names</span><span class="p">:</span>
        <span class="n">all_ship_codes_and_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">code</span><span class="p">:</span> <span class="n">normalize_ship_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_ship_codes_and_names</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">all_ship_codes_and_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ices_ship_names.get_all_ices_ship_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ices_ship_names</span><span class="p">(</span><span class="n">normalize_ship_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the ICES ship names. You can normalize them to our standards
if you wish.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>normalize_ship_names</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to format the
ship name according to our own standards. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>List</code></td>            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list containing strings of all of the ship names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ices_ship_names.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ices_ship_names</span><span class="p">(</span><span class="n">normalize_ship_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the ICES ship names. You can normalize them to our standards</span>
<span class="sd">    if you wish.</span>

<span class="sd">    Args:</span>
<span class="sd">        normalize_ship_names (bool, optional): Whether or not to format the</span>
<span class="sd">            ship name according to our own standards. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List: A list containing strings of all of the ship names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_ship_info</span> <span class="o">=</span> <span class="n">get_all_ship_info</span><span class="p">()</span>
    <span class="n">all_ship_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ship_info</span> <span class="ow">in</span> <span class="n">all_ship_info</span><span class="p">:</span>
        <span class="c1"># Here `ship_info` is a dict</span>
        <span class="n">all_ship_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ship_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">normalize_ship_names</span><span class="p">:</span>
        <span class="n">all_ship_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">normalize_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ship_name</span> <span class="ow">in</span> <span class="n">all_ship_names</span>
        <span class="p">]</span>

    <span class="k">return</span> <span class="n">all_ship_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ices_ship_names.get_all_ship_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ship_info</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the ship's info from the following URL:
https:/vocab.ices.dk/services/api/Code/7f9a91e1-fb57-464a-8eb0-697e4b0235b5</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>List</code></td>            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list with dicts of all the ships, including name, ices code,
uuids and other fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ices_ship_names.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ship_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the ship&#39;s info from the following URL:</span>
<span class="sd">    https:/vocab.ices.dk/services/api/Code/7f9a91e1-fb57-464a-8eb0-697e4b0235b5</span>


<span class="sd">    Returns:</span>
<span class="sd">        List: A list with dicts of all the ships, including name, ices code,</span>
<span class="sd">            uuids and other fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;https://vocab.ices.dk/services/api/Code/&quot;</span>
            <span class="s2">&quot;7f9a91e1-fb57-464a-8eb0-697e4b0235b5&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">all_ship_info</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">all_ship_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ices_ship_names.get_ices_code_from_ship_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ices_code_from_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">is_normalized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the ICES Code for a ship given a ship's name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name string. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_normalized</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the ship name is already
normalized according to aalibrary standards. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ICES Code if one has been found. Empty string if it has not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ices_ship_names.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ices_code_from_ship_name</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">is_normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the ICES Code for a ship given a ship&#39;s name.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship name string. Defaults to &quot;&quot;.</span>
<span class="sd">        is_normalized (bool, optional): Whether or not the ship name is already</span>
<span class="sd">            normalized according to aalibrary standards. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The ICES Code if one has been found. Empty string if it has not.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get all of the ship codes and names.</span>
    <span class="n">all_codes_and_names</span> <span class="o">=</span> <span class="n">get_all_ices_ship_codes_and_names</span><span class="p">(</span>
        <span class="n">normalize_ship_names</span><span class="o">=</span><span class="n">is_normalized</span>
    <span class="p">)</span>
    <span class="c1"># Reverse it to make the ship names the keys.</span>
    <span class="n">all_codes_and_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_codes_and_names</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">valid_ICES_ship_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_codes_and_names</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Try to find the correct ICES code based on the ship name.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">all_codes_and_names</span><span class="p">[</span><span class="n">ship_name</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># Here the ship name does not exactly match any in the ICES DB.</span>
        <span class="c1"># Check for spell check using custom list</span>
        <span class="n">spell_check_list</span> <span class="o">=</span> <span class="n">get_close_matches</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="p">,</span> <span class="n">valid_ICES_ship_names</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.6</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spell_check_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;This `ship_name` </span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2"> does not&quot;</span>
                <span class="s2">&quot; exist in the ICES database. Did you mean one of the&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; following?</span><span class="se">\n</span><span class="si">{</span><span class="n">spell_check_list</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;This `ship_name` </span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2"> does not&quot;</span>
                <span class="s2">&quot; exist in the ICES database. A close match could not be &quot;</span>
                <span class="s2">&quot;found.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.ingestion" class="doc doc-heading">
            <code>ingestion</code>


</h2>

    <div class="doc doc-contents ">

        <p>This script contains functions used to ingest Active Acoustics data into GCP
from various sources such as AWS buckets and Azure Data Lake.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="check_for_assertion_errors(**kwargs) (aalibrary.ingestion.check_for_assertion_errors)" href="#aalibrary.ingestion.check_for_assertion_errors">check_for_assertion_errors</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Checks for errors in the kwargs provided.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_file_from_azure_directory(directory_client, file_system='testcontainer', download_directory='./', file_path='') (aalibrary.ingestion.download_file_from_azure_directory)" href="#aalibrary.ingestion.download_file_from_azure_directory">download_file_from_azure_directory</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Downloads a single file from an azure directory using the</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_netcdf_file(raw_file_name='', file_type='netcdf', ship_name='', survey_name='', echosounder='', file_download_directory='', gcp_bucket=None, is_metadata=False, debug=False) (aalibrary.ingestion.download_netcdf_file)" href="#aalibrary.ingestion.download_netcdf_file">download_netcdf_file</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_raw_file(file_name='', file_type='raw', ship_name='', survey_name='', echosounder='', data_source='', file_download_directory='.', is_metadata=False, debug=False) (aalibrary.ingestion.download_raw_file)" href="#aalibrary.ingestion.download_raw_file">download_raw_file</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_raw_file_from_azure(file_name='', file_type='raw', ship_name='', survey_name='', echosounder='', data_source='OMAO', file_download_directory='.', config_file_path='', is_metadata=False, upload_to_gcp=False, debug=False) (aalibrary.ingestion.download_raw_file_from_azure)" href="#aalibrary.ingestion.download_raw_file_from_azure">download_raw_file_from_azure</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_raw_file_from_ncei(file_name='', file_type='raw', ship_name='', survey_name='', echosounder='', data_source='NCEI', file_download_directory='.', is_metadata=False, upload_to_gcp=False, debug=False) (aalibrary.ingestion.download_raw_file_from_ncei)" href="#aalibrary.ingestion.download_raw_file_from_ncei">download_raw_file_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_single_file_from_aws(file_url='', download_location='') (aalibrary.ingestion.download_single_file_from_aws)" href="#aalibrary.ingestion.download_single_file_from_aws">download_single_file_from_aws</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Safely downloads a file from AWS storage bucket, aka the NCEI</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_specific_file_from_azure(config_file_path='', container_name='testcontainer', file_path_in_container='') (aalibrary.ingestion.download_specific_file_from_azure)" href="#aalibrary.ingestion.download_specific_file_from_azure">download_specific_file_from_azure</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a DataLakeFileClient and downloads a specific file from</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_survey_from_ncei(ship_name='', survey_name='', echosounder='', data_source='NCEI', file_download_directory='.', is_metadata=False, upload_to_gcp=False, debug=False) (aalibrary.ingestion.download_survey_from_ncei)" href="#aalibrary.ingestion.download_survey_from_ncei">download_survey_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="find_and_upload_survey_metadata_from_s3(ship_name='', survey_name='', debug=False) (aalibrary.ingestion.find_and_upload_survey_metadata_from_s3)" href="#aalibrary.ingestion.find_and_upload_survey_metadata_from_s3">find_and_upload_survey_metadata_from_s3</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Finds the metadata that is associated with a particular survey in s3,</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="find_data_source_for_file() (aalibrary.ingestion.find_data_source_for_file)" href="#aalibrary.ingestion.find_data_source_for_file">find_data_source_for_file</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Finds the data source of a given filename by checking all possible data</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="upload_file_to_gcp_storage_bucket(file_name='', file_type='', ship_name='', survey_name='', echosounder='', file_location='', gcp_bucket=None, data_source='', is_metadata=False, is_survey_metadata=False, debug=False) (aalibrary.ingestion.upload_file_to_gcp_storage_bucket)" href="#aalibrary.ingestion.upload_file_to_gcp_storage_bucket">upload_file_to_gcp_storage_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Safely uploads a local file to the storage bucket. Will also check to</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket(directory='', ship_name='', survey_name='', echosounder='', data_source='', gcp_bucket=None, debug=False) (aalibrary.ingestion.upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket)" href="#aalibrary.ingestion.upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket">upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>ENTRYPOINT FOR END-USERS</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.check_for_assertion_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_for_assertion_errors</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks for errors in the kwargs provided.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_for_assertion_errors</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks for errors in the kwargs provided.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;file_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid file name with the file extension&quot;</span>
            <span class="s2">&quot; (ex. `2107RL_CW-D20210813-T220732.raw`)&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;file_type&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file_type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Please provide a valid file type.&quot;</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file_type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">VALID_FILETYPES</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid file type (extension) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;from the following: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">VALID_FILETYPES</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ship_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ship_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid ship name &quot;</span>
            <span class="s2">&quot;(Title_Case_With_Underscores_As_Spaces).&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;survey_name&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;survey_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;Please provide a valid survey name.&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;echosounder&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;echosounder&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;Please provide a valid echosounder.&quot;</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;echosounder&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">VALID_ECHOSOUNDERS</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid echosounder from the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;following: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">VALID_ECHOSOUNDERS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;data_source&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid data source from the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;following: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">VALID_DATA_SOURCES</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;data_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">VALID_DATA_SOURCES</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a valid data source from the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;following: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">VALID_DATA_SOURCES</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;file_download_directory&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file_download_directory&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;Please provide a valid file download directory.&quot;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file_download_directory&quot;</span><span class="p">]),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File download location `</span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_download_directory&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">` is&quot;</span>
            <span class="s2">&quot; not found to be a valid dir, please reformat it.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;gcp_bucket&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;gcp_bucket&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Please provide a gcp_bucket object with&quot;</span>
            <span class="s2">&quot; `utils.cloud_utils.setup_gcp_storage()`&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Please provide a valid directory.&quot;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Directory location `</span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">` is not found to be a&quot;</span>
            <span class="s2">&quot; valid dir, please reformat it.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;data_lake_directory_client&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;data_lake_directory_client&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The data lake directory client cannot be a&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data_lake_directory_client&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> object. It needs &quot;</span>
            <span class="s2">&quot;to be of the type `DataLakeDirectoryClient`.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_file_from_azure_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file_from_azure_directory</span><span class="p">(</span><span class="n">directory_client</span><span class="p">,</span> <span class="n">file_system</span><span class="o">=</span><span class="s1">&#39;testcontainer&#39;</span><span class="p">,</span> <span class="n">download_directory</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Downloads a single file from an azure directory using the
DataLakeDirectoryClient. Useful for numerous operations, as authentication
is only required once for the creation of each DataLakeDirectoryClient.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory_client</code>
            </td>
            <td>
                  <code><span title="azure.storage.filedatalake.DataLakeDirectoryClient">DataLakeDirectoryClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The
DataLakeDirectoryClient that will be used to connect to a
download from an azure file system in the data lake.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_system</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file system (container) you wish to download
your file from. Defaults to "testcontainer" for testing purposes.</p>
              </div>
            </td>
            <td>
                  <code>&#39;testcontainer&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local directory you want to download to.
Defaults to "./".</p>
              </div>
            </td>
            <td>
                  <code>&#39;./&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path you want to download.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_file_from_azure_directory</span><span class="p">(</span>
    <span class="n">directory_client</span><span class="p">:</span> <span class="n">DataLakeDirectoryClient</span><span class="p">,</span>
    <span class="n">file_system</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;testcontainer&quot;</span><span class="p">,</span>
    <span class="n">download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads a single file from an azure directory using the</span>
<span class="sd">    DataLakeDirectoryClient. Useful for numerous operations, as authentication</span>
<span class="sd">    is only required once for the creation of each DataLakeDirectoryClient.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory_client (DataLakeDirectoryClient): The</span>
<span class="sd">            DataLakeDirectoryClient that will be used to connect to a</span>
<span class="sd">            download from an azure file system in the data lake.</span>
<span class="sd">        file_system (str): The file system (container) you wish to download</span>
<span class="sd">            your file from. Defaults to &quot;testcontainer&quot; for testing purposes.</span>
<span class="sd">        download_directory (str): The local directory you want to download to.</span>
<span class="sd">            Defaults to &quot;./&quot;.</span>
<span class="sd">        file_path (str): The file path you want to download.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># User-error-checking</span>
    <span class="n">check_for_assertion_errors</span><span class="p">(</span>
        <span class="n">data_lake_directory_client</span><span class="o">=</span><span class="n">directory_client</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">download_directory</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">file_client</span> <span class="o">=</span> <span class="n">directory_client</span><span class="o">.</span><span class="n">get_file_client</span><span class="p">(</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_system</span><span class="o">=</span><span class="n">file_system</span>
    <span class="p">)</span>

    <span class="n">download_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">download_directory</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">download_directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">]),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
        <span class="n">download</span> <span class="o">=</span> <span class="n">file_client</span><span class="o">.</span><span class="n">download_file</span><span class="p">()</span>
        <span class="n">local_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">download</span><span class="o">.</span><span class="n">readall</span><span class="p">())</span>
        <span class="n">local_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_netcdf_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_netcdf_file</span><span class="p">(</span><span class="n">raw_file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;netcdf&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_download_directory</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS
Downloads a netcdf file from GCP storage bucket for use on your
workstation.
Works as follows:
    1. Checks if the exact netcdf exists in gcp.
        a. If it doesn't exists, prompts user to download it first.
        b. If it exists, downloads to the <code>file_download_directory</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raw_file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "netcdf".</p>
              </div>
            </td>
            <td>
                  <code>&#39;netcdf&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local directory you want
to store your file in. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP bucket object
used to download the file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_netcdf_file</span><span class="p">(</span>
    <span class="n">raw_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>
<span class="sd">    Downloads a netcdf file from GCP storage bucket for use on your</span>
<span class="sd">    workstation.</span>
<span class="sd">    Works as follows:</span>
<span class="sd">        1. Checks if the exact netcdf exists in gcp.</span>
<span class="sd">            a. If it doesn&#39;t exists, prompts user to download it first.</span>
<span class="sd">            b. If it exists, downloads to the `file_download_directory`.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_file_name (str, optional): The raw file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;netcdf&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_download_directory (str, optional): The local directory you want</span>
<span class="sd">            to store your file in. Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP bucket object</span>
<span class="sd">            used to download the file. Defaults to None.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RawFile</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">raw_file_name</span><span class="p">,</span>
        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">netcdf_file_exists_in_gcp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;NETCDF FILE LOCATED IN GCP&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;: `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">netcdf_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">DOWNLOADING...&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">download_file_from_gcp</span><span class="p">(</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">blob_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">netcdf_gcp_storage_bucket_location</span><span class="p">,</span>
            <span class="n">local_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">netcdf_file_download_path</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;FILE `</span><span class="si">{</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` DOWNLOADED &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;TO `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">netcdf_file_download_path</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;NETCDF FILE `</span><span class="si">{</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` DOES NOT EXIST IN GCP AT THE&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; LOCATION: `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">netcdf_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;PLEASE CONVERT AND UPLOAD THE RAW FILE FIRST VIA&quot;</span>
                <span class="s2">&quot; `download_raw_file`.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_raw_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_raw_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_download_directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS
Downloads a raw and idx file from NCEI for use on your workstation.
Works as follows:
    1. Checks if raw file exists in GCP.
        a. If it exists,
            checks if a netcdf version also exists or not
            lets the user know.
            i. If <code>force_download_from_ncei</code> is True
                downloads the raw and idx file from NCEI instead.
        b. If it doesn't exist,
            downloads .raw from NCEI and uploads to GCP for caching
            downloads .idx from NCEI and uploads to GCP for caching</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the file. Necessary due to
the way the storage bucket is organized. Can be one of
["NCEI", "OMAO", "HDD"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local file directory you
want to store your file in. Defaults to current directory.
Defaults to ".".</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_raw_file</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>
<span class="sd">    Downloads a raw and idx file from NCEI for use on your workstation.</span>
<span class="sd">    Works as follows:</span>
<span class="sd">        1. Checks if raw file exists in GCP.</span>
<span class="sd">            a. If it exists,</span>
<span class="sd">                checks if a netcdf version also exists or not</span>
<span class="sd">                lets the user know.</span>
<span class="sd">                i. If `force_download_from_ncei` is True</span>
<span class="sd">                    downloads the raw and idx file from NCEI instead.</span>
<span class="sd">            b. If it doesn&#39;t exist,</span>
<span class="sd">                downloads .raw from NCEI and uploads to GCP for caching</span>
<span class="sd">                downloads .idx from NCEI and uploads to GCP for caching</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the file. Necessary due to</span>
<span class="sd">            the way the storage bucket is organized. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        file_download_directory (str, optional): The local file directory you</span>
<span class="sd">            want to store your file in. Defaults to current directory.</span>
<span class="sd">            Defaults to &quot;.&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">setup_gcp_storage_objs</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RawFile</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_gcp</span><span class="p">:</span>
        <span class="c1"># Inform user if file exists in GCP.</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` ALREADY EXISTS IN&quot;</span>
            <span class="s2">&quot; GOOGLE STORAGE BUCKET.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Here we download the raw file from GCP. We also check for a netcdf</span>
        <span class="c1"># version and let the user know.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CHECKING FOR NETCDF VERSION...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">netcdf_file_exists_in_gcp</span><span class="p">:</span>
            <span class="c1"># Inform the user if a netcdf version exists in cache.</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` EXISTS AS A NETCDF ALREADY.&quot;</span>
                    <span class="s2">&quot; PLEASE DOWNLOAD THE NETCDF VERSION IF NEEDED.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` DOES NOT EXIST AS NETCDF.&quot;</span>
                    <span class="s2">&quot; CONSIDER RUNNING A CONVERSION FUNCTION&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Here we download the raw from GCP.</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;DOWNLOADING FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2">` FROM GCP TO&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_download_path</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">download_file_from_gcp</span><span class="p">(</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">blob_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_gcp_storage_bucket_location</span><span class="p">,</span>
            <span class="n">local_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_download_path</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DOWNLOADED.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_ncei</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_gcp</span>
    <span class="p">):</span>  <span class="c1"># File does not exist in gcp and needs to be downloaded from NCEI</span>
        <span class="n">download_raw_file_from_ncei</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="p">,</span>
            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">echosounder</span><span class="p">,</span>
            <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
            <span class="n">file_download_directory</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">file_download_directory</span><span class="p">,</span>
            <span class="n">is_metadata</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">is_metadata</span><span class="p">,</span>
            <span class="n">upload_to_gcp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Checking to make sure the idx exists in GCP...</span>
    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_gcp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CORRESPONDING IDX FILE FOUND IN GCP. DOWNLOADING...&quot;</span><span class="p">)</span>
        <span class="c1"># Here we download the idx from GCP.</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;DOWNLOADING FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_name</span><span class="si">}</span><span class="s2">` FROM GCP TO &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">download_file_from_gcp</span><span class="p">(</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">blob_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_gcp_storage_bucket_location</span><span class="p">,</span>
            <span class="n">local_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DOWNLOADED.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_ncei</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_gcp</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;CORRESPONDING IDX FILE NOT FOUND IN GCP.&quot;</span>
                <span class="s2">&quot; DOWNLOADING FROM NCEI AND UPLOADING TO GCP...&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Safely download and upload the idx file.</span>
        <span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_ncei_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Upload to GCP at the correct storage bucket location.</span>
        <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_name</span><span class="p">,</span>
            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;idx&quot;</span><span class="p">,</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">echosounder</span><span class="p">,</span>
            <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
            <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Checking to make sure the bot exists in GCP...</span>
    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_gcp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CORRESPONDING BOT FILE FOUND IN GCP. DOWNLOADING...&quot;</span><span class="p">)</span>
        <span class="c1"># Here we download the bot from GCP.</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;DOWNLOADING FILE `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_name</span><span class="si">}</span><span class="s2">` FROM GCP&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; TO `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="si">}</span><span class="s2">`&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">download_file_from_gcp</span><span class="p">(</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">blob_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_gcp_storage_bucket_location</span><span class="p">,</span>
            <span class="n">local_file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DOWNLOADED.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_ncei</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_gcp</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;CORRESPONDING BOT FILE NOT FOUND IN GCP. TRYING TO &quot;</span>
                <span class="s2">&quot;DOWNLOAD FROM NCEI AND UPLOADING TO GCP...&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Safely download and upload the bot file.</span>
        <span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_ncei_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Upload to GCP at the correct storage bucket location.</span>
        <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_name</span><span class="p">,</span>
            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">echosounder</span><span class="p">,</span>
            <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
            <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_raw_file_from_azure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_raw_file_from_azure</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;OMAO&#39;</span><span class="p">,</span> <span class="n">file_download_directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">config_file_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">upload_to_gcp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the file. Necessary due to
the way the storage bucket is organized. Can be one of
["NCEI", "OMAO", "HDD"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;OMAO&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local directory you want
to store your file in. Defaults to current directory. Defaults
to ".".</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The location of the config file.
Needs a <code>[DEFAULT]</code> section with a <code>azure_connection_string</code>
variable defined. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upload_to_gcp</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want to upload to
GCP. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_raw_file_from_azure</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;OMAO&quot;</span><span class="p">,</span>
    <span class="n">file_download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">config_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">upload_to_gcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the file. Necessary due to</span>
<span class="sd">            the way the storage bucket is organized. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        file_download_directory (str, optional): The local directory you want</span>
<span class="sd">            to store your file in. Defaults to current directory. Defaults</span>
<span class="sd">            to &quot;.&quot;.</span>
<span class="sd">        config_file_path (str, optional): The location of the config file.</span>
<span class="sd">            Needs a `[DEFAULT]` section with a `azure_connection_string`</span>
<span class="sd">            variable defined. Defaults to &quot;&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        upload_to_gcp (bool, optional): Whether or not you want to upload to</span>
<span class="sd">            GCP. Defaults to False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create gcp bucket objects</span>
    <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">setup_gcp_storage_objs</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CANNOT ESTABLISH CONNECTION TO S3 BUCKET..</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RawFile</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
        <span class="n">upload_to_gcp</span><span class="o">=</span><span class="n">upload_to_gcp</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Location of temporary file in sandbox environment.</span>
    <span class="c1"># https://contracttest4.blob.core.windows.net/testcontainer/Reuben_Lasker/RL_1601/EK_60/1601RL-D20160107-T074016.bot</span>

    <span class="c1"># Create Azure Directory Client</span>
    <span class="n">azure_datalake_directory_client</span> <span class="o">=</span> <span class="n">get_data_lake_directory_client</span><span class="p">(</span>
        <span class="n">config_file_path</span><span class="o">=</span><span class="n">config_file_path</span>
    <span class="p">)</span>

    <span class="c1"># TODO: check to see if you want to download from gcp instead.</span>

    <span class="c1"># TODO: add if statement to check if the file exists in azure or not.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOWNLOADING FILE </span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="si">}</span><span class="s2"> FROM OMAO&quot;</span><span class="p">)</span>
    <span class="n">download_file_from_azure_directory</span><span class="p">(</span>
        <span class="n">directory_client</span><span class="o">=</span><span class="n">azure_datalake_directory_client</span><span class="p">,</span>
        <span class="n">download_directory</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_omao_file_path</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Force download the idx file.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOWNLOADING IDX FILE </span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_name</span><span class="si">}</span><span class="s2"> FROM OMAO&quot;</span><span class="p">)</span>
    <span class="n">download_file_from_azure_directory</span><span class="p">(</span>
        <span class="n">directory_client</span><span class="o">=</span><span class="n">azure_datalake_directory_client</span><span class="p">,</span>
        <span class="n">download_directory</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_omao_file_path</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Force download the bot file.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOWNLOADING BOT FILE </span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_name</span><span class="si">}</span><span class="s2"> FROM OMAO&quot;</span><span class="p">)</span>
    <span class="n">download_file_from_azure_directory</span><span class="p">(</span>
        <span class="n">directory_client</span><span class="o">=</span><span class="n">azure_datalake_directory_client</span><span class="p">,</span>
        <span class="n">download_directory</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_omao_file_path</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">upload_to_gcp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;RAW FILE ALREADY EXISTS IN GCP AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO: try out a background process if possible -- file might</span>
            <span class="c1"># have a lock. only async options, otherwise subprocess gsutil to</span>
            <span class="c1"># upload it.</span>
            <span class="c1"># Upload raw to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Upload the metadata file as well.</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">create_and_upload_metadata_df</span><span class="p">(</span>
                <span class="n">rf</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;IDX FILE ALREADY EXISTS IN GCP AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload idx to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;BOT FILE ALREADY EXISTS IN GCP AT&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload bot to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_raw_file_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_raw_file_from_ncei</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;NCEI&#39;</span><span class="p">,</span> <span class="n">file_download_directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">upload_to_gcp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS
Downloads a raw, idx, and bot file from NCEI. If <code>upload_to_gcp</code> is
enabled, the downloaded files will also upload to the GCP storage bucket
if they do not exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the file. Necessary due to
the way the storage bucket is organized. Can be one of
["NCEI", "OMAO", "HDD"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;NCEI&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local file directory you
want to store your file in. Defaults to current directory.
Defaults to ".".</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upload_to_gcp</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want to upload to
GCP. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_raw_file_from_ncei</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NCEI&quot;</span><span class="p">,</span>
    <span class="n">file_download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">upload_to_gcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>
<span class="sd">    Downloads a raw, idx, and bot file from NCEI. If `upload_to_gcp` is</span>
<span class="sd">    enabled, the downloaded files will also upload to the GCP storage bucket</span>
<span class="sd">    if they do not exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the file. Necessary due to</span>
<span class="sd">            the way the storage bucket is organized. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        file_download_directory (str, optional): The local file directory you</span>
<span class="sd">            want to store your file in. Defaults to current directory.</span>
<span class="sd">            Defaults to &quot;.&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        upload_to_gcp (bool, optional): Whether or not you want to upload to</span>
<span class="sd">            GCP. Defaults to False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">setup_gcp_storage_objs</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CANNOT ESTABLISH CONNECTION TO S3 BUCKET..</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RawFile</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
        <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
        <span class="n">upload_to_gcp</span><span class="o">=</span><span class="n">upload_to_gcp</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_ncei</span><span class="p">:</span>
        <span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_ncei_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_download_path</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_ncei</span><span class="p">:</span>
        <span class="c1"># Force download the idx file.</span>
        <span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_ncei_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_ncei</span><span class="p">:</span>
        <span class="c1"># Force download the bot file.</span>
        <span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_ncei_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">upload_to_gcp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;RAW FILE ALREADY EXISTS IN GCP AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO: try out a background process if possible -- file might</span>
            <span class="c1"># have a lock. only async options, otherwise subprocess gsutil to</span>
            <span class="c1"># upload it.</span>

            <span class="c1"># Upload raw to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">raw_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Upload the metadata file as well.</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">create_and_upload_metadata_df</span><span class="p">(</span>
                <span class="n">rf</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;IDX FILE ALREADY EXISTS IN GCP AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_ncei</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf</span><span class="o">.</span><span class="n">idx_file_exists_in_gcp</span><span class="p">):</span>
            <span class="c1"># Upload idx to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;idx&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">idx_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_gcp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;BOT FILE ALREADY EXISTS IN GCP AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_ncei</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf</span><span class="o">.</span><span class="n">bot_file_exists_in_gcp</span><span class="p">):</span>
            <span class="c1"># Upload bot to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">bot_file_download_path</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_single_file_from_aws" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_single_file_from_aws</span><span class="p">(</span><span class="n">file_url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">download_location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Safely downloads a file from AWS storage bucket, aka the NCEI
repository.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file url. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>download_location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local download location for the
file. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_single_file_from_aws</span><span class="p">(</span>
    <span class="n">file_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Safely downloads a file from AWS storage bucket, aka the NCEI</span>
<span class="sd">    repository.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_url (str, optional): The file url. Defaults to &quot;&quot;.</span>
<span class="sd">        download_location (str, optional): The local download location for the</span>
<span class="sd">            file. Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CANNOT ESTABLISH CONNECTION TO S3 BUCKET..</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="c1"># We replace the beginning of common file paths</span>
    <span class="n">file_url</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">get_object_key_for_s3</span><span class="p">(</span><span class="n">file_url</span><span class="o">=</span><span class="n">file_url</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_file_name_from_url</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>

    <span class="c1"># Check if the file exists in s3</span>
    <span class="n">file_exists</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_s3</span><span class="p">(</span>
        <span class="n">object_key</span><span class="o">=</span><span class="n">file_url</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
        <span class="n">s3_bucket_name</span><span class="o">=</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
        <span class="c1"># Finally download the file.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOWNLOADING `</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">`...&quot;</span><span class="p">)</span>
            <span class="n">s3_bucket</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">download_location</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DOWNLOADED `</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">` TO `</span><span class="si">{</span><span class="n">download_location</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR DOWNLOADING FILE `</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">` DUE TO</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> DOES NOT EXIST IN NCEI S3 BUCKET. SKIPPING...&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_specific_file_from_azure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_specific_file_from_azure</span><span class="p">(</span><span class="n">config_file_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">container_name</span><span class="o">=</span><span class="s1">&#39;testcontainer&#39;</span><span class="p">,</span> <span class="n">file_path_in_container</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a DataLakeFileClient and downloads a specific file from
<code>container_name</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The location of the config file.
Needs a <code>[DEFAULT]</code> section with a <code>azure_connection_string</code>
variable defined. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>container_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The container within Azure Data Lake
you are trying to access. Defaults to "testcontainer".</p>
              </div>
            </td>
            <td>
                  <code>&#39;testcontainer&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_path_in_container</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path of the file you
would like downloaded. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_specific_file_from_azure</span><span class="p">(</span>
    <span class="n">config_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;testcontainer&quot;</span><span class="p">,</span>
    <span class="n">file_path_in_container</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a DataLakeFileClient and downloads a specific file from</span>
<span class="sd">    `container_name`.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file_path (str, optional): The location of the config file.</span>
<span class="sd">            Needs a `[DEFAULT]` section with a `azure_connection_string`</span>
<span class="sd">            variable defined. Defaults to &quot;&quot;.</span>
<span class="sd">        container_name (str, optional): The container within Azure Data Lake</span>
<span class="sd">            you are trying to access. Defaults to &quot;testcontainer&quot;.</span>
<span class="sd">        file_path_in_container (str, optional): The file path of the file you</span>
<span class="sd">            would like downloaded. Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">)</span>

    <span class="n">file</span> <span class="o">=</span> <span class="n">DataLakeFileClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">][</span><span class="s2">&quot;azure_connection_string&quot;</span><span class="p">],</span>
        <span class="n">file_system_name</span><span class="o">=</span><span class="n">container_name</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">file_path_in_container</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_path_in_container</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
        <span class="n">download</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">download_file</span><span class="p">()</span>
        <span class="n">download</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.download_survey_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_survey_from_ncei</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;NCEI&#39;</span><span class="p">,</span> <span class="n">file_download_directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">upload_to_gcp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS
Downloads the raw, idx, and bot files from a survey from NCEI. If
<code>upload_to_gcp</code> is enabled, the downloaded files will also upload to the
GCP storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the file. Necessary due to
the way the storage bucket is organized. Can be one of
["NCEI", "OMAO", "HDD"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;NCEI&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_download_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local file directory you
want to store your file in. Defaults to current directory.
Defaults to ".".</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upload_to_gcp</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want to upload to
GCP. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_survey_from_ncei</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NCEI&quot;</span><span class="p">,</span>
    <span class="n">file_download_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">upload_to_gcp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>
<span class="sd">    Downloads the raw, idx, and bot files from a survey from NCEI. If</span>
<span class="sd">    `upload_to_gcp` is enabled, the downloaded files will also upload to the</span>
<span class="sd">    GCP storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the file. Necessary due to</span>
<span class="sd">            the way the storage bucket is organized. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        file_download_directory (str, optional): The local file directory you</span>
<span class="sd">            want to store your file in. Defaults to current directory.</span>
<span class="sd">            Defaults to &quot;.&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        upload_to_gcp (bool, optional): Whether or not you want to upload to</span>
<span class="sd">            GCP. Defaults to False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: convert to using RawFile object.</span>

    <span class="c1"># User-error-checking</span>
    <span class="n">check_for_assertion_errors</span><span class="p">(</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create the download directory (path) if it doesn&#39;t exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_download_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">file_download_directory</span><span class="p">)</span>

    <span class="c1"># Get all raw file names associated with this survey from NCEI.</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">survey_file_names</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="c1"># Filter out only the raw files (the download function takes care of</span>
    <span class="c1"># downloading the idx and bot files).</span>
    <span class="n">survey_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">survey_file_names</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.raw&quot;</span><span class="p">)]</span>

    <span class="c1"># Download/upload each file, one by one.</span>
    <span class="k">for</span> <span class="n">survey_file_name</span> <span class="ow">in</span> <span class="n">survey_file_names</span><span class="p">:</span>
        <span class="n">download_raw_file_from_ncei</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">survey_file_name</span><span class="p">,</span>
            <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
            <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;NCEI&quot;</span><span class="p">,</span>
            <span class="n">file_download_directory</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
            <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">upload_to_gcp</span><span class="o">=</span><span class="n">upload_to_gcp</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.find_and_upload_survey_metadata_from_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_and_upload_survey_metadata_from_s3</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Finds the metadata that is associated with a particular survey in s3,
then uploads all of those files into the correct gcp location.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_and_upload_survey_metadata_from_s3</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the metadata that is associated with a particular survey in s3,</span>
<span class="sd">    then uploads all of those files into the correct gcp location.&quot;&quot;&quot;</span>

    <span class="n">metadata_location_in_s3</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">create_s3_objs</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CANNOT ESTABLISH CONNECTION TO S3 BUCKET..</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">num_metadata_objects</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">count_objects_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">metadata_location_in_s3</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">s3_bucket</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_metadata_objects</span><span class="si">}</span><span class="s2"> FOUND IN S3 FOR </span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2"> -&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">num_metadata_objects</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Get object keys</span>
        <span class="n">s3_objects</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">metadata_location_in_s3</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_bucket</span>
        <span class="p">)</span>
        <span class="c1"># Download and upload each object</span>
        <span class="k">for</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">s3_objects</span><span class="p">:</span>
            <span class="c1"># Get the correct full file download location</span>
            <span class="n">file_download_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">),</span> <span class="n">file_name</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># Download from aws</span>
            <span class="n">download_single_file_from_aws</span><span class="p">(</span>
                <span class="n">file_url</span><span class="o">=</span><span class="n">full_path</span><span class="p">,</span> <span class="n">download_location</span><span class="o">=</span><span class="n">file_download_directory</span>
            <span class="p">)</span>
            <span class="c1"># Upload to gcp</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">file_download_directory</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;NCEI&quot;</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">is_survey_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Remove local file (it&#39;s temporary)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_download_directory</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.find_data_source_for_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_data_source_for_file</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Finds the data source of a given filename by checking all possible data
sources.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_data_source_for_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the data source of a given filename by checking all possible data</span>
<span class="sd">    sources.&quot;&quot;&quot;</span>
    <span class="c1"># TODO:</span>
    <span class="c1"># Check HDD storage bucket on GCP</span>
    <span class="c1"># Check NCEI S3 bucket.</span>
    <span class="c1"># TODO: Check OMAO Data Lake</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.upload_file_to_gcp_storage_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_survey_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Safely uploads a local file to the storage bucket. Will also check to
see if the file already exists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local location of the file.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP bucket object
used to upload the file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the data. Can be one of
["NCEI", "OMAO", "HDD", "TEST"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_survey_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a
metadata file associated with a survey. The files are stored at
the survey level, in the <code>metadata/</code> folder. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">is_survey_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Safely uploads a local file to the storage bucket. Will also check to</span>
<span class="sd">    see if the file already exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_location (str, optional): The local location of the file.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP bucket object</span>
<span class="sd">            used to upload the file. Defaults to None.</span>
<span class="sd">        data_source (str, optional): The source of the data. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;, &quot;TEST&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        is_survey_metadata (bool, optional): Whether or not the file is a</span>
<span class="sd">            metadata file associated with a survey. The files are stored at</span>
<span class="sd">            the survey level, in the `metadata/` folder. Defaults to False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">helpers</span><span class="o">.</span><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
            <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
            <span class="n">is_metadata</span><span class="o">=</span><span class="n">is_metadata</span><span class="p">,</span>
            <span class="n">is_survey_metadata</span><span class="o">=</span><span class="n">is_survey_metadata</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Check if the file exists in GCP</span>
    <span class="n">file_exists_in_gcp</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span>
        <span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">file_exists_in_gcp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;FILE `</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">` ALREADY EXISTS IN GCP AT &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;UPLOADING FILE `</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">` TO GCP AT&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`...&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Upload to storage bucket.</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">cloud_utils</span><span class="o">.</span><span class="n">upload_file_to_gcp_bucket</span><span class="p">(</span>
                <span class="n">bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">blob_file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span><span class="p">,</span>
                <span class="n">local_file_path</span><span class="o">=</span><span class="n">file_location</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPLOADED.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;COULD NOT UPLOAD FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> TO GCP &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">) STORAGE BUCKET DUE TO &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;THE FOLLOWING ERROR:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.ingestion.upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ENTRYPOINT FOR END-USERS
Uploads all of the .raw (and their corresponding .idx) files from a
directory into the appropriate location in the GCP storage bucket.
NOTE: Assumes that all files share the same metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory which contains all of the
files you want to upload. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the file. Necessary due to
the way the storage bucket is organized. Can be one of
["NCEI", "OMAO", "HDD"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP bucket object
used to download the file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/ingestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_local_raw_and_idx_files_from_directory_to_gcp_storage_bucket</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ENTRYPOINT FOR END-USERS</span>
<span class="sd">    Uploads all of the .raw (and their corresponding .idx) files from a</span>
<span class="sd">    directory into the appropriate location in the GCP storage bucket.</span>
<span class="sd">    NOTE: Assumes that all files share the same metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (str, optional): The directory which contains all of the</span>
<span class="sd">            files you want to upload. Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the file. Necessary due to</span>
<span class="sd">            the way the storage bucket is organized. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;, &quot;HDD&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP bucket object</span>
<span class="sd">            used to download the file. Defaults to None.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: see if you can convert to using RawFile object.</span>

    <span class="c1"># Warn user that this function assumes the same metadata for all files</span>
    <span class="c1"># within directory.</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;WARNING: THIS FUNCTION ASSUMES THAT ALL FILES WITHIN THIS &quot;</span>
            <span class="s2">&quot;DIRECTORY ARE FROM THE SAME SHIP, SURVEY, AND ECHOSOUNDER.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="c1"># Check that the directory exists</span>
    <span class="n">check_for_assertion_errors</span><span class="p">(</span>
        <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Check (glob) for raw and idx files.</span>
    <span class="n">raw_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;*.raw&quot;</span><span class="p">]))]</span>
    <span class="n">idx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;*.idx&quot;</span><span class="p">]))]</span>
    <span class="n">bot_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;*.bot&quot;</span><span class="p">]))]</span>
    <span class="n">netcdf_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;*.nc&quot;</span><span class="p">]))]</span>
    <span class="c1"># Create vars for use later.</span>
    <span class="n">raw_upload_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">idx_upload_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bot_upload_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">netcdf_upload_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Let the user know how many of each file has been found to upload.</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;FOUND </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> RAW FILES | </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> IDX FILES |&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bot_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> BOT FILES | </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">netcdf_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> NETCDF FILES&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Upload each raw file to gcp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPLOADING RAW FILES...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">raw_file</span> <span class="ow">in</span> <span class="n">raw_files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">raw_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">UPLOADING RAW FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">raw_file_exists</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">raw_file_exists</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">FILE ALREADY EXISTS IN THE GCP STORAGE BUCKET AT&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload raw to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">raw_file</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># TODO: create custom object for raw files that are local.</span>
            <span class="c1"># metadata.create_and_upload_metadata_df(</span>
            <span class="c1">#     file_name=file_name,</span>
            <span class="c1">#     file_type=&quot;raw&quot;,</span>
            <span class="c1">#     ship_name=ship_name,</span>
            <span class="c1">#     survey_name=survey_name,</span>
            <span class="c1">#     echosounder=echosounder,</span>
            <span class="c1">#     data_source=data_source,</span>
            <span class="c1">#     gcp_bucket=gcp_bucket,</span>
            <span class="c1">#     debug=debug,</span>
            <span class="c1"># )</span>
            <span class="n">raw_upload_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw_upload_count</span><span class="si">}</span><span class="s2"> RAW FILES UPLOADED.&quot;</span><span class="p">)</span>

    <span class="c1"># Upload each idx file to gcp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPLOADING IDX FILES...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx_file</span> <span class="ow">in</span> <span class="n">idx_files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">idx_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">UPLOADING IDX FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;idx&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">idx_file_exists</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">idx_file_exists</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">FILE ALREADY EXISTS IN THE GCP STORAGE BUCKET AT&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload idx to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;idx&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">raw_file</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">idx_upload_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx_upload_count</span><span class="si">}</span><span class="s2"> IDX FILES UPLOADED.&quot;</span><span class="p">)</span>

    <span class="c1"># Upload each bot file to gcp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPLOADING BOT FILES...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bot_file</span> <span class="ow">in</span> <span class="n">bot_files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">bot_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">UPLOADING BOT FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">bot_file_exists</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bot_file_exists</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">FILE ALREADY EXISTS IN THE GCP STORAGE BUCKET AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload idx to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">raw_file</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">bot_upload_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bot_upload_count</span><span class="si">}</span><span class="s2"> BOT FILES UPLOADED.&quot;</span><span class="p">)</span>

    <span class="c1"># Upload each netcdf file to gcp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPLOADING NETCDF FILES...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">netcdf_file</span> <span class="ow">in</span> <span class="n">netcdf_files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">netcdf_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">UPLOADING NETCDF FILE </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">netcdf_file_exists</span> <span class="o">=</span> <span class="n">cloud_utils</span><span class="o">.</span><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">gcp_storage_bucket_location</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">netcdf_file_exists</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">FILE ALREADY EXISTS IN THE GCP STORAGE BUCKET AT &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">`&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Upload idx to GCP at the correct storage bucket location.</span>
            <span class="n">upload_file_to_gcp_storage_bucket</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">file_location</span><span class="o">=</span><span class="n">raw_file</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">create_and_upload_metadata_df_for_netcdf</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
                <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
                <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
                <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
                <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
                <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">netcdf_upload_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">netcdf_upload_count</span><span class="si">}</span><span class="s2"> NETCDF FILES UPLOADED.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;UPLOADS COMPLETE. RAW (</span><span class="si">{</span><span class="n">raw_upload_count</span><span class="si">}</span><span class="s2">) | IDX &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">idx_upload_count</span><span class="si">}</span><span class="s2">) | NETCDF (</span><span class="si">{</span><span class="n">netcdf_upload_count</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.metadata" class="doc doc-heading">
            <code>metadata</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file contains functions that have to do with metadata.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="create_and_upload_metadata_df(rf=None, debug=False) (aalibrary.metadata.create_and_upload_metadata_df)" href="#aalibrary.metadata.create_and_upload_metadata_df">create_and_upload_metadata_df</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a metadata file with appropriate information. Then uploads it</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="create_metadata_json_for_raw_files(rf=None, debug=False) (aalibrary.metadata.create_metadata_json_for_raw_files)" href="#aalibrary.metadata.create_metadata_json_for_raw_files">create_metadata_json_for_raw_files</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a JSON object containing metadata for the current user.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_metadata_in_df_format() (aalibrary.metadata.get_metadata_in_df_format)" href="#aalibrary.metadata.get_metadata_in_df_format">get_metadata_in_df_format</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Retrieves the metadata associated with all objects in GCP in DataFrame</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="upload_ncei_metadata_df_to_bigquery(ship_name='', survey_name='', download_location='', s3_bucket=None) (aalibrary.metadata.upload_ncei_metadata_df_to_bigquery)" href="#aalibrary.metadata.upload_ncei_metadata_df_to_bigquery">upload_ncei_metadata_df_to_bigquery</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Finds the metadata obtained from a survey on NCEI, and uploads it to the</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.metadata.create_and_upload_metadata_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_and_upload_metadata_df</span><span class="p">(</span><span class="n">rf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a metadata file with appropriate information. Then uploads it
to the correct table in GCP.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rf</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="aalibrary.raw_file.RawFile" href="../raw_file/#aalibrary.raw_file.RawFile">RawFile</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The RawFile object associated with this file.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_and_upload_metadata_df</span><span class="p">(</span>
    <span class="n">rf</span><span class="p">:</span> <span class="n">RawFile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a metadata file with appropriate information. Then uploads it</span>
<span class="sd">    to the correct table in GCP.</span>

<span class="sd">    Args:</span>
<span class="sd">        rf (RawFile, optional): The RawFile object associated with this file.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create the metadata file to be uploaded.</span>
    <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">create_metadata_json_for_raw_files</span><span class="p">(</span>
        <span class="n">rf</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># TODO: take care of netcdf files, possibly upload to another table with\</span>
    <span class="c1"># their metadata.</span>
    <span class="c1"># If the file is a netcdf, we extract even more data from its headers.</span>
    <span class="c1"># if netcdf_local_file_location:</span>
    <span class="c1">#     # Extract the metadata</span>
    <span class="c1">#     netcdf_metadata = nc_reader.get_netcdf_header(</span>
    <span class="c1">#         file_path=netcdf_local_file_location</span>
    <span class="c1">#     )</span>
    <span class="c1">#     # Merge the netcdf metadata with the metadata we have created.</span>
    <span class="c1">#     metadata_df.update(netcdf_metadata)</span>
    <span class="c1"># # Extract the metadata string</span>
    <span class="c1"># metadata_json_str = json.dumps(metadata_df)</span>
    <span class="c1"># with open(f&quot;./{file_name}.json&quot;, &quot;w&quot;) as jf:</span>
    <span class="c1">#     jf.write(metadata_json_str)</span>

    <span class="c1"># Upload to GCP BigQuery</span>
    <span class="n">metadata_df</span><span class="o">.</span><span class="n">to_gbq</span><span class="p">(</span>
        <span class="n">destination_table</span><span class="o">=</span><span class="s2">&quot;metadata.aalibrary_file_metadata&quot;</span><span class="p">,</span>
        <span class="n">project_id</span><span class="o">=</span><span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span><span class="p">,</span>
        <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.metadata.create_metadata_json_for_raw_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_metadata_json_for_raw_files</span><span class="p">(</span><span class="n">rf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a JSON object containing metadata for the current user.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rf</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="aalibrary.raw_file.RawFile" href="../raw_file/#aalibrary.raw_file.RawFile">RawFile</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The RawFile object associated with this file.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print out the metadata json.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: The metadata dataframe for the <code>aalibrary_file_metadata</code>
database table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_metadata_json_for_raw_files</span><span class="p">(</span>
    <span class="n">rf</span><span class="p">:</span> <span class="n">RawFile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a JSON object containing metadata for the current user.</span>

<span class="sd">    Args:</span>
<span class="sd">        rf (RawFile, optional): The RawFile object associated with this file.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        debug (bool, optional): Whether or not to print out the metadata json.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The metadata dataframe for the `aalibrary_file_metadata`</span>
<span class="sd">            database table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Gets the current gcloud user&#39;s email</span>
    <span class="n">get_curr_user_email_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gcloud&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;get-value&quot;</span><span class="p">,</span> <span class="s2">&quot;account&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">get_curr_user_email_cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">get_curr_user_email_cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># get the survey datetime.</span>
    <span class="n">file_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">get_file_datetime_str</span><span class="p">(),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="c1"># calculate the deletion datetime</span>
    <span class="n">curr_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">deletion_datetime</span> <span class="o">=</span> <span class="n">curr_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">deletion_datetime</span> <span class="o">=</span> <span class="n">deletion_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="n">metadata_json</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;FILE_NAME&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_name</span><span class="p">,</span>
        <span class="s2">&quot;DATE_CREATED&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
        <span class="s2">&quot;UPLOADED_BY&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
        <span class="s2">&quot;ECHOPYPE_VERSION&quot;</span><span class="p">:</span> <span class="n">echopype</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
        <span class="s2">&quot;PYTHON_VERSION&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;NUMPY_VERSION&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
        <span class="c1"># maybe just add in echopype&#39;s reqs.</span>
        <span class="c1"># pip lock file - for current environment</span>
        <span class="s2">&quot;NCEI_CRUISE_ID&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="o">.</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="s2">&quot;NCEI_URI&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_file_s3_object_key</span><span class="p">,</span>
        <span class="s2">&quot;GCP_URI&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="o">.</span><span class="n">raw_gcp_storage_bucket_location</span><span class="p">,</span>
        <span class="s2">&quot;FILE_DATETIME&quot;</span><span class="p">:</span> <span class="n">file_datetime</span><span class="p">,</span>
        <span class="s2">&quot;DELETION_DATETIME&quot;</span><span class="p">:</span> <span class="n">deletion_datetime</span><span class="p">,</span>
        <span class="s2">&quot;ICES_CODE&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="o">.</span><span class="n">ices_code</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">aalibrary_metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">metadata_json</span><span class="p">)</span>
    <span class="c1"># make sure data types are conserved before upload to BigQuery.</span>
    <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;DATE_CREATED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;DATE_CREATED&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
    <span class="p">)</span>
    <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;FILE_DATETIME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;FILE_DATETIME&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
    <span class="p">)</span>
    <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;DELETION_DATETIME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="n">aalibrary_metadata_df</span><span class="p">[</span><span class="s2">&quot;DELETION_DATETIME&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">aalibrary_metadata_df</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">aalibrary_metadata_df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">aalibrary_metadata_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.metadata.get_metadata_in_df_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metadata_in_df_format</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieves the metadata associated with all objects in GCP in DataFrame
format.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_metadata_in_df_format</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the metadata associated with all objects in GCP in DataFrame</span>
<span class="sd">    format.&quot;&quot;&quot;</span>
    <span class="c1"># TODO:</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.metadata.upload_ncei_metadata_df_to_bigquery" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_ncei_metadata_df_to_bigquery</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">download_location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Finds the metadata obtained from a survey on NCEI, and uploads it to the
<code>ncei_cruise_metadata</code> database table in bigquery. Also handles for extra
database entries that are needed, such as uploading to the
<code>ncei_instrument_metadata</code> when necessary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>download_location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local download location for the
file. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket resource object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_ncei_metadata_df_to_bigquery</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the metadata obtained from a survey on NCEI, and uploads it to the</span>
<span class="sd">    `ncei_cruise_metadata` database table in bigquery. Also handles for extra</span>
<span class="sd">    database entries that are needed, such as uploading to the</span>
<span class="sd">    `ncei_instrument_metadata` when necessary.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        download_location (str, optional): The local download location for the</span>
<span class="sd">            file. Defaults to &quot;&quot;.</span>
<span class="sd">        s3_bucket (boto3.resource, optional): The bucket resource object.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># This var can either be a string with the file&#39;s location, or None.</span>
    <span class="n">metadata_file_exists</span> <span class="o">=</span> <span class="n">check_if_tugboat_metadata_json_exists_in_survey</span><span class="p">(</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="o">=</span><span class="n">s3_bucket</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">metadata_file_exists</span><span class="p">:</span>
        <span class="c1"># TODO: Download all metadata files to local for download? Even</span>
        <span class="c1"># calibration files?</span>
        <span class="c1"># Handle for main metadata file for upload to BigQuery.</span>
        <span class="n">s3_bucket</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">metadata_file_exists</span><span class="p">,</span> <span class="n">download_location</span><span class="p">)</span>
        <span class="c1"># Subroutine to parse this file and upload to gcp.</span>
        <span class="n">_parse_and_upload_ncei_survey_level_metadata</span><span class="p">(</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span> <span class="n">file_location</span><span class="o">=</span><span class="n">download_location</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.queries" class="doc doc-heading">
            <code>queries</code>


</h2>

    <div class="doc doc-contents ">

        <p>This script contains classes that have SQL queries used for interaction
with the metadata database in BigQuery.</p>








<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="MetadataQueries


  
      dataclass
   (aalibrary.queries.MetadataQueries)" href="#aalibrary.queries.MetadataQueries">MetadataQueries</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This class contains queries related to the upload, alteration, and</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="aalibrary.queries.MetadataQueries" class="doc doc-heading">
            <code>MetadataQueries</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


        <p>This class contains queries related to the upload, alteration, and
retrieval of metadata from our BigQuery instance.</p>











              <details class="quote">
                <summary>Source code in <code>aalibrary/queries.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MetadataQueries</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class contains queries related to the upload, alteration, and</span>
<span class="sd">    retrieval of metadata from our BigQuery instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">get_all_aalibrary_metadata_records</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT * FROM `ggn-nmfs-aa-dev-1.metadata.aalibrary_file_metadata`&quot;&quot;&quot;</span>

    <span class="c1"># TODO for mike ryan</span>
    <span class="n">get_all_possible_ship_names_from_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT ship_name from `ggn-nmfs-aa-dev-1.metadata.aalibrary_file_metadata`</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_surveys_associated_with_a_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">get_all_surveys_associated_with_a_ship_name_query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_all_surveys_associated_with_a_ship_name_query</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_echosounders_used_in_a_survey</span><span class="p">(</span><span class="n">survey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_netcdf_files_in_database</span><span class="p">():</span> <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>