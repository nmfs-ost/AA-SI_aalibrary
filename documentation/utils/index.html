
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../aalibrary/">
      
      
        <link rel="next" href="../raw_file/">
      
      
      <link rel="icon" href="../../assets/noaa_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Utils - AALibrary</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-aalibraryutils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AALibrary" class="md-header__button md-logo" aria-label="AALibrary" data-md-component="logo">
      
  <img src="../../assets/NOAA-color-logo-no-text-print.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AALibrary
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utils
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AALibrary" class="md-nav__button md-logo" aria-label="AALibrary" data-md-component="logo">
      
  <img src="../../assets/NOAA-color-logo-no-text-print.png" alt="logo">

    </a>
    AALibrary
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/permissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aalibrary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AALibrary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils" class="md-nav__link">
    <span class="md-ellipsis">
      cloud_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cloud_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.bq_query_to_pandas" class="md-nav__link">
    <span class="md-ellipsis">
      bq_query_to_pandas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_existence_of_supplemental_files" class="md-nav__link">
    <span class="md-ellipsis">
      check_existence_of_supplemental_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_gcp" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_file_exists_in_gcp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_s3" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_file_exists_in_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.count_objects_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      count_objects_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.count_subdirectories_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      count_subdirectories_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.create_s3_objs" class="md-nav__link">
    <span class="md-ellipsis">
      create_s3_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.download_file_from_gcp" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_gcp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_data_lake_directory_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_data_lake_directory_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_object_key_for_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_object_key_for_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_service_client_sas" class="md-nav__link">
    <span class="md-ellipsis">
      get_service_client_sas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_subdirectories_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_subdirectories_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.list_all_objects_in_gcp_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      list_all_objects_in_gcp_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.list_all_objects_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      list_all_objects_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.setup_gbq_client_objs" class="md-nav__link">
    <span class="md-ellipsis">
      setup_gbq_client_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.setup_gcp_storage_objs" class="md-nav__link">
    <span class="md-ellipsis">
      setup_gcp_storage_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.upload_file_to_gcp_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcp_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies" class="md-nav__link">
    <span class="md-ellipsis">
      discrepancies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discrepancies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_checksum_sha256_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_checksum_sha256_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_file_size_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_size_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_local_sha256_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      get_local_sha256_checksum
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils" class="md-nav__link">
    <span class="md-ellipsis">
      gcp_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gcp_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_ship_names_in_gcp_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_names_in_gcp_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_survey_names_from_a_ship_in_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_survey_names_from_a_ship_in_storage_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_surveys_in_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_surveys_in_storage_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_all_objects_in_survey_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_objects_in_survey_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_all_ship_objects_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_objects_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_file_name_from_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_name_from_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_file_paths_via_json_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_paths_via_json_link
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_netcdf_gcp_location_from_raw_gcp_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_netcdf_gcp_location_from_raw_gcp_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.normalize_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_ship_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.parse_correct_gcp_storage_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      parse_correct_gcp_storage_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.parse_variables_from_ncei_file_url" class="md-nav__link">
    <span class="md-ellipsis">
      parse_variables_from_ncei_file_url
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.nc_reader" class="md-nav__link">
    <span class="md-ellipsis">
      nc_reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nc_reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.nc_reader.get_netcdf_header" class="md-nav__link">
    <span class="md-ellipsis">
      get_netcdf_header
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils" class="md-nav__link">
    <span class="md-ellipsis">
      ncei_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ncei_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.check_if_tugboat_metadata_json_exists_in_survey" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_tugboat_metadata_json_exists_in_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_echosounders_in_a_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_echosounders_in_a_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_echosounders_that_exist_in_NCEI" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_echosounders_that_exist_in_NCEI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_file_names_from_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_file_names_from_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_metadata_files_in_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata_files_in_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_raw_file_names_from_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_raw_file_names_from_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_ship_names_in_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_names_in_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_survey_names_from_a_ship" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_survey_names_from_a_ship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_surveys_in_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_surveys_in_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_closest_ncei_formatted_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_closest_ncei_formatted_ship_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_echosounder_from_raw_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_echosounder_from_raw_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_random_raw_file_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_random_raw_file_from_ncei
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker" class="md-nav__link">
    <span class="md-ellipsis">
      sonar_checker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sonar_checker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion" class="md-nav__link">
    <span class="md-ellipsis">
      ek_date_conversion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_date_conversion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.datetime_to_unix" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_to_unix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.nt_to_unix" class="md-nav__link">
    <span class="md-ellipsis">
      nt_to_unix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      unix_to_datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt" class="md-nav__link">
    <span class="md-ellipsis">
      unix_to_nt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unix_to_nt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--simple-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      Simple conversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-and-forth-between-the-two-standards" class="md-nav__link">
    <span class="md-ellipsis">
      Converting back and forth between the two standards:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-may-not-yield-the-exact-original-date" class="md-nav__link">
    <span class="md-ellipsis">
      converting back may not yield the exact original date,
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--but-will-be-within-the-datetimes-precision" class="md-nav__link">
    <span class="md-ellipsis">
      but will be within the datetime's precision
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io" class="md-nav__link">
    <span class="md-ellipsis">
      ek_raw_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_raw_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile" class="md-nav__link">
    <span class="md-ellipsis">
      RawSimradFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RawSimradFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.iter_dgrams" class="md-nav__link">
    <span class="md-ellipsis">
      iter_dgrams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.peek" class="md-nav__link">
    <span class="md-ellipsis">
      peek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.prev" class="md-nav__link">
    <span class="md-ellipsis">
      prev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.read" class="md-nav__link">
    <span class="md-ellipsis">
      read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readall" class="md-nav__link">
    <span class="md-ellipsis">
      readall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readline" class="md-nav__link">
    <span class="md-ellipsis">
      readline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readlines" class="md-nav__link">
    <span class="md-ellipsis">
      readlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.seek" class="md-nav__link">
    <span class="md-ellipsis">
      seek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip" class="md-nav__link">
    <span class="md-ellipsis">
      skip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip_back" class="md-nav__link">
    <span class="md-ellipsis">
      skip_back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.tell" class="md-nav__link">
    <span class="md-ellipsis">
      tell
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers" class="md-nav__link">
    <span class="md-ellipsis">
      ek_raw_parsers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_raw_parsers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradAnnotationParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradAnnotationParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradBottomParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradBottomParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradConfigParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradConfigParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradDepthParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradDepthParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradFILParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradFILParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradIDXParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradIDXParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradMRUParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradMRUParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradNMEAParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradNMEAParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradRawParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradRawParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradXMLParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradXMLParser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
    <nav class="md-nav" aria-label="log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="verbose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc" class="md-nav__link">
    <span class="md-ellipsis">
      misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.camelcase2snakecase" class="md-nav__link">
    <span class="md-ellipsis">
      camelcase2snakecase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      depth_from_pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="depth_from_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker" class="md-nav__link">
    <span class="md-ellipsis">
      sonar_checker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sonar_checker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AD2CP" class="md-nav__link">
    <span class="md-ellipsis">
      is_AD2CP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP" class="md-nav__link">
    <span class="md-ellipsis">
      is_AZFP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP6" class="md-nav__link">
    <span class="md-ellipsis">
      is_AZFP6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK60" class="md-nav__link">
    <span class="md-ellipsis">
      is_EK60
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK80" class="md-nav__link">
    <span class="md-ellipsis">
      is_EK80
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_ER60" class="md-nav__link">
    <span class="md-ellipsis">
      is_ER60
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.timings" class="md-nav__link">
    <span class="md-ellipsis">
      timings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="timings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.timings.time_ingestion_and_upload_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      time_ingestion_and_upload_from_ncei
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../raw_file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RawFile
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/notice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/disclaimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disclaimer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils" class="md-nav__link">
    <span class="md-ellipsis">
      cloud_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cloud_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.bq_query_to_pandas" class="md-nav__link">
    <span class="md-ellipsis">
      bq_query_to_pandas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_existence_of_supplemental_files" class="md-nav__link">
    <span class="md-ellipsis">
      check_existence_of_supplemental_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_gcp" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_file_exists_in_gcp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_s3" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_file_exists_in_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.count_objects_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      count_objects_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.count_subdirectories_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      count_subdirectories_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.create_s3_objs" class="md-nav__link">
    <span class="md-ellipsis">
      create_s3_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.download_file_from_gcp" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_from_gcp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_data_lake_directory_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_data_lake_directory_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_object_key_for_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_object_key_for_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_service_client_sas" class="md-nav__link">
    <span class="md-ellipsis">
      get_service_client_sas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.get_subdirectories_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_subdirectories_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.list_all_objects_in_gcp_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      list_all_objects_in_gcp_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.list_all_objects_in_s3_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      list_all_objects_in_s3_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.setup_gbq_client_objs" class="md-nav__link">
    <span class="md-ellipsis">
      setup_gbq_client_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.setup_gcp_storage_objs" class="md-nav__link">
    <span class="md-ellipsis">
      setup_gcp_storage_objs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.cloud_utils.upload_file_to_gcp_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_to_gcp_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies" class="md-nav__link">
    <span class="md-ellipsis">
      discrepancies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discrepancies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_checksum_sha256_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_checksum_sha256_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_file_size_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_size_from_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.discrepancies.get_local_sha256_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      get_local_sha256_checksum
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils" class="md-nav__link">
    <span class="md-ellipsis">
      gcp_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gcp_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_ship_names_in_gcp_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_names_in_gcp_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_survey_names_from_a_ship_in_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_survey_names_from_a_ship_in_storage_bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.gcp_utils.get_all_surveys_in_storage_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_surveys_in_storage_bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_all_objects_in_survey_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_objects_in_survey_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_all_ship_objects_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_objects_from_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_file_name_from_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_name_from_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_file_paths_via_json_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_paths_via_json_link
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.get_netcdf_gcp_location_from_raw_gcp_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_netcdf_gcp_location_from_raw_gcp_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.normalize_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_ship_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.parse_correct_gcp_storage_bucket_location" class="md-nav__link">
    <span class="md-ellipsis">
      parse_correct_gcp_storage_bucket_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.helpers.parse_variables_from_ncei_file_url" class="md-nav__link">
    <span class="md-ellipsis">
      parse_variables_from_ncei_file_url
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.nc_reader" class="md-nav__link">
    <span class="md-ellipsis">
      nc_reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nc_reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.nc_reader.get_netcdf_header" class="md-nav__link">
    <span class="md-ellipsis">
      get_netcdf_header
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils" class="md-nav__link">
    <span class="md-ellipsis">
      ncei_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ncei_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.check_if_tugboat_metadata_json_exists_in_survey" class="md-nav__link">
    <span class="md-ellipsis">
      check_if_tugboat_metadata_json_exists_in_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_echosounders_in_a_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_echosounders_in_a_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_echosounders_that_exist_in_NCEI" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_echosounders_that_exist_in_NCEI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_file_names_from_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_file_names_from_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_metadata_files_in_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_metadata_files_in_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_raw_file_names_from_survey" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_raw_file_names_from_survey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_ship_names_in_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_ship_names_in_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_survey_names_from_a_ship" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_survey_names_from_a_ship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_all_surveys_in_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_surveys_in_ncei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_closest_ncei_formatted_ship_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_closest_ncei_formatted_ship_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_echosounder_from_raw_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_echosounder_from_raw_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.ncei_utils.get_random_raw_file_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      get_random_raw_file_from_ncei
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker" class="md-nav__link">
    <span class="md-ellipsis">
      sonar_checker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sonar_checker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion" class="md-nav__link">
    <span class="md-ellipsis">
      ek_date_conversion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_date_conversion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.datetime_to_unix" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_to_unix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.nt_to_unix" class="md-nav__link">
    <span class="md-ellipsis">
      nt_to_unix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      unix_to_datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt" class="md-nav__link">
    <span class="md-ellipsis">
      unix_to_nt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unix_to_nt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--simple-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      Simple conversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-and-forth-between-the-two-standards" class="md-nav__link">
    <span class="md-ellipsis">
      Converting back and forth between the two standards:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-may-not-yield-the-exact-original-date" class="md-nav__link">
    <span class="md-ellipsis">
      converting back may not yield the exact original date,
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--but-will-be-within-the-datetimes-precision" class="md-nav__link">
    <span class="md-ellipsis">
      but will be within the datetime's precision
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io" class="md-nav__link">
    <span class="md-ellipsis">
      ek_raw_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_raw_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile" class="md-nav__link">
    <span class="md-ellipsis">
      RawSimradFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RawSimradFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.iter_dgrams" class="md-nav__link">
    <span class="md-ellipsis">
      iter_dgrams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.peek" class="md-nav__link">
    <span class="md-ellipsis">
      peek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.prev" class="md-nav__link">
    <span class="md-ellipsis">
      prev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.read" class="md-nav__link">
    <span class="md-ellipsis">
      read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readall" class="md-nav__link">
    <span class="md-ellipsis">
      readall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readline" class="md-nav__link">
    <span class="md-ellipsis">
      readline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readlines" class="md-nav__link">
    <span class="md-ellipsis">
      readlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.seek" class="md-nav__link">
    <span class="md-ellipsis">
      seek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip" class="md-nav__link">
    <span class="md-ellipsis">
      skip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip_back" class="md-nav__link">
    <span class="md-ellipsis">
      skip_back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.tell" class="md-nav__link">
    <span class="md-ellipsis">
      tell
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers" class="md-nav__link">
    <span class="md-ellipsis">
      ek_raw_parsers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ek_raw_parsers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradAnnotationParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradAnnotationParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradBottomParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradBottomParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradConfigParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradConfigParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradDepthParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradDepthParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradFILParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradFILParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradIDXParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradIDXParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradMRUParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradMRUParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradNMEAParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradNMEAParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradRawParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradRawParser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradXMLParser" class="md-nav__link">
    <span class="md-ellipsis">
      SimradXMLParser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
    <nav class="md-nav" aria-label="log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="verbose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.log.verbose--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc" class="md-nav__link">
    <span class="md-ellipsis">
      misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.camelcase2snakecase" class="md-nav__link">
    <span class="md-ellipsis">
      camelcase2snakecase
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      depth_from_pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="depth_from_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker" class="md-nav__link">
    <span class="md-ellipsis">
      sonar_checker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sonar_checker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AD2CP" class="md-nav__link">
    <span class="md-ellipsis">
      is_AD2CP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP" class="md-nav__link">
    <span class="md-ellipsis">
      is_AZFP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP6" class="md-nav__link">
    <span class="md-ellipsis">
      is_AZFP6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK60" class="md-nav__link">
    <span class="md-ellipsis">
      is_EK60
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK80" class="md-nav__link">
    <span class="md-ellipsis">
      is_EK80
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.sonar_checker.sonar_checker.is_ER60" class="md-nav__link">
    <span class="md-ellipsis">
      is_ER60
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aalibrary.utils.timings" class="md-nav__link">
    <span class="md-ellipsis">
      timings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="timings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aalibrary.utils.timings.time_ingestion_and_upload_from_ncei" class="md-nav__link">
    <span class="md-ellipsis">
      time_ingestion_and_upload_from_ncei
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="documentation-for-aalibraryutils">Documentation for <code>aalibrary.utils</code></h1>
<p>The <code>utils</code> submodule provides powerful and necessary functions for interacting with cloud providers. These functions include obtaining meta-metadata about the data files, such as how many files exist in a particular cruise in NCEI and more...</p>


<div class="doc doc-object doc-module">



<a id="aalibrary.utils"></a>
    <div class="doc doc-contents first">






<p><span class="doc-section-title">Modules:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="cloud_utils (aalibrary.utils.cloud_utils)" href="#aalibrary.utils.cloud_utils">cloud_utils</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file contains all utility functions for Active Acoustics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="discrepancies (aalibrary.utils.discrepancies)" href="#aalibrary.utils.discrepancies">discrepancies</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file is used to identify discrepancies between what data exists on</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="gcp_utils (aalibrary.utils.gcp_utils)" href="#aalibrary.utils.gcp_utils">gcp_utils</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file contains code pertaining to auxiliary functions related to parsing</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="helpers (aalibrary.utils.helpers)" href="#aalibrary.utils.helpers">helpers</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>For helper functions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="nc_reader (aalibrary.utils.nc_reader)" href="#aalibrary.utils.nc_reader">nc_reader</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file is used to get header information out of a NetCDF file. The</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ncei_utils (aalibrary.utils.ncei_utils)" href="#aalibrary.utils.ncei_utils">ncei_utils</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>This file contains code pertaining to auxiliary functions related to parsing</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="sonar_checker (aalibrary.utils.sonar_checker)" href="#aalibrary.utils.sonar_checker">sonar_checker</a></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="timings (aalibrary.utils.timings)" href="#aalibrary.utils.timings">timings</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>"This script deals with the times associated with ingesting/preprocessing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.cloud_utils" class="doc doc-heading">
            <code>cloud_utils</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file contains all utility functions for Active Acoustics.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="bq_query_to_pandas(client=None, query='') (aalibrary.utils.cloud_utils.bq_query_to_pandas)" href="#aalibrary.utils.cloud_utils.bq_query_to_pandas">bq_query_to_pandas</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Takes a SQL query and returns the end result as a DataFrame.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="check_existence_of_supplemental_files(file_name='', file_type='raw', ship_name='', survey_name='', echosounder='', debug=False) (aalibrary.utils.cloud_utils.check_existence_of_supplemental_files)" href="#aalibrary.utils.cloud_utils.check_existence_of_supplemental_files">check_existence_of_supplemental_files</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Checks the existence of supplemental files (idx, bot, etc.) for a raw</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="check_if_file_exists_in_gcp(bucket=None, file_path='') (aalibrary.utils.cloud_utils.check_if_file_exists_in_gcp)" href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_gcp">check_if_file_exists_in_gcp</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Checks whether a particular file exists in GCP using the file path</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="check_if_file_exists_in_s3(object_key='', s3_resource=None, s3_bucket_name='') (aalibrary.utils.cloud_utils.check_if_file_exists_in_s3)" href="#aalibrary.utils.cloud_utils.check_if_file_exists_in_s3">check_if_file_exists_in_s3</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Checks to see if a file exists in an s3 bucket. Intended for use with</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="count_objects_in_s3_bucket_location(prefix='', bucket=None) (aalibrary.utils.cloud_utils.count_objects_in_s3_bucket_location)" href="#aalibrary.utils.cloud_utils.count_objects_in_s3_bucket_location">count_objects_in_s3_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Counts the number of objects within a bucket location.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="count_subdirectories_in_s3_bucket_location(prefix='', bucket=None) (aalibrary.utils.cloud_utils.count_subdirectories_in_s3_bucket_location)" href="#aalibrary.utils.cloud_utils.count_subdirectories_in_s3_bucket_location">count_subdirectories_in_s3_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Counts the number of subdirectories within a bucket location.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="create_s3_objs(bucket_name='noaa-wcsd-pds') (aalibrary.utils.cloud_utils.create_s3_objs)" href="#aalibrary.utils.cloud_utils.create_s3_objs">create_s3_objs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates the s3 objects needed for using boto3 for a particular bucket.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="download_file_from_gcp(gcp_bucket, blob_file_path, local_file_path, debug=False) (aalibrary.utils.cloud_utils.download_file_from_gcp)" href="#aalibrary.utils.cloud_utils.download_file_from_gcp">download_file_from_gcp</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Downloads a file from the blob storage bucket.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_data_lake_directory_client(config_file_path='') (aalibrary.utils.cloud_utils.get_data_lake_directory_client)" href="#aalibrary.utils.cloud_utils.get_data_lake_directory_client">get_data_lake_directory_client</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a data lake directory client. Returns an object of type</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_object_key_for_s3(file_url='', file_name='', file_type='raw', ship_name='', survey_name='', echosounder='') (aalibrary.utils.cloud_utils.get_object_key_for_s3)" href="#aalibrary.utils.cloud_utils.get_object_key_for_s3">get_object_key_for_s3</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates an object key for a file within s3 given the parameters above.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_service_client_sas(account_name, sas_token) (aalibrary.utils.cloud_utils.get_service_client_sas)" href="#aalibrary.utils.cloud_utils.get_service_client_sas">get_service_client_sas</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets an azure service client using an SAS (shared access signature)</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_subdirectories_in_s3_bucket_location(prefix='', s3_client=None, return_full_paths=False, bucket_name='noaa-wcsd-pds') (aalibrary.utils.cloud_utils.get_subdirectories_in_s3_bucket_location)" href="#aalibrary.utils.cloud_utils.get_subdirectories_in_s3_bucket_location">get_subdirectories_in_s3_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets a list of all the subdirectories in a specific bucket location</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="list_all_objects_in_gcp_bucket_location(location='', gcp_bucket=None) (aalibrary.utils.cloud_utils.list_all_objects_in_gcp_bucket_location)" href="#aalibrary.utils.cloud_utils.list_all_objects_in_gcp_bucket_location">list_all_objects_in_gcp_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the files within a GCP storage bucket location.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="list_all_objects_in_s3_bucket_location(prefix='', s3_resource=None, return_full_paths=False, bucket_name='noaa-wcsd-pds') (aalibrary.utils.cloud_utils.list_all_objects_in_s3_bucket_location)" href="#aalibrary.utils.cloud_utils.list_all_objects_in_s3_bucket_location">list_all_objects_in_s3_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Lists all of the objects in a s3 bucket location denoted by <code>prefix</code>.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="setup_gbq_client_objs(location='US', project_id='ggn-nmfs-aa-dev-1') (aalibrary.utils.cloud_utils.setup_gbq_client_objs)" href="#aalibrary.utils.cloud_utils.setup_gbq_client_objs">setup_gbq_client_objs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Sets up Google Big Query client objects used to execute queries and</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="setup_gcp_storage_objs(project_id='ggn-nmfs-aa-dev-1', gcp_bucket_name='ggn-nmfs-aa-dev-1-data') (aalibrary.utils.cloud_utils.setup_gcp_storage_objs)" href="#aalibrary.utils.cloud_utils.setup_gcp_storage_objs">setup_gcp_storage_objs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Sets up Google Cloud Platform storage objects for use in accessing and</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="upload_file_to_gcp_bucket(bucket, blob_file_path, local_file_path, debug=False) (aalibrary.utils.cloud_utils.upload_file_to_gcp_bucket)" href="#aalibrary.utils.cloud_utils.upload_file_to_gcp_bucket">upload_file_to_gcp_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Uploads a file to the blob storage bucket.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.bq_query_to_pandas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bq_query_to_pandas</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Takes a SQL query and returns the end result as a DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bq_query_to_pandas</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes a SQL query and returns the end result as a DataFrame.&quot;&quot;&quot;</span>

    <span class="n">job</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.check_existence_of_supplemental_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_existence_of_supplemental_files</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks the existence of supplemental files (idx, bot, etc.) for a raw
file. Will check for existence in all data sources.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>RawFile</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="aalibrary.raw_file.RawFile" href="../raw_file/#aalibrary.raw_file.RawFile">RawFile</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns a RawFile object, existence can be accessed as a
boolean via the variable within.
Ex. rf.idx_file_exists_in_ncei</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_existence_of_supplemental_files</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RawFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks the existence of supplemental files (idx, bot, etc.) for a raw</span>
<span class="sd">    file. Will check for existence in all data sources.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        RawFile: Returns a RawFile object, existence can be accessed as a</span>
<span class="sd">            boolean via the variable within.</span>
<span class="sd">            Ex. rf.idx_file_exists_in_ncei</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create connection vars</span>
    <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="n">setup_gcp_storage_objs</span><span class="p">()</span>
    <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="c1"># Create the RawFile object.</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">RawFile</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
        <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
        <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
        <span class="n">echosounder</span><span class="o">=</span><span class="n">echosounder</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="n">gcp_bucket_name</span><span class="p">,</span>
        <span class="n">gcp_stor_client</span><span class="o">=</span><span class="n">gcp_stor_client</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.check_if_file_exists_in_gcp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_if_file_exists_in_gcp</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks whether a particular file exists in GCP using the file path
(blob).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Bucket">Bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket object used to check for
the file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The blob file path within the bucket.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the file already exists, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_if_file_exists_in_gcp</span><span class="p">(</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks whether a particular file exists in GCP using the file path</span>
<span class="sd">    (blob).</span>

<span class="sd">    Args:</span>
<span class="sd">        bucket (storage.Bucket, optional): The bucket object used to check for</span>
<span class="sd">            the file. Defaults to None.</span>
<span class="sd">        file_path (str, optional): The blob file path within the bucket.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Bool: True if the file already exists, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.check_if_file_exists_in_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_if_file_exists_in_s3</span><span class="p">(</span><span class="n">object_key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s3_bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks to see if a file exists in an s3 bucket. Intended for use with
NCEI, but will work with other s3 buckets as well.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>object_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object key (location of the object).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_resource</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The boto3 resource for this
particular bucket. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket name. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the file exists within the bucket. False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_if_file_exists_in_s3</span><span class="p">(</span>
    <span class="n">object_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">s3_bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks to see if a file exists in an s3 bucket. Intended for use with</span>
<span class="sd">    NCEI, but will work with other s3 buckets as well.</span>

<span class="sd">    Args:</span>
<span class="sd">        object_key (str, optional): The object key (location of the object).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        s3_resource (boto3.resource, optional): The boto3 resource for this</span>
<span class="sd">            particular bucket. Defaults to None.</span>
<span class="sd">        s3_bucket_name (str, optional): The bucket name. Defaults to &quot;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the file exists within the bucket. False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_resource</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">s3_bucket_name</span><span class="p">,</span> <span class="n">object_key</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># object key does not exist.</span>
        <span class="c1"># print(e)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.count_objects_in_s3_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_objects_in_s3_bucket_location</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Counts the number of objects within a bucket location.
NOTE: This DOES NOT include folders, as those do not count as objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket location. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket resource object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The count of objects within the location.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_objects_in_s3_bucket_location</span><span class="p">(</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Counts the number of objects within a bucket location.</span>
<span class="sd">    NOTE: This DOES NOT include folders, as those do not count as objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        prefix (str, optional): The bucket location. Defaults to &quot;&quot;.</span>
<span class="sd">        bucket (boto3.resource, optional): The bucket resource object.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The count of objects within the location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.count_subdirectories_in_s3_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_subdirectories_in_s3_bucket_location</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Counts the number of subdirectories within a bucket location.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket location. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket resource object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The count of subdirectories within the location.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Counts the number of subdirectories within a bucket location.</span>

<span class="sd">    Args:</span>
<span class="sd">        prefix (str, optional): The bucket location. Defaults to &quot;&quot;.</span>
<span class="sd">        bucket (boto3.resource, optional): The bucket resource object.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The count of subdirectories within the location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">subdirs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prefix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">:</span>
            <span class="n">subdirs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="c1"># print(prefix + &quot;/&quot;)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.create_s3_objs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_s3_objs</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="s1">&#39;noaa-wcsd-pds&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates the s3 objects needed for using boto3 for a particular bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket you want to refer to. The
default points to the NCEI bucket. Defaults to "noaa-wcsd-pds".</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-wcsd-pds&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Tuple</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The s3 client (used for certain portions of the boto3 api), the
s3 resource (newer, more used object for accessing s3 buckets), and
the actual s3 bucket itself.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_s3_objs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates the s3 objects needed for using boto3 for a particular bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        bucket_name (str, optional): The bucket you want to refer to. The</span>
<span class="sd">            default points to the NCEI bucket. Defaults to &quot;noaa-wcsd-pds&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple: The s3 client (used for certain portions of the boto3 api), the</span>
<span class="sd">            s3 resource (newer, more used object for accessing s3 buckets), and</span>
<span class="sd">            the actual s3 bucket itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Setup access to S3 bucket as an anonymous user</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
        <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">s3_resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span>
        <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.download_file_from_gcp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file_from_gcp</span><span class="p">(</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">blob_file_path</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Downloads a file from the blob storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket object used for
downloading from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>blob_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The blob's file path.
Ex. "data/itds/logs/execute_rasp_ii/temp.csv"
NOTE: This must include the file name as well as the extension.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local file path you wish to download the
blob to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_file_from_gcp</span><span class="p">(</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
    <span class="n">blob_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">local_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads a file from the blob storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        gcp_bucket (storage.Client.bucket): The bucket object used for</span>
<span class="sd">            downloading from.</span>
<span class="sd">        blob_file_path (str): The blob&#39;s file path.</span>
<span class="sd">            Ex. &quot;data/itds/logs/execute_rasp_ii/temp.csv&quot;</span>
<span class="sd">            NOTE: This must include the file name as well as the extension.</span>
<span class="sd">        local_file_path (str): The local file path you wish to download the</span>
<span class="sd">            blob to.</span>
<span class="sd">        debug (bool): Whether or not to print debug statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">blob</span> <span class="o">=</span> <span class="n">gcp_bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Download from blob</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New data downloaded to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.get_data_lake_directory_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data_lake_directory_client</span><span class="p">(</span><span class="n">config_file_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a data lake directory client. Returns an object of type
DataLakeServiceClient.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The location of the config file.
Needs a <code>[DEFAULT]</code> section with a <code>azure_connection_string</code>
variable defined. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataLakeServiceClient</code></td>            <td>
                  <code><span title="azure.storage.filedatalake.DataLakeServiceClient">DataLakeServiceClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object of type DataLakeServiceClient, with
connection to the connection string described in the config.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data_lake_directory_client</span><span class="p">(</span>
    <span class="n">config_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLakeServiceClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a data lake directory client. Returns an object of type</span>
<span class="sd">    DataLakeServiceClient.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file_path (str, optional): The location of the config file.</span>
<span class="sd">            Needs a `[DEFAULT]` section with a `azure_connection_string`</span>
<span class="sd">            variable defined. Defaults to &quot;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataLakeServiceClient: An object of type DataLakeServiceClient, with</span>
<span class="sd">            connection to the connection string described in the config.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">)</span>

    <span class="n">azure_service</span> <span class="o">=</span> <span class="n">DataLakeServiceClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span>
        <span class="n">conn_str</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">][</span><span class="s2">&quot;azure_connection_string&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">azure_service</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.get_object_key_for_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_object_key_for_s3</span><span class="p">(</span><span class="n">file_url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates an object key for a file within s3 given the parameters above.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The entire url to the file resource in s3.
Starts with "https://" or "s3://". Defaults to "".
NOTE: If this is specified, there is no need to provide the other
parameters.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (do not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_object_key_for_s3</span><span class="p">(</span>
    <span class="n">file_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an object key for a file within s3 given the parameters above.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_url (str, optional): The entire url to the file resource in s3.</span>
<span class="sd">            Starts with &quot;https://&quot; or &quot;s3://&quot;. Defaults to &quot;&quot;.</span>
<span class="sd">            NOTE: If this is specified, there is no need to provide the other</span>
<span class="sd">            parameters.</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (do not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">file_url</span><span class="p">:</span>
        <span class="c1"># We replace the beginning of common file paths</span>
        <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;https://noaa-wcsd-pds.s3.amazonaws.com/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s3://noaa-wcsd-pds/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We default to using the parameters to create an object key according</span>
        <span class="c1"># to NCEI standards.</span>
        <span class="n">object_key</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">object_key</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.get_service_client_sas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_service_client_sas</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">sas_token</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets an azure service client using an SAS (shared access signature)
token. The token must be created in Azure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>account_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the account you are trying to create a
service client with. This is usually a storage account that is
attached to the container.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sas_token</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete SAS token.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataLakeServiceClient</code></td>            <td>
                  <code><span title="azure.storage.filedatalake.DataLakeServiceClient">DataLakeServiceClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object of type DataLakeServiceClient, with
connection to the container/file the SAS allows access to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_service_client_sas</span><span class="p">(</span>
    <span class="n">account_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sas_token</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLakeServiceClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets an azure service client using an SAS (shared access signature)</span>
<span class="sd">    token. The token must be created in Azure.</span>

<span class="sd">    Args:</span>
<span class="sd">        account_name (str): The name of the account you are trying to create a</span>
<span class="sd">            service client with. This is usually a storage account that is</span>
<span class="sd">            attached to the container.</span>
<span class="sd">        sas_token (str): The complete SAS token.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataLakeServiceClient: An object of type DataLakeServiceClient, with</span>
<span class="sd">            connection to the container/file the SAS allows access to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">account_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span>

    <span class="c1"># The SAS token string can be passed in as credential param or appended to</span>
    <span class="c1"># the account URL</span>
    <span class="n">service_client</span> <span class="o">=</span> <span class="n">DataLakeServiceClient</span><span class="p">(</span><span class="n">account_url</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">sas_token</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">service_client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.get_subdirectories_in_s3_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bucket_name</span><span class="o">=</span><span class="s1">&#39;noaa-wcsd-pds&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all the subdirectories in a specific bucket location
(called a prefix). The return can be with full paths (root to folder
inclusive), or just the folder names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket folder location. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket client object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket name. Defaults to
"noaa-wcsd-pds".</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-wcsd-pds&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the subdirectory. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets a list of all the subdirectories in a specific bucket location</span>
<span class="sd">    (called a prefix). The return can be with full paths (root to folder</span>
<span class="sd">    inclusive), or just the folder names.</span>

<span class="sd">    Args:</span>
<span class="sd">        prefix (str, optional): The bucket folder location. Defaults to &quot;&quot;.</span>
<span class="sd">        s3_client (boto3.client, optional): The bucket client object.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">        bucket_name (str, optional): The bucket name. Defaults to</span>
<span class="sd">            &quot;noaa-wcsd-pds&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the subdirectory. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s3_client</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>

    <span class="n">subdirs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">Delimiter</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CommonPrefixes&quot;</span><span class="p">):</span>
        <span class="n">subdir_full_path_from_prefix</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Prefix&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_full_paths</span><span class="p">:</span>
            <span class="n">subdir</span> <span class="o">=</span> <span class="n">subdir_full_path_from_prefix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subdir</span> <span class="o">=</span> <span class="n">subdir_full_path_from_prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">subdir</span> <span class="o">=</span> <span class="n">subdir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">subdirs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.list_all_objects_in_gcp_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_all_objects_in_gcp_bucket_location</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the files within a GCP storage bucket location.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The location to search for files. Defaults
to "".
Ex. "NCEI/Reuben_Lasker/RL2107"</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The gcp bucket to use.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings containing all URIs for each file in the
bucket.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_all_objects_in_gcp_bucket_location</span><span class="p">(</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the files within a GCP storage bucket location.</span>

<span class="sd">    Args:</span>
<span class="sd">        location (str, optional): The location to search for files. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">            Ex. &quot;NCEI/Reuben_Lasker/RL2107&quot;</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The gcp bucket to use.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings containing all URIs for each file in the</span>
<span class="sd">            bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_blobs_in_this_location</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="n">gcp_bucket</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">location</span><span class="p">):</span>
        <span class="n">all_blobs_in_this_location</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_blobs_in_this_location</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.list_all_objects_in_s3_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bucket_name</span><span class="o">=</span><span class="s1">&#39;noaa-wcsd-pds&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Lists all of the objects in a s3 bucket location denoted by <code>prefix</code>.
Returns a list containing str. You get full paths if you specify the
<code>return_full_paths</code> parameter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket location. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_resource</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket resource object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket name. Defaults to
"noaa-wcsd-pds".</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-wcsd-pds&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings containing either the objects name or
path, dependent on the <code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lists all of the objects in a s3 bucket location denoted by `prefix`.</span>
<span class="sd">    Returns a list containing str. You get full paths if you specify the</span>
<span class="sd">    `return_full_paths` parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        prefix (str, optional): The bucket location. Defaults to &quot;&quot;.</span>
<span class="sd">        s3_resource (boto3.resource, optional): The bucket resource object.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">        bucket_name (str, optional): The bucket name. Defaults to</span>
<span class="sd">            &quot;noaa-wcsd-pds&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings containing either the objects name or</span>
<span class="sd">            path, dependent on the `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s3_resource</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>

    <span class="n">object_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">return_full_paths</span><span class="p">:</span>
            <span class="n">object_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">object_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">object_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.setup_gbq_client_objs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_gbq_client_objs</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets up Google Big Query client objects used to execute queries and
such.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The location of the big-query
tables/database. This is usually set when creating the database in
big query. Defaults to "US".</p>
              </div>
            </td>
            <td>
                  <code>&#39;US&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The project id that the big query instance
belongs to. Defaults to "ggn-nmfs-aa-dev-1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Tuple</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="google.cloud.bigquery.Client">Client</span>, <span title="gcsfs.GCSFileSystem">GCSFileSystem</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The big query client object, along with an object for the Google
Cloud Storage file system.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_gbq_client_objs</span><span class="p">(</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up Google Big Query client objects used to execute queries and</span>
<span class="sd">    such.</span>

<span class="sd">    Args:</span>
<span class="sd">        location (str, optional): The location of the big-query</span>
<span class="sd">            tables/database. This is usually set when creating the database in</span>
<span class="sd">            big query. Defaults to &quot;US&quot;.</span>
<span class="sd">        project_id (str, optional): The project id that the big query instance</span>
<span class="sd">            belongs to. Defaults to &quot;ggn-nmfs-aa-dev-1&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple: The big query client object, along with an object for the Google</span>
<span class="sd">            Cloud Storage file system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gcp_bq_client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

    <span class="n">gcp_gcs_file_system</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gcp_bq_client</span><span class="p">,</span> <span class="n">gcp_gcs_file_system</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.setup_gcp_storage_objs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_gcp_storage_objs</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1&#39;</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1-data&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets up Google Cloud Platform storage objects for use in accessing and
modifying storage buckets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The project id of the project you want to
access. Defaults to "ggn-nmfs-aa-dev-1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the exact bucket you want
to access. Defaults to "ggn-nmfs-aa-dev-1-data".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1-data&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="google.cloud.storage.Client">Client</span>, <span title="str">str</span>, <span title="google.cloud.storage.Client.bucket">bucket</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[storage.Client, str, storage.Client.bucket]: The storage client,
followed by the GCP bucket name (str) and then the actual bucket
object itself (which will be executing the commands used in this
api).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_gcp_storage_objs</span><span class="p">(</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1-data&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up Google Cloud Platform storage objects for use in accessing and</span>
<span class="sd">    modifying storage buckets.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_id (str, optional): The project id of the project you want to</span>
<span class="sd">            access. Defaults to &quot;ggn-nmfs-aa-dev-1&quot;.</span>
<span class="sd">        gcp_bucket_name (str, optional): The name of the exact bucket you want</span>
<span class="sd">            to access. Defaults to &quot;ggn-nmfs-aa-dev-1-data&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[storage.Client, str, storage.Client.bucket]: The storage client,</span>
<span class="sd">            followed by the GCP bucket name (str) and then the actual bucket</span>
<span class="sd">            object itself (which will be executing the commands used in this</span>
<span class="sd">            api).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gcp_stor_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_id</span><span class="p">)</span>

    <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="n">gcp_stor_client</span><span class="o">.</span><span class="n">bucket</span><span class="p">(</span><span class="n">gcp_bucket_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.cloud_utils.upload_file_to_gcp_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file_to_gcp_bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">blob_file_path</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Uploads a file to the blob storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket object used for uploading.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>blob_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The blob's file path.
Ex. "data/itds/logs/execute_code_files/temp.csv"
NOTE: This must include the file name as well as the extension.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local file path you wish to upload to the
blob.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/cloud_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_file_to_gcp_bucket</span><span class="p">(</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
    <span class="n">blob_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">local_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uploads a file to the blob storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        bucket (storage.Client.bucket): The bucket object used for uploading.</span>
<span class="sd">        blob_file_path (str): The blob&#39;s file path.</span>
<span class="sd">            Ex. &quot;data/itds/logs/execute_code_files/temp.csv&quot;</span>
<span class="sd">            NOTE: This must include the file name as well as the extension.</span>
<span class="sd">        local_file_path (str): The local file path you wish to upload to the</span>
<span class="sd">            blob.</span>
<span class="sd">        debug (bool): Whether or not to print debug statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">bucket</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">setup_gcp_storage_objs</span><span class="p">()</span>

    <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Upload a new blob</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New data uploaded to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.discrepancies" class="doc doc-heading">
            <code>discrepancies</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file is used to identify discrepancies between what data exists on
local versus what exists on the cloud. It considers the following things when
comparing:
* Number of files per cruise
* File Name/Types
* File Sizes
* Checksum</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_checksum_sha256_from_s3(object_key, s3_resource) (aalibrary.utils.discrepancies.get_checksum_sha256_from_s3)" href="#aalibrary.utils.discrepancies.get_checksum_sha256_from_s3">get_checksum_sha256_from_s3</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the SHA-256 checksum of the s3 object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_file_size_from_s3(object_key, s3_resource) (aalibrary.utils.discrepancies.get_file_size_from_s3)" href="#aalibrary.utils.discrepancies.get_file_size_from_s3">get_file_size_from_s3</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the file size of an object in s3.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_local_sha256_checksum(local_file_path, chunk_size=65536) (aalibrary.utils.discrepancies.get_local_sha256_checksum)" href="#aalibrary.utils.discrepancies.get_local_sha256_checksum">get_local_sha256_checksum</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculates the SHA256 checksum of a file.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.discrepancies.get_checksum_sha256_from_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_checksum_sha256_from_s3</span><span class="p">(</span><span class="n">object_key</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the SHA-256 checksum of the s3 object.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/discrepancies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_checksum_sha256_from_s3</span><span class="p">(</span><span class="n">object_key</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the SHA-256 checksum of the s3 object.&quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span> <span class="n">object_key</span><span class="p">)</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">checksum_sha256</span>
    <span class="k">return</span> <span class="n">checksum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.discrepancies.get_file_size_from_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_size_from_s3</span><span class="p">(</span><span class="n">object_key</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the file size of an object in s3.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/discrepancies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file_size_from_s3</span><span class="p">(</span><span class="n">object_key</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the file size of an object in s3.&quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span> <span class="n">object_key</span><span class="p">)</span>
    <span class="n">file_size</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">content_length</span>
    <span class="k">return</span> <span class="n">file_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.discrepancies.get_local_sha256_checksum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_local_sha256_checksum</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">65536</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the SHA256 checksum of a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>local_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of chunks to read the file in (in bytes).
              Larger chunks can be more efficient for large files.</p>
              </div>
            </td>
            <td>
                  <code>65536</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SHA256 checksum of the file as a hexadecimal string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/discrepancies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_local_sha256_checksum</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">65536</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the SHA256 checksum of a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        local_file_path (str): The path to the file.</span>
<span class="sd">        chunk_size (int): The size of chunks to read the file in (in bytes).</span>
<span class="sd">                          Larger chunks can be more efficient for large files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The SHA256 checksum of the file as a hexadecimal string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sha256_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Read the file in chunks to handle large files efficiently</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="n">sha256_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sha256_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;File not found.&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.gcp_utils" class="doc doc-heading">
            <code>gcp_utils</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file contains code pertaining to auxiliary functions related to parsing
through our google storage bucket.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ship_names_in_gcp_bucket(project_id='ggn-nmfs-aa-dev-1', gcp_bucket_name='', gcp_bucket=None, return_full_paths=False) (aalibrary.utils.gcp_utils.get_all_ship_names_in_gcp_bucket)" href="#aalibrary.utils.gcp_utils.get_all_ship_names_in_gcp_bucket">get_all_ship_names_in_gcp_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the ship names within a GCP storage bucket.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_survey_names_from_a_ship_in_storage_bucket(ship_name='', project_id='ggn-nmfs-aa-dev-1', gcp_bucket_name='', gcp_bucket=None, return_full_paths=False) (aalibrary.utils.gcp_utils.get_all_survey_names_from_a_ship_in_storage_bucket)" href="#aalibrary.utils.gcp_utils.get_all_survey_names_from_a_ship_in_storage_bucket">get_all_survey_names_from_a_ship_in_storage_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the survey names from a particular ship in a GCP storage bucket.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_surveys_in_storage_bucket(project_id='ggn-nmfs-aa-dev-1', gcp_bucket_name='', gcp_bucket=None, return_full_paths=False) (aalibrary.utils.gcp_utils.get_all_surveys_in_storage_bucket)" href="#aalibrary.utils.gcp_utils.get_all_surveys_in_storage_bucket">get_all_surveys_in_storage_bucket</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the surveys in a GCP storage bucket.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.gcp_utils.get_all_ship_names_in_gcp_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ship_names_in_gcp_bucket</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1&#39;</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the ship names within a GCP storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP project ID that the storage bucket resides in.
Defaults to "ggn-nmfs-aa-dev-1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket name. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket client object.
If none, one will be created for you based on the <code>project_id</code> and
<code>gcp_bucket_name</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.
NOTE: You can set this parameter to <code>True</code> if you would like to see which folders
contain which ships.
For example: Reuben Lasker can have data coming from both OMAO and local upload HDD.
It will look like: {'OMAO/Reuben_Lasker/', 'HDD/Reuben_Lasker/'}</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings containing the ship names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/gcp_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ship_names_in_gcp_bucket</span><span class="p">(</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the ship names within a GCP storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_id (str, optional): The GCP project ID that the storage bucket resides in.</span>
<span class="sd">            Defaults to &quot;ggn-nmfs-aa-dev-1&quot;.</span>
<span class="sd">        gcp_bucket_name (str, optional): The GCP storage bucket name. Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP storage bucket client object.</span>
<span class="sd">            If none, one will be created for you based on the `project_id` and</span>
<span class="sd">            `gcp_bucket_name`. Defaults to None.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">            NOTE: You can set this parameter to `True` if you would like to see which folders</span>
<span class="sd">            contain which ships.</span>
<span class="sd">            For example: Reuben Lasker can have data coming from both OMAO and local upload HDD.</span>
<span class="sd">            It will look like: {&#39;OMAO/Reuben_Lasker/&#39;, &#39;HDD/Reuben_Lasker/&#39;}</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings containing the ship names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gcp_bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="n">setup_gcp_storage_objs</span><span class="p">()</span>
    <span class="c1"># Get the initial subdirs</span>
    <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;HDD/&quot;</span><span class="p">,</span> <span class="s2">&quot;NCEI/&quot;</span><span class="p">,</span> <span class="s2">&quot;OMAO/&quot;</span><span class="p">,</span> <span class="s2">&quot;TEST/&quot;</span><span class="p">]</span>
    <span class="n">all_ship_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
        <span class="n">ship_names</span> <span class="o">=</span> <span class="n">list_all_folders_in_gcp_bucket_location</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span>
        <span class="p">)</span>
        <span class="n">all_ship_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ship_names</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_ship_names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.gcp_utils.get_all_survey_names_from_a_ship_in_storage_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_survey_names_from_a_ship_in_storage_bucket</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1&#39;</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the survey names from a particular ship in a GCP storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Will get normalized to GCP standards. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP project ID that the storage bucket resides in.
Defaults to "ggn-nmfs-aa-dev-1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket name. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket client object.
If none, one will be created for you based on the <code>project_id</code> and
<code>gcp_bucket_name</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the survey names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings containing the survey names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/gcp_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_survey_names_from_a_ship_in_storage_bucket</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the survey names from a particular ship in a GCP storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Will get normalized to GCP standards. Defaults to None.</span>
<span class="sd">        project_id (str, optional): The GCP project ID that the storage bucket resides in.</span>
<span class="sd">            Defaults to &quot;ggn-nmfs-aa-dev-1&quot;.</span>
<span class="sd">        gcp_bucket_name (str, optional): The GCP storage bucket name. Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP storage bucket client object.</span>
<span class="sd">            If none, one will be created for you based on the `project_id` and</span>
<span class="sd">            `gcp_bucket_name`. Defaults to None.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the survey names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings containing the survey names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gcp_bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="n">setup_gcp_storage_objs</span><span class="p">()</span>

    <span class="c1"># Normalize the ship name.</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">normalize_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">)</span>
    <span class="c1"># Search all possible directories for ship surveys</span>
    <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;HDD/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;NCEI/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;OMAO/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;TEST/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">all_survey_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
        <span class="n">survey_names</span> <span class="o">=</span> <span class="n">list_all_folders_in_gcp_bucket_location</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span>
        <span class="p">)</span>
        <span class="n">all_survey_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">survey_names</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_survey_names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.gcp_utils.get_all_surveys_in_storage_bucket" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_surveys_in_storage_bucket</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ggn-nmfs-aa-dev-1&#39;</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gcp_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the surveys in a GCP storage bucket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP project ID that the storage bucket resides in.
Defaults to "ggn-nmfs-aa-dev-1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ggn-nmfs-aa-dev-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket name. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gcp_bucket</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client.bucket">bucket</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GCP storage bucket client object.
If none, one will be created for you based on the <code>project_id</code> and
<code>gcp_bucket_name</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the survey names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings containing the survey names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/gcp_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_surveys_in_storage_bucket</span><span class="p">(</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ggn-nmfs-aa-dev-1&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">gcp_bucket</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the surveys in a GCP storage bucket.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_id (str, optional): The GCP project ID that the storage bucket resides in.</span>
<span class="sd">            Defaults to &quot;ggn-nmfs-aa-dev-1&quot;.</span>
<span class="sd">        gcp_bucket_name (str, optional): The GCP storage bucket name. Defaults to &quot;&quot;.</span>
<span class="sd">        gcp_bucket (storage.Client.bucket, optional): The GCP storage bucket client object.</span>
<span class="sd">            If none, one will be created for you based on the `project_id` and</span>
<span class="sd">            `gcp_bucket_name`. Defaults to None.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the survey names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings containing the survey names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gcp_bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gcp_stor_client</span><span class="p">,</span> <span class="n">gcp_bucket_name</span><span class="p">,</span> <span class="n">gcp_bucket</span> <span class="o">=</span> <span class="n">setup_gcp_storage_objs</span><span class="p">()</span>

    <span class="n">all_ship_prefixes</span> <span class="o">=</span> <span class="n">get_all_ship_names_in_gcp_bucket</span><span class="p">(</span>
        <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
        <span class="n">gcp_bucket_name</span><span class="o">=</span><span class="n">gcp_bucket_name</span><span class="p">,</span>
        <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">all_surveys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ship_prefix</span> <span class="ow">in</span> <span class="n">all_ship_prefixes</span><span class="p">:</span>
        <span class="c1"># Get surveys from each ship prefix</span>
        <span class="n">ship_surveys</span> <span class="o">=</span> <span class="n">list_all_folders_in_gcp_bucket_location</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">ship_prefix</span><span class="p">,</span>
            <span class="n">gcp_bucket</span><span class="o">=</span><span class="n">gcp_bucket</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_surveys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ship_surveys</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_surveys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.helpers" class="doc doc-heading">
            <code>helpers</code>


</h2>

    <div class="doc doc-contents ">

        <p>For helper functions.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_objects_in_survey_from_ncei(ship_name='', survey_name='', s3_bucket=None) (aalibrary.utils.helpers.get_all_objects_in_survey_from_ncei)" href="#aalibrary.utils.helpers.get_all_objects_in_survey_from_ncei">get_all_objects_in_survey_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the object keys from a ship survey from the NCEI database.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ship_objects_from_ncei(ship_name='', bucket=None) (aalibrary.utils.helpers.get_all_ship_objects_from_ncei)" href="#aalibrary.utils.helpers.get_all_ship_objects_from_ncei">get_all_ship_objects_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the object keys from a ship from the NCEI database.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_file_name_from_url(url='') (aalibrary.utils.helpers.get_file_name_from_url)" href="#aalibrary.utils.helpers.get_file_name_from_url">get_file_name_from_url</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Extracts the file name from a given storage bucket url. Includes the</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_file_paths_via_json_link(link='') (aalibrary.utils.helpers.get_file_paths_via_json_link)" href="#aalibrary.utils.helpers.get_file_paths_via_json_link">get_file_paths_via_json_link</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>This function helps in getting the links from a json request, parsing</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_netcdf_gcp_location_from_raw_gcp_location(gcp_storage_bucket_location='') (aalibrary.utils.helpers.get_netcdf_gcp_location_from_raw_gcp_location)" href="#aalibrary.utils.helpers.get_netcdf_gcp_location_from_raw_gcp_location">get_netcdf_gcp_location_from_raw_gcp_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the netcdf location of a raw file within GCP.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="normalize_ship_name(ship_name='') (aalibrary.utils.helpers.normalize_ship_name)" href="#aalibrary.utils.helpers.normalize_ship_name">normalize_ship_name</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Normalizes a ship's name. This is necessary for creating a deterministic</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="parse_correct_gcp_storage_bucket_location(file_name='', file_type='', ship_name='', survey_name='', echosounder='', data_source='', is_metadata=False, is_survey_metadata=False, debug=False) (aalibrary.utils.helpers.parse_correct_gcp_storage_bucket_location)" href="#aalibrary.utils.helpers.parse_correct_gcp_storage_bucket_location">parse_correct_gcp_storage_bucket_location</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculates the correct gcp storage location based on data source, file</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="parse_variables_from_ncei_file_url(url='') (aalibrary.utils.helpers.parse_variables_from_ncei_file_url)" href="#aalibrary.utils.helpers.parse_variables_from_ncei_file_url">parse_variables_from_ncei_file_url</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the file variables associated with a file url in NCEI.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.get_all_objects_in_survey_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_objects_in_survey_from_ncei</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the object keys from a ship survey from the NCEI database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the ship. Must be title-case
and have spaces substituted for underscores. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the survey. Must match what
we have in the NCEI database. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The boto3 bucket resource for
the bucket that the ship data resides in. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings. Each one being an object key (path to
the object inside of the bucket).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_objects_in_survey_from_ncei</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the object keys from a ship survey from the NCEI database.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The name of the ship. Must be title-case</span>
<span class="sd">            and have spaces substituted for underscores. Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The name of the survey. Must match what</span>
<span class="sd">            we have in the NCEI database. Defaults to &quot;&quot;.</span>
<span class="sd">        s3_bucket (boto3.resource, optional): The boto3 bucket resource for</span>
<span class="sd">            the bucket that the ship data resides in. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings. Each one being an object key (path to</span>
<span class="sd">            the object inside of the bucket).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">ship_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;Please provide a valid Titlecase&quot;</span><span class="p">,</span>
        <span class="s2">&quot; ship_name using underscores as spaces.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot; &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ship_name</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;Please provide a valid Titlecase&quot;</span><span class="p">,</span>
        <span class="s2">&quot; ship_name using underscores as spaces.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">survey_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Please provide a valid survey name.&quot;</span>
    <span class="k">assert</span> <span class="n">s3_bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Please pass in a boto3 bucket object.&quot;</span>

    <span class="n">survey_objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">s3_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">):</span>
        <span class="n">survey_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">survey_objects</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.get_all_ship_objects_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ship_objects_from_ncei</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the object keys from a ship from the NCEI database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the ship. Must be title-case
and have spaces substituted for underscores. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The boto3 bucket resource for the
bucket that the ship data resides in. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings. Each one being an object key (path to
the object inside of the bucket).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ship_objects_from_ncei</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the object keys from a ship from the NCEI database.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The name of the ship. Must be title-case</span>
<span class="sd">            and have spaces substituted for underscores. Defaults to &quot;&quot;.</span>
<span class="sd">        bucket (boto3.resource, optional): The boto3 bucket resource for the</span>
<span class="sd">            bucket that the ship data resides in. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings. Each one being an object key (path to</span>
<span class="sd">            the object inside of the bucket).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">ship_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;Please provide a valid Titlecase&quot;</span><span class="p">,</span>
        <span class="s2">&quot; ship_name using underscores as spaces.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot; &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ship_name</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;Please provide a valid Titlecase&quot;</span><span class="p">,</span>
        <span class="s2">&quot; ship_name using underscores as spaces.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Please pass in a boto3 bucket object.&quot;</span>

    <span class="n">ship_objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="n">ship_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ship_objects</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.get_file_name_from_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_name_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extracts the file name from a given storage bucket url. Includes the
file extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The full url of the storage object.
Defaults to "".
Example: "https://noaa-wcsd-pds.s3.amazonaws.com/data/raw/Reuben_La
          sker/RL2107/EK80/2107RL_CW-D20210813-T220732.raw"</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name. Example: 2107RL_CW-D20210813-T220732.raw</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file_name_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the file name from a given storage bucket url. Includes the</span>
<span class="sd">    file extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): The full url of the storage object.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">            Example: &quot;https://noaa-wcsd-pds.s3.amazonaws.com/data/raw/Reuben_La</span>
<span class="sd">                      sker/RL2107/EK80/2107RL_CW-D20210813-T220732.raw&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The file name. Example: 2107RL_CW-D20210813-T220732.raw</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.get_file_paths_via_json_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_paths_via_json_link</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>This function helps in getting the links from a json request, parsing
the contents of that url into a json object. The output is a json of the
filename, and the cloud path link (s3 bucket link).
Code from: https://www.ngdc.noaa.gov/mgg/wcd/S3_download.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The link to the json url. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file_paths_via_json_link</span><span class="p">(</span><span class="n">link</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function helps in getting the links from a json request, parsing</span>
<span class="sd">    the contents of that url into a json object. The output is a json of the</span>
<span class="sd">    filename, and the cloud path link (s3 bucket link).</span>
<span class="sd">    Code from: https://www.ngdc.noaa.gov/mgg/wcd/S3_download.html</span>

<span class="sd">    Args:</span>
<span class="sd">        link (str, optional): The link to the json url. Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">text</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;FILE_NAME&quot;</span><span class="p">]</span>
        <span class="n">cloud_path</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;CLOUD_PATH&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cloud_path</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">cloud_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.get_netcdf_gcp_location_from_raw_gcp_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_netcdf_gcp_location_from_raw_gcp_location</span><span class="p">(</span><span class="n">gcp_storage_bucket_location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the netcdf location of a raw file within GCP.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_netcdf_gcp_location_from_raw_gcp_location</span><span class="p">(</span>
    <span class="n">gcp_storage_bucket_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the netcdf location of a raw file within GCP.&quot;&quot;&quot;</span>

    <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="n">gcp_storage_bucket_location</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="s2">&quot;/raw/&quot;</span><span class="p">,</span> <span class="s2">&quot;/netcdf/&quot;</span>
    <span class="p">)</span>
    <span class="c1"># get rid of file extension and replace with netcdf</span>
    <span class="n">netcdf_gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gcp_storage_bucket_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">netcdf_gcp_storage_bucket_location</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.normalize_ship_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Normalizes a ship's name. This is necessary for creating a deterministic
file structure within our GCP storage bucket.
The ship name is returned as a Title_Cased_And_Snake_Cased ship name, with
no punctuation.
Ex. <code>HENRY B. BIGELOW</code> will return <code>Henry_B_Bigelow</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name string. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The formatted and normalized version of the ship name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalizes a ship&#39;s name. This is necessary for creating a deterministic</span>
<span class="sd">    file structure within our GCP storage bucket.</span>
<span class="sd">    The ship name is returned as a Title_Cased_And_Snake_Cased ship name, with</span>
<span class="sd">    no punctuation.</span>
<span class="sd">    Ex. `HENRY B. BIGELOW` will return `Henry_B_Bigelow`</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship name string. Defaults to &quot;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The formatted and normalized version of the ship name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Lower case the string</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">ship_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># Un-normalize (replace `_` with ` ` to help further processing)</span>
    <span class="c1"># In the edge-case that users include an underscore.</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">ship_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="c1"># Remove all punctuation.</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">ship_name</span> <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># Title-case it</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">ship_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="c1"># Snake-case it</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">ship_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ship_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.parse_correct_gcp_storage_bucket_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">is_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_survey_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the correct gcp storage location based on data source, file
type, and if the file is metadata or not.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name (includes extension).
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file type (not include the dot ".").
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name associated with this survey.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name/identifier. Defaults
to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used to gather the data.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the data. Can be one of
["NCEI", "OMAO"]. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a metadata
file. Necessary since files that are considered metadata (metadata
json, or readmes) are stored in a separate directory. Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_survey_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not the file is a
metadata file associated with a survey. The files are stored at
the survey level, in the <code>metadata/</code> folder. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>debug</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print debug statements.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The correctly parsed GCP storage bucket location.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_correct_gcp_storage_bucket_location</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">is_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">is_survey_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the correct gcp storage location based on data source, file</span>
<span class="sd">    type, and if the file is metadata or not.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str, optional): The file name (includes extension).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        file_type (str, optional): The file type (not include the dot &quot;.&quot;).</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        ship_name (str, optional): The ship name associated with this survey.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        survey_name (str, optional): The survey name/identifier. Defaults</span>
<span class="sd">            to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used to gather the data.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        data_source (str, optional): The source of the data. Can be one of</span>
<span class="sd">            [&quot;NCEI&quot;, &quot;OMAO&quot;]. Defaults to &quot;&quot;.</span>
<span class="sd">        is_metadata (bool, optional): Whether or not the file is a metadata</span>
<span class="sd">            file. Necessary since files that are considered metadata (metadata</span>
<span class="sd">            json, or readmes) are stored in a separate directory. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        is_survey_metadata (bool, optional): Whether or not the file is a</span>
<span class="sd">            metadata file associated with a survey. The files are stored at</span>
<span class="sd">            the survey level, in the `metadata/` folder. Defaults to False.</span>
<span class="sd">        debug (bool, optional): Whether or not to print debug statements.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The correctly parsed GCP storage bucket location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">is_metadata</span> <span class="ow">and</span> <span class="n">is_survey_metadata</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">is_metadata</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">is_survey_metadata</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">is_metadata</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">is_survey_metadata</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;Please make sure that only one of `is_metadata` and&quot;</span>
        <span class="s2">&quot; `is_survey_metadata` is True. Or you can set both to False.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Creating the correct upload location</span>
    <span class="k">if</span> <span class="n">is_survey_metadata</span><span class="p">:</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/metadata/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_metadata</span><span class="p">:</span>
        <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Figure out if its a raw or idx file (belongs in raw folder)</span>
        <span class="k">if</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">RAW_DATA_FILE_TYPES</span><span class="p">:</span>
            <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gcp_storage_bucket_location</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;raw/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.json&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">CONVERTED_DATA_FILE_TYPES</span><span class="p">:</span>
            <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gcp_storage_bucket_location</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;netcdf/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.json&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Figure out if its a raw or idx file (belongs in raw folder)</span>
        <span class="k">if</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">RAW_DATA_FILE_TYPES</span><span class="p">:</span>
            <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/data/raw/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">CONVERTED_DATA_FILE_TYPES</span><span class="p">:</span>
            <span class="n">gcp_storage_bucket_location</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/data/netcdf/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;PARSED GCP_STORAGE_BUCKET_LOCATION: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gcp_storage_bucket_location</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">gcp_storage_bucket_location</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.helpers.parse_variables_from_ncei_file_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_variables_from_ncei_file_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the file variables associated with a file url in NCEI.
File urls in NCEI follow this template:
data/raw/{ship_name}/{survey_name}/{echosounder}/{file_name}</p>
<p>NOTE: file_name will include the extension.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_variables_from_ncei_file_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the file variables associated with a file url in NCEI.</span>
<span class="sd">    File urls in NCEI follow this template:</span>
<span class="sd">    data/raw/{ship_name}/{survey_name}/{echosounder}/{file_name}</span>

<span class="sd">    NOTE: file_name will include the extension.&quot;&quot;&quot;</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">get_file_name_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">echosounder</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">survey_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">ship_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">echosounder</span><span class="p">,</span> <span class="n">survey_name</span><span class="p">,</span> <span class="n">ship_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.nc_reader" class="doc doc-heading">
            <code>nc_reader</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file is used to get header information out of a NetCDF file. The
code reads a .nc file and returns a dict with all of the attributes
gathered.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_netcdf_header(file_path) (aalibrary.utils.nc_reader.get_netcdf_header)" href="#aalibrary.utils.nc_reader.get_netcdf_header">get_netcdf_header</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Reads a NetCDF file and returns its header as a dictionary.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.nc_reader.get_netcdf_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_netcdf_header</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reads a NetCDF file and returns its header as a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the NetCDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing global attributes, dimensions, and</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/nc_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_netcdf_header</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a NetCDF file and returns its header as a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): Path to the NetCDF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary containing global attributes, dimensions, and</span>
<span class="sd">        variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header_info</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_file</span><span class="p">:</span>
        <span class="c1"># Extract global attributes</span>
        <span class="n">header_info</span><span class="p">[</span><span class="s2">&quot;global_attributes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">attr</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Extract dimensions</span>
        <span class="n">header_info</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dim</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_file</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">dimensions</span>
        <span class="p">}</span>

        <span class="c1"># Extract variable metadata</span>
        <span class="n">header_info</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">var</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">()</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">nc_file</span><span class="o">.</span><span class="n">variables</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">header_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.ncei_utils" class="doc doc-heading">
            <code>ncei_utils</code>


</h2>

    <div class="doc doc-contents ">

        <p>This file contains code pertaining to auxiliary functions related to parsing
through NCEI's s3 bucket.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="check_if_tugboat_metadata_json_exists_in_survey(ship_name='', survey_name='', s3_bucket=None) (aalibrary.utils.ncei_utils.check_if_tugboat_metadata_json_exists_in_survey)" href="#aalibrary.utils.ncei_utils.check_if_tugboat_metadata_json_exists_in_survey">check_if_tugboat_metadata_json_exists_in_survey</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Checks whether a Tugboat metadata JSON file exists within a survey.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_echosounders_in_a_survey(ship_name='', survey_name='', s3_client=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_echosounders_in_a_survey)" href="#aalibrary.utils.ncei_utils.get_all_echosounders_in_a_survey">get_all_echosounders_in_a_survey</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the echosounders in a particular survey from NCEI.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_echosounders_that_exist_in_NCEI(s3_client=None) (aalibrary.utils.ncei_utils.get_all_echosounders_that_exist_in_NCEI)" href="#aalibrary.utils.ncei_utils.get_all_echosounders_that_exist_in_NCEI">get_all_echosounders_that_exist_in_NCEI</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets a list of all possible echosounders from NCEI.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_file_names_from_survey(ship_name='', survey_name='', s3_resource=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_file_names_from_survey)" href="#aalibrary.utils.ncei_utils.get_all_file_names_from_survey">get_all_file_names_from_survey</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the file names from a particular NCEI survey.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_metadata_files_in_survey(ship_name='', survey_name='', s3_resource=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_metadata_files_in_survey)" href="#aalibrary.utils.ncei_utils.get_all_metadata_files_in_survey">get_all_metadata_files_in_survey</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the metadata file names from a particular NCEI survey.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_raw_file_names_from_survey(ship_name='', survey_name='', echosounder='', s3_resource=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_raw_file_names_from_survey)" href="#aalibrary.utils.ncei_utils.get_all_raw_file_names_from_survey">get_all_raw_file_names_from_survey</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the file names from a particular NCEI survey.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_ship_names_in_ncei(normalize=False, s3_client=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_ship_names_in_ncei)" href="#aalibrary.utils.ncei_utils.get_all_ship_names_in_ncei">get_all_ship_names_in_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets all of the ship names from NCEI. This is based on all of the</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_survey_names_from_a_ship(ship_name='', s3_client=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_survey_names_from_a_ship)" href="#aalibrary.utils.ncei_utils.get_all_survey_names_from_a_ship">get_all_survey_names_from_a_ship</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets a list of all of the survey names that exist under a ship name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_all_surveys_in_ncei(s3_client=None, return_full_paths=False) (aalibrary.utils.ncei_utils.get_all_surveys_in_ncei)" href="#aalibrary.utils.ncei_utils.get_all_surveys_in_ncei">get_all_surveys_in_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets a list of all of the possible survey names from NCEI.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_closest_ncei_formatted_ship_name(ship_name='') (aalibrary.utils.ncei_utils.get_closest_ncei_formatted_ship_name)" href="#aalibrary.utils.ncei_utils.get_closest_ncei_formatted_ship_name">get_closest_ncei_formatted_ship_name</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the closest NCEI formatted ship name to the given ship name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_echosounder_from_raw_file(file_name='', ship_name='', survey_name='', echosounders=None, s3_client=None, s3_resource=None, s3_bucket=None) (aalibrary.utils.ncei_utils.get_echosounder_from_raw_file)" href="#aalibrary.utils.ncei_utils.get_echosounder_from_raw_file">get_echosounder_from_raw_file</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Gets the echosounder used for a particular raw file.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_random_raw_file_from_ncei() (aalibrary.utils.ncei_utils.get_random_raw_file_from_ncei)" href="#aalibrary.utils.ncei_utils.get_random_raw_file_from_ncei">get_random_raw_file_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a test raw file for NCEI. This is used for testing purposes</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.check_if_tugboat_metadata_json_exists_in_survey" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_if_tugboat_metadata_json_exists_in_survey</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks whether a Tugboat metadata JSON file exists within a survey.
Returns the file's object key or None if it does not exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name exactly as it is in NCEI.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_bucket</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bucket resource object.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    Union[str, None]: Returns the file's object key string or None if it does not exist.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_if_tugboat_metadata_json_exists_in_survey</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks whether a Tugboat metadata JSON file exists within a survey.</span>
<span class="sd">    Returns the file&#39;s object key or None if it does not exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        survey_name (str, optional): The survey name exactly as it is in NCEI.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        s3_bucket (boto3.resource, optional): The bucket resource object.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Union[str, None]: Returns the file&#39;s object key string or None if it does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Find all metadata files within the metadata/ folder in NCEI</span>
    <span class="n">all_metadata_obj_keys</span> <span class="o">=</span> <span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/metadata&quot;</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_bucket</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">all_metadata_obj_keys</span><span class="p">:</span>
        <span class="c1"># Handle for main metadata file for upload to BigQuery.</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;metadata.json&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj_key</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_echosounders_in_a_survey" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_echosounders_in_a_survey</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the echosounders in a particular survey from NCEI.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name exactly as it is in NCEI.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client used to perform this
operation. Defaults to None, but creates a client for you instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the echosounder name. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_echosounders_in_a_survey</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the echosounders in a particular survey from NCEI.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        survey_name (str, optional): The survey name exactly as it is in NCEI.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        s3_client (boto3.client, optional): The client used to perform this</span>
<span class="sd">            operation. Defaults to None, but creates a client for you instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the echosounder name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">survey_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">all_survey_folder_names</span> <span class="o">=</span> <span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">survey_prefix</span><span class="p">,</span>
        <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
        <span class="n">bucket_name</span><span class="o">=</span><span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Get echosounder folders by ignoring the other metadata folders</span>
    <span class="n">all_echosounders</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">folder_name</span> <span class="ow">in</span> <span class="n">all_survey_folder_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;calibration&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">folder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">folder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;json&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">folder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;doc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">folder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="n">all_echosounders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_echosounders</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_echosounders_that_exist_in_NCEI" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_echosounders_that_exist_in_NCEI</span><span class="p">(</span><span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all possible echosounders from NCEI.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client used to perform this
operation. Defaults to None, but creates a client for you instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the echosounder name. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_echosounders_that_exist_in_NCEI</span><span class="p">(</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets a list of all possible echosounders from NCEI.</span>

<span class="sd">    Args:</span>
<span class="sd">        s3_client (boto3.client, optional): The client used to perform this</span>
<span class="sd">            operation. Defaults to None, but creates a client for you instead.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the echosounder name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create client objects if they dont exist.</span>
    <span class="k">if</span> <span class="n">s3_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="c1"># First we get all of the prefixes for each survey to exist in NCEI.</span>
    <span class="n">all_survey_prefixes</span> <span class="o">=</span> <span class="n">get_all_surveys_in_ncei</span><span class="p">(</span>
        <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">all_echosounders</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">survey_prefix</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_survey_prefixes</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Getting Echosounders&quot;</span><span class="p">):</span>
        <span class="c1"># Remove trailing `/`</span>
        <span class="n">survey_prefix</span> <span class="o">=</span> <span class="n">survey_prefix</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">survey_name</span> <span class="o">=</span> <span class="n">survey_prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ship_name</span> <span class="o">=</span> <span class="n">survey_prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">survey_echosounders</span> <span class="o">=</span> <span class="n">get_all_echosounders_in_a_survey</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_echosounders</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">survey_echosounders</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_echosounders</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_file_names_from_survey" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_file_names_from_survey</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the file names from a particular NCEI survey.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name exactly as it is in NCEI.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_resource</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resource used to perform
this operation. Defaults to None, but creates a client for you
instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the echosounder name. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_file_names_from_survey</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the file names from a particular NCEI survey.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        survey_name (str, optional): The survey name exactly as it is in NCEI.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        s3_resource (boto3.resource, optional): The resource used to perform</span>
<span class="sd">            this operation. Defaults to None, but creates a client for you</span>
<span class="sd">            instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the echosounder name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">survey_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">survey_prefix</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">all_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_metadata_files_in_survey" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_metadata_files_in_survey</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the metadata file names from a particular NCEI survey.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name exactly as it is in NCEI.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_resource</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resource used to perform
this operation. Defaults to None, but creates a client for you
instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the metadata file name. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter. Returns empty list '[]' if no metadata
files are present.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_metadata_files_in_survey</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the metadata file names from a particular NCEI survey.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        survey_name (str, optional): The survey name exactly as it is in NCEI.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        s3_resource (boto3.resource, optional): The resource used to perform</span>
<span class="sd">            this operation. Defaults to None, but creates a client for you</span>
<span class="sd">            instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the metadata file name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter. Returns empty list &#39;[]&#39; if no metadata</span>
<span class="sd">            files are present.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">survey_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/metadata/&quot;</span>
    <span class="n">all_metadata_files</span> <span class="o">=</span> <span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">survey_prefix</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">all_metadata_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_raw_file_names_from_survey" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_raw_file_names_from_survey</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the file names from a particular NCEI survey.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>survey_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The survey name exactly as it is in NCEI.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>echosounder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The echosounder used. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_resource</code>
            </td>
            <td>
                  <code><span title="boto3.resource">resource</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resource used to perform
this operation. Defaults to None, but creates a client for you
instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of strings, each being the raw file name. Whether
these are full paths or just folder names are specified by the
<code>return_full_paths</code> parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_raw_file_names_from_survey</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the file names from a particular NCEI survey.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        survey_name (str, optional): The survey name exactly as it is in NCEI.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>
<span class="sd">        echosounder (str, optional): The echosounder used. Defaults to &quot;&quot;.</span>
<span class="sd">        s3_resource (boto3.resource, optional): The resource used to perform</span>
<span class="sd">            this operation. Defaults to None, but creates a client for you</span>
<span class="sd">            instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the raw file name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">survey_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="n">list_all_objects_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">survey_prefix</span><span class="p">,</span>
        <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.raw&quot;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">all_files</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_ship_names_in_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_ship_names_in_ncei</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets all of the ship names from NCEI. This is based on all of the
folders listed under the <code>data/raw/</code> prefix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to normalize the ship_name
attribute to how GCP stores it. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client used to perform this
operation. Defaults to None, but creates a client for you instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_ship_names_in_ncei</span><span class="p">(</span>
    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all of the ship names from NCEI. This is based on all of the</span>
<span class="sd">    folders listed under the `data/raw/` prefix.</span>

<span class="sd">    Args:</span>
<span class="sd">        normalize (bool, optional): Whether or not to normalize the ship_name</span>
<span class="sd">            attribute to how GCP stores it. Defaults to False.</span>
<span class="sd">        s3_client (boto3.client, optional): The client used to perform this</span>
<span class="sd">            operation. Defaults to None, but creates a client for you instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create client objects if they dont exist.</span>
    <span class="k">if</span> <span class="n">s3_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="c1"># Get the initial subdirs</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;data/raw/&quot;</span>
    <span class="n">subdirs</span> <span class="o">=</span> <span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">subdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">normalize_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="n">subdir</span><span class="p">)</span> <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">subdirs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_survey_names_from_a_ship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_survey_names_from_a_ship</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all of the survey names that exist under a ship name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship's name you want to get all surveys
from. Defaults to None.
NOTE: The ship's name MUST be spelled exactly as it is in NCEI. Use
the <code>get_all_ship_names_in_ncei</code> function to see all possible NCEI
ship names.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client used to perform this
operation. Defaults to None, but creates a client for you instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    List[str]: A list of strings, each being the survey name. Whether
        these are full paths or just folder names are specified by the
        <code>return_full_paths</code> parameter.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_survey_names_from_a_ship</span><span class="p">(</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets a list of all of the survey names that exist under a ship name.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship&#39;s name you want to get all surveys</span>
<span class="sd">            from. Defaults to None.</span>
<span class="sd">            NOTE: The ship&#39;s name MUST be spelled exactly as it is in NCEI. Use</span>
<span class="sd">            the `get_all_ship_names_in_ncei` function to see all possible NCEI</span>
<span class="sd">            ship names.</span>
<span class="sd">        s3_client (boto3.client, optional): The client used to perform this</span>
<span class="sd">            operation. Defaults to None, but creates a client for you instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the survey name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create client objects if they dont exist.</span>
    <span class="k">if</span> <span class="n">s3_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="c1"># Make sure the ship name is valid</span>
    <span class="n">all_ship_names</span> <span class="o">=</span> <span class="n">get_all_ship_names_in_ncei</span><span class="p">(</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ship_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_ship_names</span><span class="p">:</span>
        <span class="n">close_matches</span> <span class="o">=</span> <span class="n">get_close_matches</span><span class="p">(</span><span class="n">ship_name</span><span class="p">,</span> <span class="n">all_ship_names</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ship_name</span> <span class="ow">in</span> <span class="n">all_ship_names</span><span class="p">,</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;The ship name provided `</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">` &quot;</span>
        <span class="s2">&quot;needs to be spelled exactly like in NCEI.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Use the `get_all_ship_names_in_ncei` function to see all possible &quot;</span>
        <span class="s2">&quot;NCEI ship names.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Did you mean one of these possible ship names?</span><span class="se">\n</span><span class="si">{</span><span class="n">close_matches</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">ship_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">all_surveys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># Get a list of all of this ship&#39;s survey names</span>
    <span class="n">all_ship_survey_names</span> <span class="o">=</span> <span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">ship_prefix</span><span class="p">,</span>
        <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span>
        <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
        <span class="n">bucket_name</span><span class="o">=</span><span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">all_surveys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_ship_survey_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_surveys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_all_surveys_in_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_surveys_in_ncei</span><span class="p">(</span><span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all of the possible survey names from NCEI.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s3_client</code>
            </td>
            <td>
                  <code><span title="boto3.client">client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client used to perform this
operation. Defaults to None, but creates a client for you instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_full_paths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not you want a full
path from bucket root to the subdirectory returned. Set to false
if you only want the subdirectory names listed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    List[str]: A list of strings, each being the survey name. Whether
        these are full paths or just folder names are specified by the
        <code>return_full_paths</code> parameter.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_surveys_in_ncei</span><span class="p">(</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets a list of all of the possible survey names from NCEI.</span>

<span class="sd">    Args:</span>
<span class="sd">        s3_client (boto3.client, optional): The client used to perform this</span>
<span class="sd">            operation. Defaults to None, but creates a client for you instead.</span>
<span class="sd">        return_full_paths (bool, optional): Whether or not you want a full</span>
<span class="sd">            path from bucket root to the subdirectory returned. Set to false</span>
<span class="sd">            if you only want the subdirectory names listed. Defaults to False.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of strings, each being the survey name. Whether</span>
<span class="sd">            these are full paths or just folder names are specified by the</span>
<span class="sd">            `return_full_paths` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create client objects if they dont exist.</span>
    <span class="k">if</span> <span class="n">s3_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="c1"># First we get all of the prefixes for each ship.</span>
    <span class="n">all_ship_prefixes</span> <span class="o">=</span> <span class="n">get_all_ship_names_in_ncei</span><span class="p">(</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">all_surveys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ship_prefix</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_ship_prefixes</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Getting Surveys&quot;</span><span class="p">):</span>
        <span class="c1"># Get a list of all of this ship&#39;s survey names</span>
        <span class="n">all_ship_survey_names</span> <span class="o">=</span> <span class="n">get_subdirectories_in_s3_bucket_location</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">ship_prefix</span><span class="p">,</span>
            <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="n">return_full_paths</span><span class="p">,</span>
            <span class="n">bucket_name</span><span class="o">=</span><span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_surveys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_ship_survey_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_surveys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_closest_ncei_formatted_ship_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_closest_ncei_formatted_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the closest NCEI formatted ship name to the given ship name.
NOTE: Only use if the <code>data_source</code>=="NCEI".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ship_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ship name to search the closest match for.
Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[str, None]: The NCEI formatted ship name or None, if none matched.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_closest_ncei_formatted_ship_name</span><span class="p">(</span><span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the closest NCEI formatted ship name to the given ship name.</span>
<span class="sd">    NOTE: Only use if the `data_source`==&quot;NCEI&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        ship_name (str, optional): The ship name to search the closest match for.</span>
<span class="sd">            Defaults to &quot;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[str, None]: The NCEI formatted ship name or None, if none matched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_ship_names</span> <span class="o">=</span> <span class="n">get_all_ship_names_in_ncei</span><span class="p">(</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">close_matches</span> <span class="o">=</span> <span class="n">get_close_matches</span><span class="p">(</span><span class="n">ship_name</span><span class="p">,</span> <span class="n">all_ship_names</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">close_matches</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">close_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_echosounder_from_raw_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_echosounder_from_raw_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ship_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">echosounders</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s3_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s3_resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the echosounder used for a particular raw file.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_echosounder_from_raw_file</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ship_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">survey_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">echosounders</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">s3_client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">s3_resource</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">s3_bucket</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the echosounder used for a particular raw file.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">s3_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">s3_resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">s3_bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">s3_client</span><span class="p">,</span> <span class="n">s3_resource</span><span class="p">,</span> <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">create_s3_objs</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">echosounders</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">echosounders</span> <span class="o">=</span> <span class="n">get_all_echosounders_in_a_survey</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">survey_name</span><span class="p">,</span>
            <span class="n">s3_client</span><span class="o">=</span><span class="n">s3_client</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">echosounder</span> <span class="ow">in</span> <span class="n">echosounders</span><span class="p">:</span>
        <span class="n">raw_file_location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;data/raw/</span><span class="si">{</span><span class="n">ship_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">survey_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">echosounder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">raw_file_exists</span> <span class="o">=</span> <span class="n">check_if_file_exists_in_s3</span><span class="p">(</span>
            <span class="n">object_key</span><span class="o">=</span><span class="n">raw_file_location</span><span class="p">,</span>
            <span class="n">s3_resource</span><span class="o">=</span><span class="n">s3_resource</span><span class="p">,</span>
            <span class="n">s3_bucket_name</span><span class="o">=</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">raw_file_exists</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">echosounder</span>

    <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An echosounder could not be found for this raw file.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.ncei_utils.get_random_raw_file_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_random_raw_file_from_ncei</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a test raw file for NCEI. This is used for testing purposes
only. Retries automatically if an error occurs.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list object with strings denoting each parameter required
for creating a raw file object.
Ex. [
    random_ship_name,
    random_survey_name,
    random_echosounder,
    random_raw_file,
]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/ncei_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_random_raw_file_from_ncei</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a test raw file for NCEI. This is used for testing purposes</span>
<span class="sd">    only. Retries automatically if an error occurs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list object with strings denoting each parameter required</span>
<span class="sd">            for creating a raw file object.</span>
<span class="sd">            Ex. [</span>
<span class="sd">                random_ship_name,</span>
<span class="sd">                random_survey_name,</span>
<span class="sd">                random_echosounder,</span>
<span class="sd">                random_raw_file,</span>
<span class="sd">            ]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get all of the ship names</span>
        <span class="n">all_ship_names</span> <span class="o">=</span> <span class="n">get_all_ship_names_in_ncei</span><span class="p">(</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">random_ship_name</span> <span class="o">=</span> <span class="n">all_ship_names</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_ship_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="c1"># Get all of the surveys for this ship</span>
        <span class="n">all_surveys_for_this_ship</span> <span class="o">=</span> <span class="n">get_all_survey_names_from_a_ship</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">random_ship_name</span><span class="p">,</span> <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">random_survey_name</span> <span class="o">=</span> <span class="n">all_surveys_for_this_ship</span><span class="p">[</span>
            <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_surveys_for_this_ship</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Get all of the echosounders in this survey</span>
        <span class="n">all_echosounders_for_this_survey</span> <span class="o">=</span> <span class="n">get_all_echosounders_in_a_survey</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">random_ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">random_survey_name</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">random_echosounder</span> <span class="o">=</span> <span class="n">all_echosounders_for_this_survey</span><span class="p">[</span>
            <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_echosounders_for_this_survey</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Get all of the raw files in this echosounder</span>
        <span class="n">all_raw_files_in_echosounder</span> <span class="o">=</span> <span class="n">get_all_raw_file_names_from_survey</span><span class="p">(</span>
            <span class="n">ship_name</span><span class="o">=</span><span class="n">random_ship_name</span><span class="p">,</span>
            <span class="n">survey_name</span><span class="o">=</span><span class="n">random_survey_name</span><span class="p">,</span>
            <span class="n">echosounder</span><span class="o">=</span><span class="n">random_echosounder</span><span class="p">,</span>
            <span class="n">return_full_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">random_raw_file</span> <span class="o">=</span> <span class="n">all_raw_files_in_echosounder</span><span class="p">[</span>
            <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_raw_files_in_echosounder</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">random_ship_name</span><span class="p">,</span>
            <span class="n">random_survey_name</span><span class="p">,</span>
            <span class="n">random_echosounder</span><span class="p">,</span>
            <span class="n">random_raw_file</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_random_raw_file_from_ncei</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.sonar_checker" class="doc doc-heading">
            <code>sonar_checker</code>


</h2>

    <div class="doc doc-contents ">






<p><span class="doc-section-title">Modules:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ek_date_conversion (aalibrary.utils.sonar_checker.ek_date_conversion)" href="#aalibrary.utils.sonar_checker.ek_date_conversion">ek_date_conversion</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Code originally developed for pyEcholab</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ek_raw_io (aalibrary.utils.sonar_checker.ek_raw_io)" href="#aalibrary.utils.sonar_checker.ek_raw_io">ek_raw_io</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Code originally developed for pyEcholab</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="ek_raw_parsers (aalibrary.utils.sonar_checker.ek_raw_parsers)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers">ek_raw_parsers</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Code originally developed for pyEcholab</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="log (aalibrary.utils.sonar_checker.log)" href="#aalibrary.utils.sonar_checker.log">log</a></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="misc (aalibrary.utils.sonar_checker.misc)" href="#aalibrary.utils.sonar_checker.misc">misc</a></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="sonar_checker (aalibrary.utils.sonar_checker.sonar_checker)" href="#aalibrary.utils.sonar_checker.sonar_checker">sonar_checker</a></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.ek_date_conversion" class="doc doc-heading">
            <code>ek_date_conversion</code>


</h3>

    <div class="doc doc-contents ">

        <p>Code originally developed for pyEcholab
(https://github.com/CI-CMG/pyEcholab)
by Rick Towler <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;">&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;</a> at NOAA AFSC.</p>
<p>Contains functions to convert date information.</p>
<p>TODO: merge necessary function into ek60.py or group everything into a class
TODO: fix docstring</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="nt_to_unix(nt_timestamp_tuple, return_datetime=True) (aalibrary.utils.sonar_checker.ek_date_conversion.nt_to_unix)" href="#aalibrary.utils.sonar_checker.ek_date_conversion.nt_to_unix">nt_to_unix</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>:param nt_timestamp_tuple: Tuple of two longs representing the NT date</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="unix_to_nt(unix_timestamp) (aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt)" href="#aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt">unix_to_nt</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Given a date, return the 2-element tuple used for timekeeping with SIMRAD echosounders</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.ek_date_conversion.datetime_to_unix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">datetime_to_unix</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>:param datetime_obj: datetime object to convert
:type datetime_obj: :class:<code>datetime.datetime</code></p>
<p>:param tz: Timezone to use for converted time -- if None, uses timezone
            information contained within datetime_obj
:type tz: :class:datetime.tzinfo</p>
<blockquote>
<blockquote>
<blockquote>
<p>from pytz import utc
from datetime import datetime
epoch = datetime(1970, 1, 1, tzinfo=utc)
assert datetime_to_unix(epoch) == 0</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_date_conversion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">datetime_to_unix</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param datetime_obj: datetime object to convert</span>
<span class="sd">    :type datetime_obj: :class:`datetime.datetime`</span>

<span class="sd">    :param tz: Timezone to use for converted time -- if None, uses timezone</span>
<span class="sd">                information contained within datetime_obj</span>
<span class="sd">    :type tz: :class:datetime.tzinfo</span>

<span class="sd">    &gt;&gt;&gt; from pytz import utc</span>
<span class="sd">    &gt;&gt;&gt; from datetime import datetime</span>
<span class="sd">    &gt;&gt;&gt; epoch = datetime(1970, 1, 1, tzinfo=utc)</span>
<span class="sd">    &gt;&gt;&gt; assert datetime_to_unix(epoch) == 0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime_obj</span> <span class="o">-</span> <span class="n">UTC_UNIX_EPOCH</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">timestamp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.ek_date_conversion.nt_to_unix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nt_to_unix</span><span class="p">(</span><span class="n">nt_timestamp_tuple</span><span class="p">,</span> <span class="n">return_datetime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>:param nt_timestamp_tuple: Tuple of two longs representing the NT date
:type nt_timestamp_tuple: (long, long)</p>
<p>:param return_datetime:  Return a datetime object instead of float
:type return_datetime: bool</p>
<p>Returns a datetime.datetime object w/ UTC timezone
calculated from the nt time tuple</p>
<p>lowDateTime, highDateTime = nt_timestamp_tuple</p>
<p>The timestamp is a 64bit count of 100ns intervals since the NT epoch
broken into two 32bit longs, least significant first:</p>
<blockquote>
<blockquote>
<blockquote>
<p>dt = nt_to_unix((19496896L, 30196149L))
match_dt = datetime.datetime(2011, 12, 23, 20, 54, 3, 964000, pytz_utc)
assert abs(dt - match_dt) &lt;= dt.resolution</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_date_conversion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nt_to_unix</span><span class="p">(</span><span class="n">nt_timestamp_tuple</span><span class="p">,</span> <span class="n">return_datetime</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param nt_timestamp_tuple: Tuple of two longs representing the NT date</span>
<span class="sd">    :type nt_timestamp_tuple: (long, long)</span>

<span class="sd">    :param return_datetime:  Return a datetime object instead of float</span>
<span class="sd">    :type return_datetime: bool</span>


<span class="sd">    Returns a datetime.datetime object w/ UTC timezone</span>
<span class="sd">    calculated from the nt time tuple</span>

<span class="sd">    lowDateTime, highDateTime = nt_timestamp_tuple</span>

<span class="sd">    The timestamp is a 64bit count of 100ns intervals since the NT epoch</span>
<span class="sd">    broken into two 32bit longs, least significant first:</span>

<span class="sd">    &gt;&gt;&gt; dt = nt_to_unix((19496896L, 30196149L))</span>
<span class="sd">    &gt;&gt;&gt; match_dt = datetime.datetime(2011, 12, 23, 20, 54, 3, 964000, pytz_utc)</span>
<span class="sd">    &gt;&gt;&gt; assert abs(dt - match_dt) &lt;= dt.resolution</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lowDateTime</span><span class="p">,</span> <span class="n">highDateTime</span> <span class="o">=</span> <span class="n">nt_timestamp_tuple</span>
    <span class="n">sec_past_nt_epoch</span> <span class="o">=</span> <span class="p">((</span><span class="n">highDateTime</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">lowDateTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0e-7</span>

    <span class="k">if</span> <span class="n">return_datetime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">UTC_NT_EPOCH</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">sec_past_nt_epoch</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">sec_past_unix_epoch</span> <span class="o">=</span> <span class="n">sec_past_nt_epoch</span> <span class="o">-</span> <span class="n">EPOCH_DELTA_SECONDS</span>
        <span class="k">return</span> <span class="n">sec_past_unix_epoch</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_datetime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unix_to_datetime</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>:param unix_timestamp: Number of seconds since unix epoch (1/1/1970)
:type unix_timestamp: float</p>
<p>:param tz: timezone to use for conversion (default None = UTC)
:type tz: None or tzinfo object (see datetime docs)</p>
<p>:returns: datetime object
:raises: ValueError if unix_timestamp is not of type float or datetime</p>
<p>Returns a datetime object from a unix timestamp.  Simple wrapper for
:func:<code>datetime.datetime.fromtimestamp</code></p>
<blockquote>
<blockquote>
<blockquote>
<p>from pytz import utc
from datetime import datetime
epoch = unix_to_datetime(0.0, tz=utc)
assert epoch == datetime(1970, 1, 1, tzinfo=utc)</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_date_conversion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unix_to_datetime</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param unix_timestamp: Number of seconds since unix epoch (1/1/1970)</span>
<span class="sd">    :type unix_timestamp: float</span>

<span class="sd">    :param tz: timezone to use for conversion (default None = UTC)</span>
<span class="sd">    :type tz: None or tzinfo object (see datetime docs)</span>

<span class="sd">    :returns: datetime object</span>
<span class="sd">    :raises: ValueError if unix_timestamp is not of type float or datetime</span>

<span class="sd">    Returns a datetime object from a unix timestamp.  Simple wrapper for</span>
<span class="sd">    :func:`datetime.datetime.fromtimestamp`</span>

<span class="sd">    &gt;&gt;&gt; from pytz import utc</span>
<span class="sd">    &gt;&gt;&gt; from datetime import datetime</span>
<span class="sd">    &gt;&gt;&gt; epoch = unix_to_datetime(0.0, tz=utc)</span>
<span class="sd">    &gt;&gt;&gt; assert epoch == datetime(1970, 1, 1, tzinfo=utc)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">unix_timestamp</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">pytz_utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">unix_timestamp</span><span class="o">.</span><span class="n">tzinfo</span> <span class="o">==</span> <span class="n">pytz_utc</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">unix_timestamp</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">pytz_utc</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz_utc</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">pytz_utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;Looking for a timestamp of type datetime.datetime or # of sec past unix epoch.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;Supplied timestamp &#39;</span><span class="si">%s</span><span class="s2">&#39; of type </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">),</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">unix_datetime</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unix_to_nt</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Given a date, return the 2-element tuple used for timekeeping with SIMRAD echosounders</p>
<h5 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--simple-conversion">Simple conversion</h5>
<blockquote>
<blockquote>
<blockquote>
<p>dt = datetime.datetime(2011, 12, 23, 20, 54, 3, 964000, pytz_utc)
assert (19496896L, 30196149L) == unix_to_nt(dt)</p>
</blockquote>
</blockquote>
</blockquote>
<h5 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-and-forth-between-the-two-standards">Converting back and forth between the two standards:</h5>
<blockquote>
<blockquote>
<blockquote>
<p>orig_dt = datetime.datetime.now(tz=pytz_utc)
nt_tuple = unix_to_nt(orig_dt)</p>
</blockquote>
</blockquote>
</blockquote>
<h5 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--converting-back-may-not-yield-the-exact-original-date">converting back may not yield the exact original date,</h5>
<h5 id="aalibrary.utils.sonar_checker.ek_date_conversion.unix_to_nt--but-will-be-within-the-datetimes-precision">but will be within the datetime's precision</h5>
<blockquote>
<blockquote>
<blockquote>
<p>back_to_dt = nt_to_unix(nt_tuple)
d_mu_seconds = abs(orig_dt - back_to_dt).microseconds
mu_sec_resolution = orig_dt.resolution.microseconds
assert d_mu_seconds &lt;= mu_sec_resolution</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_date_conversion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unix_to_nt</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a date, return the 2-element tuple used for timekeeping with SIMRAD echosounders</span>


<span class="sd">    #Simple conversion</span>
<span class="sd">    &gt;&gt;&gt; dt = datetime.datetime(2011, 12, 23, 20, 54, 3, 964000, pytz_utc)</span>
<span class="sd">    &gt;&gt;&gt; assert (19496896L, 30196149L) == unix_to_nt(dt)</span>

<span class="sd">    #Converting back and forth between the two standards:</span>
<span class="sd">    &gt;&gt;&gt; orig_dt = datetime.datetime.now(tz=pytz_utc)</span>
<span class="sd">    &gt;&gt;&gt; nt_tuple = unix_to_nt(orig_dt)</span>

<span class="sd">    #converting back may not yield the exact original date,</span>
<span class="sd">    #but will be within the datetime&#39;s precision</span>
<span class="sd">    &gt;&gt;&gt; back_to_dt = nt_to_unix(nt_tuple)</span>
<span class="sd">    &gt;&gt;&gt; d_mu_seconds = abs(orig_dt - back_to_dt).microseconds</span>
<span class="sd">    &gt;&gt;&gt; mu_sec_resolution = orig_dt.resolution.microseconds</span>
<span class="sd">    &gt;&gt;&gt; assert d_mu_seconds &lt;= mu_sec_resolution</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">unix_timestamp</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">pytz_utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">unix_timestamp</span><span class="o">.</span><span class="n">tzinfo</span> <span class="o">==</span> <span class="n">pytz_utc</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">unix_timestamp</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">pytz_utc</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz_utc</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">unix_datetime</span> <span class="o">=</span> <span class="n">unix_to_datetime</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">)</span>

    <span class="n">sec_past_nt_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">unix_datetime</span> <span class="o">-</span> <span class="n">UTC_NT_EPOCH</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="n">onehundred_ns_intervals</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec_past_nt_epoch</span> <span class="o">*</span> <span class="mf">1e7</span><span class="p">)</span>
    <span class="n">lowDateTime</span> <span class="o">=</span> <span class="n">onehundred_ns_intervals</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span>
    <span class="n">highDateTime</span> <span class="o">=</span> <span class="n">onehundred_ns_intervals</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span>

    <span class="k">return</span> <span class="n">lowDateTime</span><span class="p">,</span> <span class="n">highDateTime</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.ek_raw_io" class="doc doc-heading">
            <code>ek_raw_io</code>


</h3>

    <div class="doc doc-contents ">

        <p>Code originally developed for pyEcholab
(https://github.com/CI-CMG/pyEcholab)
by Rick Towler <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;">&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;</a> at NOAA AFSC.</p>
<p>Contains low-level functions called by ./ek_raw_parsers.py</p>








<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="RawSimradFile (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile">RawSimradFile</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>A low-level extension of the built in python file object allowing the reading/writing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile" class="doc doc-heading">
            <code>RawSimradFile</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="io.BufferedReader">BufferedReader</span></code></p>


        <p>A low-level extension of the built in python file object allowing the reading/writing
of SIMRAD RAW files on datagram by datagram basis (instead of at the byte level.)</p>
<p>Calls to the read method return parse datagrams as dicts.</p>










<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="__next__() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.__next__)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.__next__">__next__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Returns the next datagram (synonymous with self.read(1))</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="iter_dgrams() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.iter_dgrams)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.iter_dgrams">iter_dgrams</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Iterates through the file, repeatedly calling self.next() until</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="peek() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.peek)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.peek">peek</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Returns the header of the next datagram in the file.  The file position is</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="prev() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.prev)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.prev">prev</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Returns the previous datagram 'behind' the current file pointer position</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="read(k) (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.read)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.read">read</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>:param k: Number of datagrams to read</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="readall() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readall)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readall">readall</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Reads the entire file from the beginning and returns a list of datagrams.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="readline() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readline)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readline">readline</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>aliased to self.next()</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="readlines() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readlines)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readlines">readlines</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>aliased to self.read(-1)</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="seek(offset, whence) (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.seek)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.seek">seek</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Performs the familiar 'seek' operation using datagram offsets</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="skip() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip">skip</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Skips forward to the next datagram without reading the contents of the current one</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="skip_back() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip_back)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip_back">skip_back</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Skips backwards to the previous datagram without reading it's contents</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="tell() (aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.tell)" href="#aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.tell">tell</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Returns the current file pointer offset by datagram number</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>



              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RawSimradFile</span><span class="p">(</span><span class="n">BufferedReader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A low-level extension of the built in python file object allowing the reading/writing</span>
<span class="sd">    of SIMRAD RAW files on datagram by datagram basis (instead of at the byte level.)</span>

<span class="sd">    Calls to the read method return parse datagrams as dicts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Dict object with datagram header/python class key/value pairs</span>
    <span class="n">DGRAM_TYPE_KEY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;RAW&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradRawParser</span><span class="p">(),</span>
        <span class="s2">&quot;CON&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradConfigParser</span><span class="p">(),</span>
        <span class="s2">&quot;TAG&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradAnnotationParser</span><span class="p">(),</span>
        <span class="s2">&quot;NME&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradNMEAParser</span><span class="p">(),</span>
        <span class="s2">&quot;BOT&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradBottomParser</span><span class="p">(),</span>
        <span class="s2">&quot;DEP&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradDepthParser</span><span class="p">(),</span>
        <span class="s2">&quot;XML&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradXMLParser</span><span class="p">(),</span>
        <span class="s2">&quot;IDX&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradIDXParser</span><span class="p">(),</span>
        <span class="s2">&quot;FIL&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradFILParser</span><span class="p">(),</span>
        <span class="s2">&quot;MRU&quot;</span><span class="p">:</span> <span class="n">parsers</span><span class="o">.</span><span class="n">SimradMRUParser</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span>
        <span class="n">closefd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">return_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">storage_options</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>
        <span class="c1">#  9-28-18 RHT: Changed RawSimradFile to implement BufferedReader instead of</span>
        <span class="c1">#  io.FileIO to increase performance.</span>

        <span class="c1">#  create a raw file object for the buffered reader</span>
        <span class="n">fmap</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">storage_options</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmap</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">LocalFileSystem</span><span class="p">):</span>
            <span class="n">fio</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">closefd</span><span class="o">=</span><span class="n">closefd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fio</span> <span class="o">=</span> <span class="n">fmap</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fmap</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="c1">#  initialize the superclass</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fio</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_return_raw</span> <span class="o">=</span> <span class="n">return_raw</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_seek_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bytes_</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bytes_: byte offset</span>
<span class="sd">        :type bytes_: int</span>

<span class="sd">        :param whence:</span>

<span class="sd">        Seeks a file by bytes instead of datagrams.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">bytes_</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_tell_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the file pointer position in bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_dgram_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to read the size of the next datagram in the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">DatagramReadError</span><span class="p">(</span>
                <span class="s2">&quot;Short read while getting dgram size&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)),</span>
                <span class="n">file_pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;=l&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># This return value is an int object.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_bytes_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">)</span>
        <span class="n">end_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">end_pos</span> <span class="o">-</span> <span class="n">old_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">offset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to read the datagram timestamp.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">DatagramReadError</span><span class="p">(</span>
                <span class="s2">&quot;Short read while getting timestamp&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)),</span>
                <span class="n">file_pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">lowDateField</span><span class="p">,</span> <span class="n">highDateField</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;=2L&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
            <span class="c1">#  11/26/19 - RHT - modified to return the raw bytes</span>
            <span class="k">return</span> <span class="n">lowDateField</span><span class="p">,</span> <span class="n">highDateField</span><span class="p">,</span> <span class="n">buf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_dgram_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: dgram_size, dgram_type, (low_date, high_date)</span>

<span class="sd">        Attempts to read the datagram header consisting of:</span>

<span class="sd">            long        dgram_size</span>
<span class="sd">            char[4]     type</span>
<span class="sd">            long        lowDateField</span>
<span class="sd">            long        highDateField</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">dgram_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_eof</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">SimradEOF</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="c1">#  get the datagram type</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_eof</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">SimradEOF</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">DatagramReadError</span><span class="p">(</span>
                    <span class="s2">&quot;Short read while getting dgram type&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)),</span>
                    <span class="n">file_pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dgram_type</span> <span class="o">=</span> <span class="n">buf</span>
        <span class="n">dgram_type</span> <span class="o">=</span> <span class="n">dgram_type</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

        <span class="c1">#  11/26/19 - RHT</span>
        <span class="c1">#  As part of the rewrite of read to remove the reverse seeking,</span>
        <span class="c1">#  store the raw header bytes so we can prepend them to the raw</span>
        <span class="c1">#  data bytes and pass it all to the parser.</span>
        <span class="n">raw_bytes</span> <span class="o">=</span> <span class="n">buf</span>

        <span class="c1">#  read the timestamp - this method was also modified to return</span>
        <span class="c1">#  the raw bytes</span>
        <span class="n">lowDateField</span><span class="p">,</span> <span class="n">highDateField</span><span class="p">,</span> <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_timestamp</span><span class="p">()</span>

        <span class="c1">#  add the timestamp bytes to the raw_bytes string</span>
        <span class="n">raw_bytes</span> <span class="o">+=</span> <span class="n">buf</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">dgram_size</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">dgram_type</span><span class="p">,</span>
            <span class="n">low_date</span><span class="o">=</span><span class="n">lowDateField</span><span class="p">,</span>
            <span class="n">high_date</span><span class="o">=</span><span class="n">highDateField</span><span class="p">,</span>
            <span class="n">raw_bytes</span><span class="o">=</span><span class="n">raw_bytes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads raw bytes from the file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_next_dgram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to read the next datagram from the file.</span>

<span class="sd">        Returns the datagram as a raw string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#  11/26/19 - RHT - Modified this method so it doesn&#39;t &quot;peek&quot;</span>
        <span class="c1">#  at the next datagram before reading which was inefficient.</span>
        <span class="c1">#  To minimize changes to the code, methods to read the header</span>
        <span class="c1">#  and timestamp were modified to return the raw bytes which</span>
        <span class="c1">#  allows us to pass them onto the parser without having to</span>
        <span class="c1">#  rewind and read again as was previously done.</span>

        <span class="c1">#  store our current location in the file</span>
        <span class="n">old_file_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>

        <span class="c1">#  try to read the header of the next datagram</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_header</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">DatagramReadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Short read while getting raw file datagram header&quot;</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="c1">#  check for invalid time data</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Skipping </span><span class="si">%s</span><span class="s2"> datagram w/ timestamp of (0, 0) at </span><span class="si">%s</span><span class="s2">L:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>

        <span class="c1">#  basic sanity check on size</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
            <span class="c1">#  size can&#39;t be smaller than the header size</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Invalid datagram header: size: </span><span class="si">%d</span><span class="s2">, type: </span><span class="si">%s</span><span class="s2">, nt_date: </span><span class="si">%s</span><span class="s2">.  dgram_size &lt; 16&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">((</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">])),</span>
            <span class="p">)</span>

            <span class="c1">#  see if we can find the next datagram</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

            <span class="c1">#  and then return that</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>

        <span class="c1">#  get the raw bytes from the header</span>
        <span class="n">raw_dgram</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;raw_bytes&quot;</span><span class="p">]</span>

        <span class="c1">#  and append the rest of the datagram - we subtract 12</span>
        <span class="c1">#  since we have already read 12 bytes: 4 for type and</span>
        <span class="c1">#  8 for time.</span>
        <span class="n">raw_dgram</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">)</span>

        <span class="c1">#  determine the size of the payload in bytes</span>
        <span class="n">bytes_read</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_dgram</span><span class="p">)</span>

        <span class="c1">#  and make sure it checks out</span>
        <span class="k">if</span> <span class="n">bytes_read</span> <span class="o">&lt;</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Datagram </span><span class="si">%d</span><span class="s2"> (@</span><span class="si">%d</span><span class="s2">) shorter than expected length:  </span><span class="si">%d</span><span class="s2"> &lt; </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                <span class="n">old_file_pos</span><span class="p">,</span>
                <span class="n">bytes_read</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>

        <span class="c1">#  now read the trailing size value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dgram_size_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">DatagramReadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Short read while getting trailing raw file datagram size for check&quot;</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="c1">#  make sure they match</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dgram_size_check</span><span class="p">:</span>
            <span class="c1"># self._seek_bytes(old_file_pos, SEEK_SET)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Datagram failed size check:  </span><span class="si">%d</span><span class="s2"> != </span><span class="si">%d</span><span class="s2"> @ (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
                <span class="n">dgram_size_check</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping to next datagram...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>

        <span class="c1">#  add the header (16 bytes) and repeated size (4 bytes) to the payload</span>
        <span class="c1">#  bytes to get the total bytes read for this datagram.</span>
        <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">bytes_read</span> <span class="o">+</span> <span class="mi">20</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">raw_dgram</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nice_dgram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_raw_datagram</span><span class="p">(</span><span class="n">raw_dgram</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">nice_dgram</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_raw_datagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_datagram_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param raw_datagram_string: bytestring containing datagram (first 4</span>
<span class="sd">            bytes indicate datagram type, such as &#39;RAW0&#39;)</span>
<span class="sd">        :type raw_datagram_string: str</span>

<span class="sd">        :param bytes_read: integer specifying the datagram size, including header</span>
<span class="sd">            in bytes,</span>
<span class="sd">        :type bytes_read: int</span>

<span class="sd">        Returns a formatted datagram object using the data in raw_datagram_string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#  11/26/19 - RHT - Modified this method to pass through the number of</span>
        <span class="c1">#  bytes read so we can bubble that up to the user.</span>

        <span class="n">dgram_type</span> <span class="o">=</span> <span class="n">raw_datagram_string</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DGRAM_TYPE_KEY</span><span class="p">[</span><span class="n">dgram_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># raise KeyError(&#39;Unknown datagram type %s,</span>
            <span class="c1"># valid types: %s&#39; % (str(dgram_type),</span>
            <span class="c1"># str(self.DGRAM_TYPE_KEY.keys())))</span>
            <span class="k">return</span> <span class="n">raw_datagram_string</span>

        <span class="n">nice_dgram</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">raw_datagram_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nice_dgram</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_total_dgram_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips quickly through the file counting datagrams and stores the</span>
<span class="sd">        resulting number in self._total_dgram_count</span>

<span class="sd">        :raises: ValueError if self._total_dgram_count is not None (it has been set before)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;self._total_dgram_count has already been set.  Call .reset() first if you really want to recount&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>

        <span class="c1"># Save current position for later</span>
        <span class="n">old_file_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>
        <span class="n">old_dgram_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">DatagramReadError</span><span class="p">,</span> <span class="n">SimradEOF</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="k">break</span>

        <span class="c1"># Return to where we started</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="n">old_dgram_offset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">at_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">)</span>
        <span class="n">eof_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>

        <span class="c1"># Check to see if we&#39;re at the end of file and raise EOF</span>
        <span class="k">if</span> <span class="n">old_pos</span> <span class="o">==</span> <span class="n">eof_pos</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Othereise, go back to where we were and re-raise the original</span>
        <span class="c1"># exception</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">old_pos</span> <span class="o">-</span> <span class="n">eof_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param k: Number of datagrams to read</span>
<span class="sd">        :type k: int</span>

<span class="sd">        Reads the next k datagrams.  A list of datagrams is returned if k &gt; 1.  The entire</span>
<span class="sd">        file is read from the CURRENT POSITION if k &lt; 0. (does not necessarily read from beginning</span>
<span class="sd">        of file if previous datagrams were read)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_eof</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">SimradEOF</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dgram_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dgram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>
                    <span class="n">dgram_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgram</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">return</span> <span class="n">dgram_list</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readall</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">readall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the entire file from the beginning and returns a list of datagrams.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
        <span class="n">dgram_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">raw_dgram</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_dgrams</span><span class="p">():</span>
            <span class="n">dgram_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_dgram</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dgram_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_next_datagram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_file_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempting to find next valid datagram...&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="s2">&quot;type&quot;</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DGRAM_TYPE_KEY</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DatagramReadError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No next datagram found. Ending reading of file.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SimradEOF</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Found next datagram:  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipped ahead </span><span class="si">%d</span><span class="s2"> bytes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span> <span class="o">-</span> <span class="n">old_file_pos</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current file pointer offset by datagram number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the header of the next datagram in the file.  The file position is</span>
<span class="sd">        reset back to the original location afterwards.</span>

<span class="sd">        :returns: [dgram_size, dgram_type, (low_date, high_date)]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dgram_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_header</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;RAW0&quot;</span><span class="p">):</span>
            <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;RAW3&quot;</span><span class="p">):</span>
            <span class="n">chan_id</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;128s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
            <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chan_id</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="mi">128</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dgram_header</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the next datagram (synonymous with self.read(1))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the previous datagram &#39;behind&#39; the current file pointer position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>
        <span class="n">raw_dgram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">raw_dgram</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips forward to the next datagram without reading the contents of the current one</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># dgram_size, dgram_type, (low_date, high_date) = self.peek()[:3]</span>

        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Invalid datagram header: size: </span><span class="si">%d</span><span class="s2">, type: </span><span class="si">%s</span><span class="s2">, nt_date: </span><span class="si">%s</span><span class="s2">.  dgram_size &lt; 16&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">((</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">])),</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
            <span class="n">dgram_size_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dgram_size_check</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Datagram failed size check:  </span><span class="si">%d</span><span class="s2"> != </span><span class="si">%d</span><span class="s2"> @ (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
                    <span class="n">dgram_size_check</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping to next datagram... (in skip)&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">skip_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips backwards to the previous datagram without reading it&#39;s contents</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_file_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="n">dgram_size_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

        <span class="c1"># Seek to the beginning of the datagram and read as normal</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="n">dgram_size_check</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatagramSizeError</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">dgram_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">DatagramSizeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error reading the datagram&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="n">dgram_size_check</span> <span class="o">!=</span> <span class="n">dgram_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">DatagramSizeError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iter_dgrams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through the file, repeatedly calling self.next() until</span>
<span class="sd">        the end of file is reached</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># new_dgram = self.next()</span>
            <span class="c1"># yield new_dgram</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_dgram</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Caught EOF?&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span>

            <span class="k">yield</span> <span class="n">new_dgram</span>

    <span class="c1"># Unsupported members</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        aliased to self.next()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        aliased to self.read(-1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the familiar &#39;seek&#39; operation using datagram offsets</span>
<span class="sd">        instead of raw bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_SET</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot seek backwards from beginning of file&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_END</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use negative offsets when seeking backward from end of file&quot;</span><span class="p">)</span>

            <span class="c1"># Do we need to generate the total number of datagrams w/in the file?</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_total_dgram_count</span><span class="p">()</span>
                <span class="c1"># Throws a value error if _total_dgram_count has already been set.  We can ignore it</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span>

        <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_CUR</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Illegal value for &#39;whence&#39; (</span><span class="si">%s</span><span class="s2">), use 0 (beginning), 1 (current), or 2 (end)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">whence</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.__next__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__next__</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the next datagram (synonymous with self.read(1))</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the next datagram (synonymous with self.read(1))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.iter_dgrams" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iter_dgrams</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Iterates through the file, repeatedly calling self.next() until
the end of file is reached</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter_dgrams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates through the file, repeatedly calling self.next() until</span>
<span class="sd">    the end of file is reached</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># new_dgram = self.next()</span>
        <span class="c1"># yield new_dgram</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_dgram</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Caught EOF?&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

        <span class="k">yield</span> <span class="n">new_dgram</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.peek" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">peek</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the header of the next datagram in the file.  The file position is
reset back to the original location afterwards.</p>
<p>:returns: [dgram_size, dgram_type, (low_date, high_date)]</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the header of the next datagram in the file.  The file position is</span>
<span class="sd">    reset back to the original location afterwards.</span>

<span class="sd">    :returns: [dgram_size, dgram_type, (low_date, high_date)]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dgram_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_header</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;RAW0&quot;</span><span class="p">):</span>
        <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;RAW3&quot;</span><span class="p">):</span>
        <span class="n">chan_id</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;128s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bytes</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
        <span class="n">dgram_header</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chan_id</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="mi">128</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dgram_header</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.prev" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prev</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the previous datagram 'behind' the current file pointer position</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the previous datagram &#39;behind&#39; the current file pointer position</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>
    <span class="n">raw_dgram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">raw_dgram</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>:param k: Number of datagrams to read
:type k: int</p>
<p>Reads the next k datagrams.  A list of datagrams is returned if k &gt; 1.  The entire
file is read from the CURRENT POSITION if k &lt; 0. (does not necessarily read from beginning
of file if previous datagrams were read)</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param k: Number of datagrams to read</span>
<span class="sd">    :type k: int</span>

<span class="sd">    Reads the next k datagrams.  A list of datagrams is returned if k &gt; 1.  The entire</span>
<span class="sd">    file is read from the CURRENT POSITION if k &lt; 0. (does not necessarily read from beginning</span>
<span class="sd">    of file if previous datagrams were read)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_eof</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">SimradEOF</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dgram_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dgram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_next_dgram</span><span class="p">()</span>
                <span class="n">dgram_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgram</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">dgram_list</span>

    <span class="k">elif</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readall</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readall" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readall</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Reads the entire file from the beginning and returns a list of datagrams.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the entire file from the beginning and returns a list of datagrams.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
    <span class="n">dgram_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">raw_dgram</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_dgrams</span><span class="p">():</span>
        <span class="n">dgram_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_dgram</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dgram_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readline</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>aliased to self.next()</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    aliased to self.next()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.readlines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readlines</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>aliased to self.read(-1)</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    aliased to self.read(-1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.seek" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Performs the familiar 'seek' operation using datagram offsets
instead of raw bytes.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs the familiar &#39;seek&#39; operation using datagram offsets</span>
<span class="sd">    instead of raw bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_SET</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot seek backwards from beginning of file&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_END</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use negative offsets when seeking backward from end of file&quot;</span><span class="p">)</span>

        <span class="c1"># Do we need to generate the total number of datagrams w/in the file?</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_total_dgram_count</span><span class="p">()</span>
            <span class="c1"># Throws a value error if _total_dgram_count has already been set.  We can ignore it</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_dgram_count</span>

    <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">SEEK_CUR</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Illegal value for &#39;whence&#39; (</span><span class="si">%s</span><span class="s2">), use 0 (beginning), 1 (current), or 2 (end)&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">whence</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip_back</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">skip</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Skips forward to the next datagram without reading the contents of the current one</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skips forward to the next datagram without reading the contents of the current one</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># dgram_size, dgram_type, (low_date, high_date) = self.peek()[:3]</span>

    <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Invalid datagram header: size: </span><span class="si">%d</span><span class="s2">, type: </span><span class="si">%s</span><span class="s2">, nt_date: </span><span class="si">%s</span><span class="s2">.  dgram_size &lt; 16&quot;</span><span class="p">,</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="nb">str</span><span class="p">((</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">])),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
        <span class="n">dgram_size_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dgram_size_check</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Datagram failed size check:  </span><span class="si">%d</span><span class="s2"> != </span><span class="si">%d</span><span class="s2"> @ (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>
                <span class="n">dgram_size_check</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping to next datagram... (in skip)&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_datagram</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.skip_back" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">skip_back</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Skips backwards to the previous datagram without reading it's contents</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">skip_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skips backwards to the previous datagram without reading it&#39;s contents</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">old_file_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tell_bytes</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="n">dgram_size_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

    <span class="c1"># Seek to the beginning of the datagram and read as normal</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="n">dgram_size_check</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatagramSizeError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">dgram_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dgram_size</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">DatagramSizeError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error reading the datagram&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">if</span> <span class="n">dgram_size_check</span> <span class="o">!=</span> <span class="n">dgram_size</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="n">old_file_pos</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">DatagramSizeError</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_bytes</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">SEEK_CUR</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="aalibrary.utils.sonar_checker.ek_raw_io.RawSimradFile.tell" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tell</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the current file pointer offset by datagram number</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the current file pointer offset by datagram number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_dgram_offset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.ek_raw_parsers" class="doc doc-heading">
            <code>ek_raw_parsers</code>


</h3>

    <div class="doc doc-contents ">

        <p>Code originally developed for pyEcholab
(https://github.com/CI-CMG/pyEcholab)
by Rick Towler <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;">&#114;&#105;&#99;&#107;&#46;&#116;&#111;&#119;&#108;&#101;&#114;&#64;&#110;&#111;&#97;&#97;&#46;&#103;&#111;&#118;</a> at NOAA AFSC.</p>
<p>The code has been modified to handle split-beam data and
channel-transducer structure from different EK80 setups.</p>








<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradAnnotationParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradAnnotationParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradAnnotationParser">SimradAnnotationParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>ER60 Annotation datagram contains the following keys:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradBottomParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradBottomParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradBottomParser">SimradBottomParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Bottom Detection datagram contains the following keys:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradConfigParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradConfigParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradConfigParser">SimradConfigParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Simrad Configuration Datagram parser operates on dictionaries with the following keys:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradDepthParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradDepthParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradDepthParser">SimradDepthParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>ER60 Depth Detection datagram (from .bot files) contain the following keys:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradNMEAParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradNMEAParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradNMEAParser">SimradNMEAParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>ER60 NMEA datagram contains the following keys:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="SimradRawParser (aalibrary.utils.sonar_checker.ek_raw_parsers.SimradRawParser)" href="#aalibrary.utils.sonar_checker.ek_raw_parsers.SimradRawParser">SimradRawParser</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Sample Data Datagram parser operates on dictionaries with the following keys:</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradAnnotationParser" class="doc doc-heading">
            <code>SimradAnnotationParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>ER60 Annotation datagram contains the following keys:</p>
<pre><code>type:         string == 'TAG0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:     datetime.datetime object of NT date, assumed to be UTC

text:         Annotation
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw ER60 Annotation datagram
                    (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                     (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradAnnotationParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ER60 Annotation datagram contains the following keys:</span>


<span class="sd">        type:         string == &#39;TAG0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:     datetime.datetime object of NT date, assumed to be UTC</span>

<span class="sd">        text:         Annotation</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw ER60 Annotation datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                             (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)]}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;TAG&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="c1">#        if version == 0:</span>
        <span class="c1">#            data[&#39;text&#39;] = raw_string[self.header_size(version):].strip(&#39;\x00&#39;)</span>
        <span class="c1">#            if isinstance(data[&#39;text&#39;], bytes):</span>
        <span class="c1">#                data[&#39;text&#39;] = data[&#39;text&#39;].decode()</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>  <span class="c1"># noqa</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

            <span class="c1"># Pad with more nulls to 4-byte word boundary if necessary</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">))</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">))</span>
            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradBottomParser" class="doc doc-heading">
            <code>SimradBottomParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>Bottom Detection datagram contains the following keys:</p>
<pre><code>type:         string == 'BOT0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
datetime:     datetime.datetime object of NT date converted to UTC
transceiver_count:  long uint with number of transceivers
depth:        [float], one value for each active channel
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw ER60 Bottom datagram
                    (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                     (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradBottomParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bottom Detection datagram contains the following keys:</span>

<span class="sd">        type:         string == &#39;BOT0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        datetime:     datetime.datetime object of NT date converted to UTC</span>
<span class="sd">        transceiver_count:  long uint with number of transceivers</span>
<span class="sd">        depth:        [float], one value for each active channel</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw ER60 Bottom datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                             (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;BOT&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">depth_fmt</span> <span class="o">=</span> <span class="s2">&quot;=</span><span class="si">%d</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],)</span>
            <span class="n">depth_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">depth_fmt</span><span class="p">)</span>
            <span class="n">buf_indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">depth_fmt</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">[</span><span class="n">buf_indx</span> <span class="p">:</span> <span class="n">buf_indx</span> <span class="o">+</span> <span class="n">depth_size</span><span class="p">]),</span>  <span class="c1"># noqa</span>
                <span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;# of depth values </span><span class="si">%d</span><span class="s2"> does not match transceiver count </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]),</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">])</span>
            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradConfigParser" class="doc doc-heading">
            <code>SimradConfigParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>Simrad Configuration Datagram parser operates on dictionaries with the following keys:</p>
<pre><code>type:         string == 'CON0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC

survey_name                     [str]
transect_name                   [str]
sounder_name                    [str]
version                         [str]
spare0                          [str]
transceiver_count               [long]
transceivers                    [list] List of dicts representing Transducer Configs:

ME70 Data contains the following additional values (data contained w/in first 14
    bytes of the spare0 field)

multiplexing                    [short]  Always 0
time_bias                       [long] difference between UTC and local time in min.
sound_velocity_avg              [float] [m/s]
sound_velocity_transducer       [float] [m/s]
beam_config                     [str] Raw XML string containing beam config. info
</code></pre>
<p>Transducer Config Keys (ER60/ES60/ES70 sounders):
    channel_id                      [str]   channel ident string
    beam_type                       [long]  Type of channel (0 = Single, 1 = Split)
    frequency                       [float] channel frequency
    equivalent_beam_angle           [float] dB
    beamwidth_alongship             [float]
    beamwidth_athwartship           [float]
    angle_sensitivity_alongship     [float]
    angle_sensitivity_athwartship   [float]
    angle_offset_alongship          [float]
    angle_offset_athwartship        [float]
    pos_x                           [float]
    pos_y                           [float]
    pos_z                           [float]
    dir_x                           [float]
    dir_y                           [float]
    dir_z                           [float]
    pulse_length_table              [float[5]]
    spare1                          [str]
    gain_table                      [float[5]]
    spare2                          [str]
    sa_correction_table             [float[5]]
    spare3                          [str]
    gpt_software_version            [str]
    spare4                          [str]</p>
<p>Transducer Config Keys (ME70 sounders):
    channel_id                      [str]   channel ident string
    beam_type                       [long]  Type of channel (0 = Single, 1 = Split)
    reserved1                       [float] channel frequency
    equivalent_beam_angle           [float] dB
    beamwidth_alongship             [float]
    beamwidth_athwartship           [float]
    angle_sensitivity_alongship     [float]
    angle_sensitivity_athwartship   [float]
    angle_offset_alongship          [float]
    angle_offset_athwartship        [float]
    pos_x                           [float]
    pos_y                           [float]
    pos_z                           [float]
    beam_steering_angle_alongship   [float]
    beam_steering_angle_athwartship [float]
    beam_steering_angle_unused      [float]
    pulse_length                    [float]
    reserved2                       [float]
    spare1                          [str]
    gain                            [float]
    reserved3                       [float]
    spare2                          [str]
    sa_correction                   [float]
    reserved4                       [float]
    spare3                          [str]
    gpt_software_version            [str]
    spare4                          [str]</p>
<p>from_string(str):   parse a raw config datagram
                    (with leading/trailing datagram size stripped)</p>
<p>to_string(dict):    Returns raw string (including leading/trailing size fields)
                    ready for writing to disk</p>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradConfigParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simrad Configuration Datagram parser operates on dictionaries with the following keys:</span>

<span class="sd">        type:         string == &#39;CON0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>

<span class="sd">        survey_name                     [str]</span>
<span class="sd">        transect_name                   [str]</span>
<span class="sd">        sounder_name                    [str]</span>
<span class="sd">        version                         [str]</span>
<span class="sd">        spare0                          [str]</span>
<span class="sd">        transceiver_count               [long]</span>
<span class="sd">        transceivers                    [list] List of dicts representing Transducer Configs:</span>

<span class="sd">        ME70 Data contains the following additional values (data contained w/in first 14</span>
<span class="sd">            bytes of the spare0 field)</span>

<span class="sd">        multiplexing                    [short]  Always 0</span>
<span class="sd">        time_bias                       [long] difference between UTC and local time in min.</span>
<span class="sd">        sound_velocity_avg              [float] [m/s]</span>
<span class="sd">        sound_velocity_transducer       [float] [m/s]</span>
<span class="sd">        beam_config                     [str] Raw XML string containing beam config. info</span>


<span class="sd">    Transducer Config Keys (ER60/ES60/ES70 sounders):</span>
<span class="sd">        channel_id                      [str]   channel ident string</span>
<span class="sd">        beam_type                       [long]  Type of channel (0 = Single, 1 = Split)</span>
<span class="sd">        frequency                       [float] channel frequency</span>
<span class="sd">        equivalent_beam_angle           [float] dB</span>
<span class="sd">        beamwidth_alongship             [float]</span>
<span class="sd">        beamwidth_athwartship           [float]</span>
<span class="sd">        angle_sensitivity_alongship     [float]</span>
<span class="sd">        angle_sensitivity_athwartship   [float]</span>
<span class="sd">        angle_offset_alongship          [float]</span>
<span class="sd">        angle_offset_athwartship        [float]</span>
<span class="sd">        pos_x                           [float]</span>
<span class="sd">        pos_y                           [float]</span>
<span class="sd">        pos_z                           [float]</span>
<span class="sd">        dir_x                           [float]</span>
<span class="sd">        dir_y                           [float]</span>
<span class="sd">        dir_z                           [float]</span>
<span class="sd">        pulse_length_table              [float[5]]</span>
<span class="sd">        spare1                          [str]</span>
<span class="sd">        gain_table                      [float[5]]</span>
<span class="sd">        spare2                          [str]</span>
<span class="sd">        sa_correction_table             [float[5]]</span>
<span class="sd">        spare3                          [str]</span>
<span class="sd">        gpt_software_version            [str]</span>
<span class="sd">        spare4                          [str]</span>

<span class="sd">    Transducer Config Keys (ME70 sounders):</span>
<span class="sd">        channel_id                      [str]   channel ident string</span>
<span class="sd">        beam_type                       [long]  Type of channel (0 = Single, 1 = Split)</span>
<span class="sd">        reserved1                       [float] channel frequency</span>
<span class="sd">        equivalent_beam_angle           [float] dB</span>
<span class="sd">        beamwidth_alongship             [float]</span>
<span class="sd">        beamwidth_athwartship           [float]</span>
<span class="sd">        angle_sensitivity_alongship     [float]</span>
<span class="sd">        angle_sensitivity_athwartship   [float]</span>
<span class="sd">        angle_offset_alongship          [float]</span>
<span class="sd">        angle_offset_athwartship        [float]</span>
<span class="sd">        pos_x                           [float]</span>
<span class="sd">        pos_y                           [float]</span>
<span class="sd">        pos_z                           [float]</span>
<span class="sd">        beam_steering_angle_alongship   [float]</span>
<span class="sd">        beam_steering_angle_athwartship [float]</span>
<span class="sd">        beam_steering_angle_unused      [float]</span>
<span class="sd">        pulse_length                    [float]</span>
<span class="sd">        reserved2                       [float]</span>
<span class="sd">        spare1                          [str]</span>
<span class="sd">        gain                            [float]</span>
<span class="sd">        reserved3                       [float]</span>
<span class="sd">        spare2                          [str]</span>
<span class="sd">        sa_correction                   [float]</span>
<span class="sd">        reserved4                       [float]</span>
<span class="sd">        spare3                          [str]</span>
<span class="sd">        gpt_software_version            [str]</span>
<span class="sd">        spare4                          [str]</span>

<span class="sd">    from_string(str):   parse a raw config datagram</span>
<span class="sd">                        (with leading/trailing datagram size stripped)</span>

<span class="sd">    to_string(dict):    Returns raw string (including leading/trailing size fields)</span>
<span class="sd">                        ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">COMMON_KEYS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;beam_type&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;equivalent_beam_angle&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;beamwidth_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;beamwidth_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;angle_sensitivity_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;angle_sensitivity_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;angle_offset_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;angle_offset_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;pos_x&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;pos_y&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;pos_z&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;dir_x&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;dir_y&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;dir_z&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;pulse_length_table&quot;</span><span class="p">,</span> <span class="s2">&quot;5f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;spare1&quot;</span><span class="p">,</span> <span class="s2">&quot;8s&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;gain_table&quot;</span><span class="p">,</span> <span class="s2">&quot;5f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;spare2&quot;</span><span class="p">,</span> <span class="s2">&quot;8s&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;sa_correction_table&quot;</span><span class="p">,</span> <span class="s2">&quot;5f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;spare3&quot;</span><span class="p">,</span> <span class="s2">&quot;8s&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">,</span> <span class="s2">&quot;16s&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;spare4&quot;</span><span class="p">,</span> <span class="s2">&quot;28s&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;survey_name&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transect_name&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;sounder_name&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;30s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare0&quot;</span><span class="p">,</span> <span class="s2">&quot;98s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CON&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ER60&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMON_KEYS</span><span class="p">,</span>
            <span class="s2">&quot;ES60&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMON_KEYS</span><span class="p">,</span>
            <span class="s2">&quot;ES70&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMON_KEYS</span><span class="p">,</span>
            <span class="s2">&quot;MBES&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beam_type&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;reserved1&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;equivalent_beam_angle&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beamwidth_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beamwidth_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;angle_sensitivity_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;angle_sensitivity_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;angle_offset_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;angle_offset_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pos_x&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pos_y&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pos_z&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beam_steering_angle_alongship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beam_steering_angle_athwartship&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;beam_steering_angle_unused&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pulse_length&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;reserved2&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare1&quot;</span><span class="p">,</span> <span class="s2">&quot;20s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;reserved3&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare2&quot;</span><span class="p">,</span> <span class="s2">&quot;20s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;sa_correction&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;reserved4&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare3&quot;</span><span class="p">,</span> <span class="s2">&quot;20s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">,</span> <span class="s2">&quot;16s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare4&quot;</span><span class="p">,</span> <span class="s2">&quot;28s&quot;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">round6</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>

            <span class="c1">#  handle Python 3 strings</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceivers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;transect_name&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;survey_name&quot;</span><span class="p">,</span> <span class="s2">&quot;sounder_name&quot;</span><span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">sounder_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sounder_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sounder_name</span> <span class="o">==</span> <span class="s2">&quot;MBES&quot;</span><span class="p">:</span>
                <span class="n">_me70_extra_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;=hLff&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">][:</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;multiplexing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_me70_extra_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_bias&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_me70_extra_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sound_velocity_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_me70_extra_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sound_velocity_transducer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_me70_extra_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">][:</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">][</span><span class="mi">14</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">buf_indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">transducer_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="p">[</span><span class="n">sounder_name</span><span class="p">]</span>
                <span class="n">_sounder_name_used</span> <span class="o">=</span> <span class="n">sounder_name</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unknown sounder_name:  </span><span class="si">%s</span><span class="s2">, (no one of </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">sounder_name</span><span class="p">,</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Will use ER60 transducer config fields as default&quot;</span><span class="p">)</span>

                <span class="n">transducer_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="p">[</span><span class="s2">&quot;ER60&quot;</span><span class="p">]</span>
                <span class="n">_sounder_name_used</span> <span class="o">=</span> <span class="s2">&quot;ER60&quot;</span>

            <span class="n">txcvr_header_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transducer_header</span><span class="p">]</span>
            <span class="n">txcvr_header_fmt</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transducer_header</span><span class="p">])</span>
            <span class="n">txcvr_header_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">txcvr_header_fmt</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">txcvr_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">txcvr_header_values_encoded</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
                    <span class="n">txcvr_header_fmt</span><span class="p">,</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="n">buf_indx</span> <span class="p">:</span> <span class="n">buf_indx</span> <span class="o">+</span> <span class="n">txcvr_header_size</span><span class="p">],</span>  <span class="c1"># noqa</span>
                <span class="p">)</span>
                <span class="n">txcvr_header_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">txcvr_header_values_encoded</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tx_idx</span><span class="p">,</span> <span class="n">tx_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txcvr_header_values_encoded</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_val</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                        <span class="n">txcvr_header_values</span><span class="p">[</span><span class="n">tx_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx_val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

                <span class="n">txcvr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">txcvr_indx</span><span class="p">,</span> <span class="p">{})</span>

                <span class="k">if</span> <span class="n">_sounder_name_used</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ER60&quot;</span><span class="p">,</span> <span class="s2">&quot;ES60&quot;</span><span class="p">,</span> <span class="s2">&quot;ES70&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">txcvr_field_indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txcvr_header_fields</span><span class="p">[:</span><span class="mi">17</span><span class="p">]):</span>
                        <span class="n">txcvr</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="n">txcvr_field_indx</span><span class="p">]</span>

                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;pulse_length_table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">round6</span><span class="p">,</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">])),</span> <span class="s2">&quot;float&quot;</span>
                    <span class="p">)</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gain_table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">round6</span><span class="p">,</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">28</span><span class="p">])),</span> <span class="s2">&quot;float&quot;</span>
                    <span class="p">)</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;sa_correction_table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">round6</span><span class="p">,</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">29</span><span class="p">:</span><span class="mi">34</span><span class="p">])),</span> <span class="s2">&quot;float&quot;</span>
                    <span class="p">)</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span>
                    <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span>

                <span class="k">elif</span> <span class="n">_sounder_name_used</span> <span class="o">==</span> <span class="s2">&quot;MBES&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">txcvr_field_indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txcvr_header_fields</span><span class="p">):</span>
                        <span class="n">txcvr</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr_header_values</span><span class="p">[</span><span class="n">txcvr_field_indx</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Unknown _sounder_name_used (Should not happen, this is a bug!)&quot;</span>
                    <span class="p">)</span>

                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">buf_indx</span> <span class="o">+=</span> <span class="n">txcvr_header_size</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># CON1 only has a single data field:  beam_config, holding an xml string</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;beam_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceivers&quot;</span><span class="p">]):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Mismatch between &#39;transceiver_count&#39; and actual # of transceivers&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceivers&quot;</span><span class="p">])</span>

            <span class="n">sounder_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sounder_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sounder_name</span> <span class="o">==</span> <span class="s2">&quot;MBES&quot;</span><span class="p">:</span>
                <span class="n">_packed_me70_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
                    <span class="s2">&quot;=hLff&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;multiplexing&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_bias&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sound_velocity_avg&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sound_velocity_transducer&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_packed_me70_values</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spare0&quot;</span><span class="p">][</span><span class="mi">14</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">transducer_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="p">[</span><span class="n">sounder_name</span><span class="p">]</span>
                <span class="n">_sounder_name_used</span> <span class="o">=</span> <span class="n">sounder_name</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unknown sounder_name:  </span><span class="si">%s</span><span class="s2">, (no one of </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">sounder_name</span><span class="p">,</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Will use ER60 transducer config fields as default&quot;</span><span class="p">)</span>

                <span class="n">transducer_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transducer_headers</span><span class="p">[</span><span class="s2">&quot;ER60&quot;</span><span class="p">]</span>
                <span class="n">_sounder_name_used</span> <span class="o">=</span> <span class="s2">&quot;ER60&quot;</span>

            <span class="n">txcvr_header_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transducer_header</span><span class="p">]</span>
            <span class="n">txcvr_header_fmt</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transducer_header</span><span class="p">])</span>
            <span class="n">txcvr_header_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">txcvr_header_fmt</span><span class="p">)</span>  <span class="c1"># noqa</span>

            <span class="k">for</span> <span class="n">txcvr_indx</span><span class="p">,</span> <span class="n">txcvr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">txcvr_contents</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">_sounder_name_used</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ER60&quot;</span><span class="p">,</span> <span class="s2">&quot;ES60&quot;</span><span class="p">,</span> <span class="s2">&quot;ES70&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">txcvr_header_fields</span><span class="p">[:</span><span class="mi">17</span><span class="p">]:</span>
                        <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;pulse_length_table&quot;</span><span class="p">])</span>
                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare1&quot;</span><span class="p">])</span>

                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gain_table&quot;</span><span class="p">])</span>
                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare2&quot;</span><span class="p">])</span>

                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;sa_correction_table&quot;</span><span class="p">])</span>
                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare3&quot;</span><span class="p">])</span>

                    <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;gpt_software_version&quot;</span><span class="p">],</span> <span class="n">txcvr</span><span class="p">[</span><span class="s2">&quot;spare4&quot;</span><span class="p">]])</span>

                    <span class="n">txcvr_contents_str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">txcvr_header_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">txcvr_contents</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">_sounder_name_used</span> <span class="o">==</span> <span class="s2">&quot;MBES&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">txcvr_header_fields</span><span class="p">:</span>
                        <span class="n">txcvr_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

                    <span class="n">txcvr_contents_str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">txcvr_header_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">txcvr_contents</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Unknown _sounder_name_used (Should not happen, this is a bug!)&quot;</span>
                    <span class="p">)</span>

                <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">txcvr_contents_str</span><span class="p">))</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txcvr_contents_str</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beam_config&quot;</span><span class="p">]))</span>
            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beam_config&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradDepthParser" class="doc doc-heading">
            <code>SimradDepthParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>ER60 Depth Detection datagram (from .bot files) contain the following keys:</p>
<pre><code>type:         string == 'DEP0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC
transceiver_count:  [long uint] with number of transceivers

depth:        [float], one value for each active channel
reflectivity: [float], one value for each active channel
unused:       [float], unused value for each active channel
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw ER60 Depth datagram
                     (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                     (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradDepthParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ER60 Depth Detection datagram (from .bot files) contain the following keys:</span>

<span class="sd">        type:         string == &#39;DEP0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>
<span class="sd">        transceiver_count:  [long uint] with number of transceivers</span>

<span class="sd">        depth:        [float], one value for each active channel</span>
<span class="sd">        reflectivity: [float], one value for each active channel</span>
<span class="sd">        unused:       [float], unused value for each active channel</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw ER60 Depth datagram</span>
<span class="sd">                             (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                             (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;DEP&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_fmt</span> <span class="o">=</span> <span class="s2">&quot;=3f&quot;</span>
            <span class="n">data_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">data_fmt</span><span class="p">)</span>

            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],))</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reflectivity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],))</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;unused&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],))</span>

            <span class="n">buf_indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]):</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
                    <span class="n">data_fmt</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">[</span><span class="n">buf_indx</span> <span class="p">:</span> <span class="n">buf_indx</span> <span class="o">+</span> <span class="n">data_size</span><span class="p">]</span>  <span class="c1"># noqa</span>
                <span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reflectivity&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;unused&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

                <span class="n">buf_indx</span> <span class="o">+=</span> <span class="n">data_size</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reflectivity&quot;</span><span class="p">]),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;unused&quot;</span><span class="p">]),</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">],</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lengths</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">min_indx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Data lengths mismatched:  d:</span><span class="si">%d</span><span class="s2">, r:</span><span class="si">%d</span><span class="s2">, u:</span><span class="si">%d</span><span class="s2">, t:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">lengths</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  Using minimum value:  </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">min_indx</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_indx</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_indx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">f&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;transceiver_count&quot;</span><span class="p">]):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">],</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reflectivity&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">],</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;unused&quot;</span><span class="p">][</span><span class="n">indx</span><span class="p">],</span>
                    <span class="p">]</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradFILParser" class="doc doc-heading">
            <code>SimradFILParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>EK80 FIL datagram contains the following keys:</p>
<pre><code>type:               string == 'FIL1'
low_date:           long uint representing LSBytes of 64bit NT date
high_date:          long uint representing MSBytes of 64bit NT date
timestamp:          datetime.datetime object of NT date, assumed to be UTC
stage:              int
channel_id:         string
n_coefficients:     int
decimation_factor:  int
coefficients:       np.complex64
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw EK80 FIL datagram
                    (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                    (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradFILParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EK80 FIL datagram contains the following keys:</span>


<span class="sd">        type:               string == &#39;FIL1&#39;</span>
<span class="sd">        low_date:           long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:          long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:          datetime.datetime object of NT date, assumed to be UTC</span>
<span class="sd">        stage:              int</span>
<span class="sd">        channel_id:         string</span>
<span class="sd">        n_coefficients:     int</span>
<span class="sd">        decimation_factor:  int</span>
<span class="sd">        coefficients:       np.complex64</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw EK80 FIL datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                            (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;stage&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare&quot;</span><span class="p">,</span> <span class="s2">&quot;2s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;n_coefficients&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;decimation_factor&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;FIL&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>

            <span class="c1">#  handle Python 3 strings</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#  clean up the channel ID</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#  unpack the coefficients</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="n">block_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_coefficients&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;coefficients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex64&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beam_config&quot;</span><span class="p">]))</span>
            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beam_config&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradIDXParser" class="doc doc-heading">
            <code>SimradIDXParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>ER60/EK80 IDX datagram contains the following keys:</p>
<pre><code>type:         string == 'IDX0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC
ping_number:  int
distance :    float
latitude:     float
longitude:    float
file_offset:  int
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):   Parse a raw ER60/EK80 IDX datagram
                    (with leading/trailing datagram size stripped)

to_string():    Returns the datagram as a raw string (including leading/trailing size
                fields) ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradIDXParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ER60/EK80 IDX datagram contains the following keys:</span>


<span class="sd">        type:         string == &#39;IDX0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>
<span class="sd">        ping_number:  int</span>
<span class="sd">        distance :    float</span>
<span class="sd">        latitude:     float</span>
<span class="sd">        longitude:    float</span>
<span class="sd">        file_offset:  int</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):   Parse a raw ER60/EK80 IDX datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():    Returns the datagram as a raw string (including leading/trailing size</span>
<span class="sd">                        fields) ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="c1"># (&#39;dummy&#39;, &#39;L&#39;),   # There are 4 extra bytes in this datagram</span>
                <span class="p">(</span><span class="s2">&quot;ping_number&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;file_offset&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;IDX&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpacks the data in raw_string into dictionary containing IDX data</span>

<span class="sd">        :param raw_string:</span>
<span class="sd">        :type raw_string: str</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="c1">#  first try to decode as utf-8 but fall back to latin_1 if that fails</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>

        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradMRUParser" class="doc doc-heading">
            <code>SimradMRUParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>EK80 MRU datagram contains the following keys:</p>
<pre><code>type:         string == 'MRU0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC
heave:        float
roll :        float
pitch:        float
heading:      float
</code></pre>
<p>Version 1 contains (from https://www3.mbari.org/products/mbsystem/formatdoc/KongsbergKmall/EMdgmFormat_RevH/html/kmBinary.html): # noqa</p>
<p>Status word See 1)  uint32  4U
Latitude    deg double  8F
Longitude   deg double  8F
Ellipsoid height    m   float   4F
Roll    deg float   4F
Pitch   deg float   4F
Heading deg float   4F
Heave   m   float   4F
Roll rate   deg/s   float   4F
Pitch rate  deg/s   float   4F
Yaw rate    deg/s   float   4F
North velocity  m/s float   4F
East velocity   m/s float   4F
Down velocity   m/s float   4F
Latitude error  m   float   4F
Longitude error m   float   4F
Height error    m   float   4F
Roll error  deg float   4F
Pitch error deg float   4F
Heading error   deg float   4F
Heave error m   float   4F
North acceleration  m/s2    float   4F
East acceleration   m/s2    float   4F
Down acceleration   m/s2    float   4F
Delayed heave:  -   -   -
UTC seconds s   uint32  4U
UTC nanoseconds ns  uint32  4U
Delayed heave   m   float   4F</p>
<p>The following methods are defined:</p>
<pre><code>from_string(str):   parse a raw EK80 MRU datagram
                    (with leading/trailing datagram size stripped)

to_string():        Returns the datagram as a raw string (including
                    leading/trailing size fields) ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradMRUParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EK80 MRU datagram contains the following keys:</span>


<span class="sd">        type:         string == &#39;MRU0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>
<span class="sd">        heave:        float</span>
<span class="sd">        roll :        float</span>
<span class="sd">        pitch:        float</span>
<span class="sd">        heading:      float</span>

<span class="sd">    Version 1 contains (from https://www3.mbari.org/products/mbsystem/formatdoc/KongsbergKmall/EMdgmFormat_RevH/html/kmBinary.html): # noqa</span>

<span class="sd">    Status word See 1)  uint32  4U</span>
<span class="sd">    Latitude    deg double  8F</span>
<span class="sd">    Longitude   deg double  8F</span>
<span class="sd">    Ellipsoid height    m   float   4F</span>
<span class="sd">    Roll    deg float   4F</span>
<span class="sd">    Pitch   deg float   4F</span>
<span class="sd">    Heading deg float   4F</span>
<span class="sd">    Heave   m   float   4F</span>
<span class="sd">    Roll rate   deg/s   float   4F</span>
<span class="sd">    Pitch rate  deg/s   float   4F</span>
<span class="sd">    Yaw rate    deg/s   float   4F</span>
<span class="sd">    North velocity  m/s float   4F</span>
<span class="sd">    East velocity   m/s float   4F</span>
<span class="sd">    Down velocity   m/s float   4F</span>
<span class="sd">    Latitude error  m   float   4F</span>
<span class="sd">    Longitude error m   float   4F</span>
<span class="sd">    Height error    m   float   4F</span>
<span class="sd">    Roll error  deg float   4F</span>
<span class="sd">    Pitch error deg float   4F</span>
<span class="sd">    Heading error   deg float   4F</span>
<span class="sd">    Heave error m   float   4F</span>
<span class="sd">    North acceleration  m/s2    float   4F</span>
<span class="sd">    East acceleration   m/s2    float   4F</span>
<span class="sd">    Down acceleration   m/s2    float   4F</span>
<span class="sd">    Delayed heave:  -   -   -</span>
<span class="sd">    UTC seconds s   uint32  4U</span>
<span class="sd">    UTC nanoseconds ns  uint32  4U</span>
<span class="sd">    Delayed heave   m   float   4F</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):   parse a raw EK80 MRU datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():        Returns the datagram as a raw string (including</span>
<span class="sd">                            leading/trailing size fields) ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;roll&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heading&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;start_id&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>  <span class="c1"># KMB#</span>
                <span class="p">(</span><span class="s2">&quot;status_word&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">,</span> <span class="s2">&quot;12s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ellipsoid_height&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;roll&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heading&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;roll_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pitch_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;yaw_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;velocity_north&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;velocity_east&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;velocity_down&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;latitude_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;longitude_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;height_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;roll_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pitch_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heading_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave_error&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;accel_north&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;accel_east&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;accel_down&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave_delay_secs&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave_delay_usecs&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave_delay_m&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;MRU&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpacks the data in raw_string into dictionary containing MRU data</span>

<span class="sd">        :param raw_string:</span>
<span class="sd">        :type raw_string: str</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="c1">#  first try to decode as utf-8 but fall back to latin_1 if that fails</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>

        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin_1&quot;</span><span class="p">)</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradNMEAParser" class="doc doc-heading">
            <code>SimradNMEAParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>ER60 NMEA datagram contains the following keys:</p>
<pre><code>type:         string == 'NME0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:     datetime.datetime object of NT date, assumed to be UTC

nmea_string:  full (original) NMEA string
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw ER60 NMEA datagram
                    (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                     (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradNMEAParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ER60 NMEA datagram contains the following keys:</span>


<span class="sd">        type:         string == &#39;NME0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:     datetime.datetime object of NT date, assumed to be UTC</span>

<span class="sd">        nmea_string:  full (original) NMEA string</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw ER60 NMEA datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                             (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nmea_head_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$[A-Za-z]</span><span class="si">{5}</span><span class="s2">,&quot;</span><span class="p">)</span>  <span class="c1"># noqa</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)],</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;32s&quot;</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;NME&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the NMEA string provided in raw_string</span>

<span class="sd">        :param raw_string:  Raw NMEA string (i.e. &#39;$GPZDA,160012.71,11,03,2004,-1,00*7D&#39;)</span>
<span class="sd">        :type raw_string: str</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="c1"># Remove trailing \x00 from the PORT field for NME1, rest of the datagram identical to NME0</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>  <span class="c1"># noqa</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmea_head_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">][:</span><span class="mi">7</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_talker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_talker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span>

            <span class="c1"># Pad with more nulls to 4-byte word boundary if necessary</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">))</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">))</span>

            <span class="c1"># Convert to python string if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">tmp_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradRawParser" class="doc doc-heading">
            <code>SimradRawParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>Sample Data Datagram parser operates on dictionaries with the following keys:</p>
<pre><code>type:         string == 'RAW0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC

channel                         [short] Channel number
mode                            [short] 1 = Power only, 2 = Angle only 3 = Power &amp; Angle
transducer_depth                [float]
frequency                       [float]
transmit_power                  [float]
pulse_length                    [float]
bandwidth                       [float]
sample_interval                 [float]
sound_velocity                  [float]
absorption_coefficient          [float]
heave                           [float]
roll                            [float]
pitch                           [float]
temperature                     [float]
heading                         [float]
transmit_mode                   [short] 0 = Active, 1 = Passive, 2 = Test, -1 = Unknown
spare0                          [str]
offset                          [long]
count                           [long]

power                           [numpy array] Unconverted power values (if present)
angle                           [numpy array] Unconverted angle values (if present)
</code></pre>
<p>from_string(str):   parse a raw sample datagram
                    (with leading/trailing datagram size stripped)</p>
<p>to_string(dict):    Returns raw string (including leading/trailing size fields)
                    ready for writing to disk</p>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradRawParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample Data Datagram parser operates on dictionaries with the following keys:</span>

<span class="sd">        type:         string == &#39;RAW0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>

<span class="sd">        channel                         [short] Channel number</span>
<span class="sd">        mode                            [short] 1 = Power only, 2 = Angle only 3 = Power &amp; Angle</span>
<span class="sd">        transducer_depth                [float]</span>
<span class="sd">        frequency                       [float]</span>
<span class="sd">        transmit_power                  [float]</span>
<span class="sd">        pulse_length                    [float]</span>
<span class="sd">        bandwidth                       [float]</span>
<span class="sd">        sample_interval                 [float]</span>
<span class="sd">        sound_velocity                  [float]</span>
<span class="sd">        absorption_coefficient          [float]</span>
<span class="sd">        heave                           [float]</span>
<span class="sd">        roll                            [float]</span>
<span class="sd">        pitch                           [float]</span>
<span class="sd">        temperature                     [float]</span>
<span class="sd">        heading                         [float]</span>
<span class="sd">        transmit_mode                   [short] 0 = Active, 1 = Passive, 2 = Test, -1 = Unknown</span>
<span class="sd">        spare0                          [str]</span>
<span class="sd">        offset                          [long]</span>
<span class="sd">        count                           [long]</span>

<span class="sd">        power                           [numpy array] Unconverted power values (if present)</span>
<span class="sd">        angle                           [numpy array] Unconverted angle values (if present)</span>

<span class="sd">    from_string(str):   parse a raw sample datagram</span>
<span class="sd">                        (with leading/trailing datagram size stripped)</span>

<span class="sd">    to_string(dict):    Returns raw string (including leading/trailing size fields)</span>
<span class="sd">                        ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transducer_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transmit_power&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pulse_length&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;sample_interval&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;sound_velocity&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;absorption_coefficient&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heave&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;roll&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;heading&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;transmit_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare0&quot;</span><span class="p">,</span> <span class="s2">&quot;6s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare&quot;</span><span class="p">,</span> <span class="s2">&quot;2s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;128s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;spare&quot;</span><span class="p">,</span> <span class="s2">&quot;2s&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;RAW&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;unicode_escape&quot;</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span>  <span class="c1"># noqa</span>
                    <span class="p">)</span>
                    <span class="n">indx</span> <span class="o">+=</span> <span class="n">block_size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int8&quot;</span>  <span class="c1"># noqa</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>

        <span class="c1"># RAW3 and RAW4 have the same format, only Datatype Bit 0-1 not used in RAW4</span>
        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># result = 1j*Data[...,1]; result += Data[...,0]</span>

            <span class="c1">#  clean up the channel ID</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;channel_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#  set the initial block size and indx value.</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span>  <span class="c1"># noqa</span>
                    <span class="p">)</span>
                    <span class="n">indx</span> <span class="o">+=</span> <span class="n">block_size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b10</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int8&quot;</span>  <span class="c1"># noqa</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">indx</span> <span class="o">+=</span> <span class="n">block_size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1">#  determine the complex sample data type - this is contained in bits 2 and 3</span>
                <span class="c1">#  of the datatype &lt;short&gt; value. I&#39;m assuming the types are exclusive...</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex_dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span>
                <span class="n">type_bytes</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b1000</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex_dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
                    <span class="n">type_bytes</span> <span class="o">=</span> <span class="mi">8</span>

                <span class="c1">#  determine the number of complex samples</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>

                <span class="c1">#  unpack the complex samples</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_complex&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#  determine the block size</span>
                    <span class="n">block_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_complex&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">type_bytes</span>

                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                        <span class="n">raw_string</span><span class="p">[</span><span class="n">indx</span> <span class="p">:</span> <span class="n">indx</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">],</span>  <span class="c1"># noqa</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex_dtype&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span>
                    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_complex&quot;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex64&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;n_complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="p">[]))</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Data &#39;count&#39; = </span><span class="si">%d</span><span class="s2">, but contains </span><span class="si">%d</span><span class="s2"> power samples.  Ignoring power.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;angle&quot;</span><span class="p">,</span> <span class="p">[]))</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Data &#39;count&#39; = </span><span class="si">%d</span><span class="s2">, but contains </span><span class="si">%d</span><span class="s2"> angle samples.  Ignoring angle.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Data &#39;count&#39; = </span><span class="si">%d</span><span class="s2">, but mode == 0.  Setting count to 0&quot;</span><span class="p">,</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                    <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">h&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
                    <span class="n">datagram_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">:</span>
                    <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">H&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
                    <span class="n">datagram_contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="aalibrary.utils.sonar_checker.ek_raw_parsers.SimradXMLParser" class="doc doc-heading">
            <code>SimradXMLParser</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aalibrary.utils.sonar_checker.ek_raw_parsers._SimradDatagramParser">_SimradDatagramParser</span></code></p>


        <p>EK80 XML datagram contains the following keys:</p>
<pre><code>type:         string == 'XML0'
low_date:     long uint representing LSBytes of 64bit NT date
high_date:    long uint representing MSBytes of 64bit NT date
timestamp:    datetime.datetime object of NT date, assumed to be UTC
subtype:      string representing Simrad XML datagram type:
              configuration, environment, or parameter

[subtype]:    dict containing the data specific to the XML subtype.
</code></pre>
<p>The following methods are defined:</p>
<pre><code>from_string(str):    parse a raw EK80 XML datagram
                    (with leading/trailing datagram size stripped)

to_string():         Returns the datagram as a raw string
                     (including leading/trailing size fields)
                     ready for writing to disk
</code></pre>











              <details class="quote">
                <summary>Source code in <code>aalibrary/utils/sonar_checker/ek_raw_parsers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimradXMLParser</span><span class="p">(</span><span class="n">_SimradDatagramParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EK80 XML datagram contains the following keys:</span>


<span class="sd">        type:         string == &#39;XML0&#39;</span>
<span class="sd">        low_date:     long uint representing LSBytes of 64bit NT date</span>
<span class="sd">        high_date:    long uint representing MSBytes of 64bit NT date</span>
<span class="sd">        timestamp:    datetime.datetime object of NT date, assumed to be UTC</span>
<span class="sd">        subtype:      string representing Simrad XML datagram type:</span>
<span class="sd">                      configuration, environment, or parameter</span>

<span class="sd">        [subtype]:    dict containing the data specific to the XML subtype.</span>

<span class="sd">    The following methods are defined:</span>

<span class="sd">        from_string(str):    parse a raw EK80 XML datagram</span>
<span class="sd">                            (with leading/trailing datagram size stripped)</span>

<span class="sd">        to_string():         Returns the datagram as a raw string</span>
<span class="sd">                             (including leading/trailing size fields)</span>
<span class="sd">                             ready for writing to disk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#  define the XML parsing options - here we define dictionaries for various xml datagram</span>
    <span class="c1">#  types. When parsing that xml datagram, these dictionaries are used to inform the parser about</span>
    <span class="c1">#  type conversion, name wrangling, and delimiter. If a field is missing, the parser</span>
    <span class="c1">#  assumes no conversion: type will be string, default mangling, and that there is only 1</span>
    <span class="c1">#  element.</span>
    <span class="c1">#</span>
    <span class="c1">#  the dicts are in the form:</span>
    <span class="c1">#       &#39;XMLParamName&#39;:[converted type,&#39;fieldname&#39;, &#39;parse char&#39;]</span>
    <span class="c1">#</span>
    <span class="c1">#  For example: &#39;PulseDurationFM&#39;:[float,&#39;pulse_duration_fm&#39;,&#39;;&#39;]</span>
    <span class="c1">#</span>
    <span class="c1">#  will result in a return dictionary field named &#39;pulse_duration_fm&#39; that contains a list</span>
    <span class="c1">#  of float values parsed from a string that uses &#39;;&#39; to separate values. Empty strings</span>
    <span class="c1">#  for fieldname and/or parse char result in the default action for those parsing steps.</span>

    <span class="n">channel_parsing_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;MaxTxPowerTransceiver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;PulseDuration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;PulseDurationFM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;pulse_duration_fm&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SampleInterval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;ChannelID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;HWChannelConfiguration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;hw_channel_configuration&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">transceiver_parsing_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;TransceiverNumber&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;transceiver_version&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;IPAddress&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;ip_address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Impedance&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">transducer_parsing_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;SerialNumber&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;transducer_serial_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Frequency&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;transducer_frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;FrequencyMinimum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;transducer_frequency_minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;FrequencyMaximum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;transducer_frequency_maximum&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;BeamType&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;transducer_beam_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Gain&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SaCorrection&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;MaxTxPowerTransducer&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;EquivalentBeamAngle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;BeamWidthAlongship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;BeamWidthAthwartship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;AngleSensitivityAlongship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;AngleSensitivityAthwartship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;AngleOffsetAlongship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;AngleOffsetAthwartship&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;DirectivityDropAt2XBeamWidth&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">,</span>
            <span class="s2">&quot;directivity_drop_at_2x_beam_width&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;TransducerOffsetX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransducerOffsetY&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransducerOffsetZ&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransducerAlphaX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransducerAlphaY&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransducerAlphaZ&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">header_parsing_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;application_version&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]}</span>

    <span class="n">envxdcr_parsing_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SoundSpeed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;transducer_sound_speed&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]}</span>

    <span class="n">environment_parsing_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Acidity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Salinity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SoundSpeed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Latitude&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SoundVelocityProfile&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;DropKeelOffset&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;DropKeelOffsetIsManual&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;WaterLevelDraft&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;WaterLevelDraftIsManual&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">parameter_parsing_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ChannelID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;channel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;ChannelMode&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;PulseForm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Frequency&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;PulseDuration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SampleInterval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;TransmitPower&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Slope&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;4s&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;low_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;high_date&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)]}</span>
        <span class="n">_SimradDatagramParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;XML&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_unpack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the NMEA string provided in raw_string</span>

<span class="sd">        :param raw_string:  Raw NMEA string (i.e. &#39;$GPZDA,160012.71,11,03,2004,-1,00*7D&#39;)</span>
<span class="sd">        :type raw_string: str</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">dict_to_dict</span><span class="p">(</span><span class="n">xml_dict</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">parse_opts</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            dict_to_dict appends the ETree xml value dicts to a provided dictionary</span>
<span class="sd">            and along the way converts the key name to conform to the project&#39;s</span>
<span class="sd">            naming convention and optionally parses and or converts values as</span>
<span class="sd">            specified in the parse_opts dictionary.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xml_dict</span><span class="p">:</span>
                <span class="c1">#  check if we&#39;re parsing this key/value</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parse_opts</span><span class="p">:</span>
                    <span class="c1">#  try to parse the string</span>
                    <span class="k">if</span> <span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">xml_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="c1">#  bad or empty parse character(s) provided</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">xml_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1">#  no parse char provided - nothing to parse</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">xml_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="c1">#  try to convert to specified type</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="n">data</span><span class="p">)</span>

                    <span class="c1">#  and add the value to the provided dict</span>
                    <span class="k">if</span> <span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1">#  add using the specified key name</span>
                        <span class="n">data_dict</span><span class="p">[</span><span class="n">parse_opts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1">#  add using the default key name wrangling</span>
                        <span class="n">data_dict</span><span class="p">[</span><span class="n">camelcase2snakecase</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#  nothing to do with the value string</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">xml_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="c1">#  add the parameter to the provided dictionary</span>
                    <span class="n">data_dict</span><span class="p">[</span><span class="n">camelcase2snakecase</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">header_values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">),</span> <span class="n">raw_string</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt_to_unix</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;low_date&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;high_date&quot;</span><span class="p">]))</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bytes_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_read</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">xml_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xml_string</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>  <span class="c1"># noqa</span>
                    <span class="n">raw_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">header_size</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;ascii&quot;</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1">#  get the ElementTree element</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>

            <span class="c1">#  get the XML message type</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1">#  create the dictionary that contains the message data</span>
            <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1">#  parse it</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;configuration&quot;</span><span class="p">:</span>
                <span class="c1">#  parse the Transceiver section</span>
                <span class="k">for</span> <span class="n">tcvr</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">):</span>
                    <span class="c1">#  parse the Transceiver section</span>
                    <span class="n">tcvr_xml</span> <span class="o">=</span> <span class="n">tcvr</span><span class="o">.</span><span class="n">attrib</span>

                    <span class="c1">#  parse the Channel section -- this works with multiple channels</span>
                    <span class="c1">#  under 1 transceiver</span>
                    <span class="k">for</span> <span class="n">tcvr_ch</span> <span class="ow">in</span> <span class="n">tcvr</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Channel&quot;</span><span class="p">):</span>
                        <span class="n">tcvr_ch_xml</span> <span class="o">=</span> <span class="n">tcvr_ch</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="n">channel_id</span> <span class="o">=</span> <span class="n">tcvr_ch_xml</span><span class="p">[</span><span class="s2">&quot;ChannelID&quot;</span><span class="p">]</span>

                        <span class="c1">#  create the configuration dict for this channel</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                        <span class="c1">#  add the transceiver data to the config dict (this is</span>
                        <span class="c1">#  replicated for all channels)</span>
                        <span class="n">dict_to_dict</span><span class="p">(</span>
                            <span class="n">tcvr_xml</span><span class="p">,</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">transceiver_parsing_options</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="c1">#  add the general channel data to the config dict</span>
                        <span class="n">dict_to_dict</span><span class="p">(</span>
                            <span class="n">tcvr_ch_xml</span><span class="p">,</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">channel_parsing_options</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="c1">#  check if there are &gt;1 transducer under a single transceiver channel</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tcvr_ch</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found &gt;1 transducer under a single transceiver channel!&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># should only have 1 transducer</span>
                            <span class="n">tcvr_ch_xducer</span> <span class="o">=</span> <span class="n">tcvr_ch</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                                <span class="s2">&quot;Transducer&quot;</span>
                            <span class="p">)</span>  <span class="c1"># get Element of this xducer</span>
                            <span class="n">f_par</span> <span class="o">=</span> <span class="n">tcvr_ch_xducer</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;FrequencyPar&quot;</span><span class="p">)</span>
                            <span class="c1"># Save calibration parameters</span>
                            <span class="k">if</span> <span class="n">f_par</span><span class="p">:</span>
                                <span class="n">cal_par</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;Gain&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]),</span>
                                    <span class="s2">&quot;impedance&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;Impedance&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;Phase&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]),</span>
                                    <span class="s2">&quot;beamwidth_alongship&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;BeamWidthAlongship&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;beamwidth_athwartship&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;BeamWidthAthwartship&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;angle_offset_alongship&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;AngleOffsetAlongship&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;angle_offset_athwartship&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;AngleOffsetAthwartship&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_par</span><span class="p">]</span>
                                    <span class="p">),</span>
                                <span class="p">}</span>
                                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">][</span><span class="s2">&quot;calibration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal_par</span>
                            <span class="c1">#  add the transducer data to the config dict</span>
                            <span class="n">dict_to_dict</span><span class="p">(</span>
                                <span class="n">tcvr_ch_xducer</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span>
                                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">transducer_parsing_options</span><span class="p">,</span>
                            <span class="p">)</span>

                        <span class="c1"># get unique transceiver channel number stored in channel_id</span>
                        <span class="n">tcvr_ch_num</span> <span class="o">=</span> <span class="n">TCVR_CH_NUM_MATCHER</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">channel_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="c1"># parse the Transducers section from the root</span>
                        <span class="c1"># TODO Remove Transducers if doesn&#39;t exist</span>
                        <span class="n">xducer</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Transducers&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xducer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># built occurrence lookup table for transducer name</span>
                            <span class="n">xducer_name_list</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">xducer_ch</span> <span class="ow">in</span> <span class="n">xducer</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Transducer&quot;</span><span class="p">):</span>
                                <span class="n">xducer_name_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerName&quot;</span><span class="p">])</span>

                            <span class="c1"># find matching transducer for this channel_id</span>
                            <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">for</span> <span class="n">xducer_ch</span> <span class="ow">in</span> <span class="n">xducer</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Transducer&quot;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">match_found</span><span class="p">:</span>
                                    <span class="n">xducer_ch_xml</span> <span class="o">=</span> <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="n">match_name</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerName&quot;</span><span class="p">]</span>
                                        <span class="o">==</span> <span class="n">tcvr_ch_xducer</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerName&quot;</span><span class="p">]</span>
                                    <span class="p">)</span>
                                    <span class="k">if</span> <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerSerialNumber&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                        <span class="n">match_sn</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">match_sn</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerSerialNumber&quot;</span><span class="p">]</span>
                                            <span class="o">==</span> <span class="n">tcvr_ch_xducer</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;SerialNumber&quot;</span><span class="p">]</span>
                                        <span class="p">)</span>
                                    <span class="n">match_tcvr</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="n">tcvr_ch_num</span> <span class="ow">in</span> <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerCustomName&quot;</span><span class="p">]</span>
                                    <span class="p">)</span>

                                    <span class="c1"># if find match add the transducer mounting details</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">Counter</span><span class="p">(</span><span class="n">xducer_name_list</span><span class="p">)[</span>
                                            <span class="n">xducer_ch</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;TransducerName&quot;</span><span class="p">]</span>
                                        <span class="p">]</span>
                                        <span class="o">&gt;</span> <span class="mi">1</span>
                                    <span class="p">):</span>
                                        <span class="c1"># if more than one transducer has the same name</span>
                                        <span class="c1"># only check sn and transceiver unique number</span>
                                        <span class="n">match_found</span> <span class="o">=</span> <span class="n">match_sn</span> <span class="ow">or</span> <span class="n">match_tcvr</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">match_found</span> <span class="o">=</span> <span class="n">match_name</span> <span class="ow">or</span> <span class="n">match_sn</span> <span class="ow">or</span> <span class="n">match_tcvr</span>

                                    <span class="c1"># add transducer mounting details</span>
                                    <span class="k">if</span> <span class="n">match_found</span><span class="p">:</span>
                                        <span class="n">dict_to_dict</span><span class="p">(</span>
                                            <span class="n">xducer_ch_xml</span><span class="p">,</span>
                                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">transducer_parsing_options</span><span class="p">,</span>
                                        <span class="p">)</span>

                        <span class="c1">#  add the header data to the config dict</span>
                        <span class="n">h</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Header&quot;</span><span class="p">)</span>
                        <span class="n">dict_to_dict</span><span class="p">(</span>
                            <span class="n">h</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">][</span><span class="n">channel_id</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">header_parsing_options</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;parameter&quot;</span><span class="p">:</span>
                <span class="c1">#  parse the parameter XML datagram</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Channel&quot;</span><span class="p">):</span>
                    <span class="n">parm_xml</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="c1">#  add the data to the environment dict</span>
                    <span class="n">dict_to_dict</span><span class="p">(</span><span class="n">parm_xml</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_parsing_options</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;environment&quot;</span><span class="p">:</span>
                <span class="c1">#  parse the environment XML datagram</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Environment&quot;</span><span class="p">):</span>
                    <span class="n">env_xml</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="c1">#  add the data to the environment dict</span>
                    <span class="n">dict_to_dict</span><span class="p">(</span><span class="n">env_xml</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment_parsing_options</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;Transducer&quot;</span><span class="p">):</span>
                    <span class="n">transducer_xml</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="c1">#  add the data to the environment dict</span>
                    <span class="n">dict_to_dict</span><span class="p">(</span>
                        <span class="n">transducer_xml</span><span class="p">,</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">envxdcr_parsing_options</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;xml&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_string</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pack_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">to_CamelCase</span><span class="p">(</span><span class="n">xml_param</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            convert name from project&#39;s convention to CamelCase for converting back to</span>
<span class="sd">            XML to in Kongsberg&#39;s convention.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xml_param</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]))</span>
            <span class="n">param_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml_param</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                <span class="c1">#  check if we should insert an underscore</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">param_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">xml_param</span> <span class="o">=</span> <span class="n">xml_param</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">xml_param</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
            <span class="n">xml_param</span> <span class="o">=</span> <span class="n">xml_param</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">xml_param</span>

        <span class="n">datagram_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">datagram_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fields</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nmea_string&quot;</span><span class="p">]</span>

            <span class="c1"># Pad with more nulls to 4-byte word boundary if necessary</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">))</span>

            <span class="n">datagram_fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">))</span>

            <span class="c1"># Convert to python string if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">tmp_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

            <span class="n">datagram_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_string</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">datagram_fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">datagram_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.log" class="doc doc-heading">
            <code>log</code>


</h3>

    <div class="doc doc-contents ">










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="verbose(logfile=None, override=False) (aalibrary.utils.sonar_checker.log.verbose)" href="#aalibrary.utils.sonar_checker.log.verbose">verbose</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Set the verbosity for echopype print outs.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.log.verbose" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verbose</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the verbosity for echopype print outs.
If called it will output logs to terminal by default.</p>
<h6 id="aalibrary.utils.sonar_checker.log.verbose--parameters">Parameters</h6>
<p>logfile : str, optional
    Optional string path to the desired log file.
override: bool
    Boolean flag to override verbosity,
    which turns off verbosity if the value is <code>False</code>.
    Default is <code>False</code>.</p>
<h6 id="aalibrary.utils.sonar_checker.log.verbose--returns">Returns</h6>
<p>None</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/log.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verbose</span><span class="p">(</span><span class="n">logfile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the verbosity for echopype print outs.</span>
<span class="sd">    If called it will output logs to terminal by default.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    logfile : str, optional</span>
<span class="sd">        Optional string path to the desired log file.</span>
<span class="sd">    override: bool</span>
<span class="sd">        Boolean flag to override verbosity,</span>
<span class="sd">        which turns off verbosity if the value is `False`.</span>
<span class="sd">        Default is `False`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">override</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;override argument must be a boolean!&quot;</span><span class="p">)</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the package name</span>
    <span class="n">loggers</span> <span class="o">=</span> <span class="n">_get_all_loggers</span><span class="p">()</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">override</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">_set_verbose</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">loggers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LOGFILE_HANDLE_NAME</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
                    <span class="c1"># Remove log file handler if it exists</span>
                    <span class="n">handler</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">h</span><span class="p">:</span> <span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">LOGFILE_HANDLE_NAME</span><span class="p">,</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">LOGFILE_HANDLE_NAME</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
                <span class="c1"># Only add the logfile handler if it doesn&#39;t exist</span>
                <span class="n">_set_logfile</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">logfile</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Prevents multiple handler from propagating messages</span>
                <span class="c1"># this way there are no duplicate line in logfile</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.misc" class="doc doc-heading">
            <code>misc</code>


</h3>

    <div class="doc doc-contents ">










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="camelcase2snakecase(camel_case_str) (aalibrary.utils.sonar_checker.misc.camelcase2snakecase)" href="#aalibrary.utils.sonar_checker.misc.camelcase2snakecase">camelcase2snakecase</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert string from CamelCase to snake_case</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="depth_from_pressure(pressure, latitude=30.0, atm_pres_surf=0.0) (aalibrary.utils.sonar_checker.misc.depth_from_pressure)" href="#aalibrary.utils.sonar_checker.misc.depth_from_pressure">depth_from_pressure</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert pressure to depth using UNESCO 1983 algorithm.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.misc.camelcase2snakecase" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">camelcase2snakecase</span><span class="p">(</span><span class="n">camel_case_str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Convert string from CamelCase to snake_case
e.g. CamelCase becomes camel_case.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/misc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">camelcase2snakecase</span><span class="p">(</span><span class="n">camel_case_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert string from CamelCase to snake_case</span>
<span class="sd">    e.g. CamelCase becomes camel_case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">camel_case_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]))</span>
    <span class="n">param_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">camel_case_str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
        <span class="c1">#  check if we should insert an underscore</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">param_len</span><span class="p">:</span>
            <span class="n">camel_case_str</span> <span class="o">=</span> <span class="n">camel_case_str</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">camel_case_str</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">camel_case_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.misc.depth_from_pressure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">depth_from_pressure</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">atm_pres_surf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Convert pressure to depth using UNESCO 1983 algorithm.</p>
<p>UNESCO. 1983. Algorithms for computation of fundamental properties of seawater (Pressure to
Depth conversion, pages 25-27). Prepared by Fofonoff, N.P. and Millard, R.C. UNESCO technical
papers in marine science, 44. http://unesdoc.unesco.org/images/0005/000598/059832eb.pdf</p>
<h6 id="aalibrary.utils.sonar_checker.misc.depth_from_pressure--parameters">Parameters</h6>
<p>pressure : Union[float, FloatSequence]
    Pressure in dbar
latitude : Union[float, FloatSequence], default=30.0
    Latitude in decimal degrees.
atm_pres_surf : Union[float, FloatSequence], default=0.0
    Atmospheric pressure at the surface in dbar.
    Use the default 0.0 value if pressure is corrected to be 0 at the surface.
    Otherwise, enter a correction for pressure due to air, sea ice and any other
    medium that may be present</p>
<h6 id="aalibrary.utils.sonar_checker.misc.depth_from_pressure--returns">Returns</h6>
<p>depth : NDArray[float]
    Depth in meters</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/misc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">depth_from_pressure</span><span class="p">(</span>
    <span class="n">pressure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">FloatSequence</span><span class="p">],</span>
    <span class="n">latitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">FloatSequence</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
    <span class="n">atm_pres_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">FloatSequence</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert pressure to depth using UNESCO 1983 algorithm.</span>

<span class="sd">    UNESCO. 1983. Algorithms for computation of fundamental properties of seawater (Pressure to</span>
<span class="sd">    Depth conversion, pages 25-27). Prepared by Fofonoff, N.P. and Millard, R.C. UNESCO technical</span>
<span class="sd">    papers in marine science, 44. http://unesdoc.unesco.org/images/0005/000598/059832eb.pdf</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pressure : Union[float, FloatSequence]</span>
<span class="sd">        Pressure in dbar</span>
<span class="sd">    latitude : Union[float, FloatSequence], default=30.0</span>
<span class="sd">        Latitude in decimal degrees.</span>
<span class="sd">    atm_pres_surf : Union[float, FloatSequence], default=0.0</span>
<span class="sd">        Atmospheric pressure at the surface in dbar.</span>
<span class="sd">        Use the default 0.0 value if pressure is corrected to be 0 at the surface.</span>
<span class="sd">        Otherwise, enter a correction for pressure due to air, sea ice and any other</span>
<span class="sd">        medium that may be present</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    depth : NDArray[float]</span>
<span class="sd">        Depth in meters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_as_nparray_check</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">check_vs_pressure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to np.array if not already a np.array.</span>
<span class="sd">        Ensure latitude and atm_pres_surf are of the same size and shape as</span>
<span class="sd">        pressure if they are not scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">check_vs_pressure</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v_array</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v_array</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">pressure</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="n">v_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">pressure</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sequence shape or size does not match pressure&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v_array</span>

    <span class="n">pressure</span> <span class="o">=</span> <span class="n">_as_nparray_check</span><span class="p">(</span><span class="n">pressure</span><span class="p">)</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">_as_nparray_check</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">check_vs_pressure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">atm_pres_surf</span> <span class="o">=</span> <span class="n">_as_nparray_check</span><span class="p">(</span><span class="n">atm_pres_surf</span><span class="p">,</span> <span class="n">check_vs_pressure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Constants</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">9.780318</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mf">9.72659</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2512e-5</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="mf">2.279e-10</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.82e-15</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="mf">5.2788e-3</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="mf">2.36e-5</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="mf">1.092e-6</span>

    <span class="c1"># Calculate depth</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">-</span> <span class="n">atm_pres_surf</span>
    <span class="n">depth_w_g</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">pressure</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">pressure</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">pressure</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">c4</span> <span class="o">*</span> <span class="n">pressure</span><span class="o">**</span><span class="mi">4</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span>
    <span class="n">gravity</span> <span class="o">=</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">k3</span> <span class="o">*</span> <span class="n">pressure</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">depth_w_g</span> <span class="o">/</span> <span class="n">gravity</span>
    <span class="k">return</span> <span class="n">depth</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="aalibrary.utils.sonar_checker.sonar_checker" class="doc doc-heading">
            <code>sonar_checker</code>


</h3>

    <div class="doc doc-contents ">










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_AD2CP(raw_file) (aalibrary.utils.sonar_checker.sonar_checker.is_AD2CP)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_AD2CP">is_AD2CP</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if the provided file has a .ad2cp extension.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_AZFP(raw_file) (aalibrary.utils.sonar_checker.sonar_checker.is_AZFP)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP">is_AZFP</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if the specified XML file contains an <InstrumentType> with string="AZFP".</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_AZFP6(raw_file) (aalibrary.utils.sonar_checker.sonar_checker.is_AZFP6)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_AZFP6">is_AZFP6</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if the provided file has a .azfp extension.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_EK60(raw_file, storage_options) (aalibrary.utils.sonar_checker.sonar_checker.is_EK60)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK60">is_EK60</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if a raw data file is from Simrad EK60 echosounder.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_EK80(raw_file, storage_options) (aalibrary.utils.sonar_checker.sonar_checker.is_EK80)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_EK80">is_EK80</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if a raw data file is from Simrad EK80 echosounder.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="is_ER60(raw_file, storage_options) (aalibrary.utils.sonar_checker.sonar_checker.is_ER60)" href="#aalibrary.utils.sonar_checker.sonar_checker.is_ER60">is_ER60</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Check if a raw data file is from Simrad EK60 echosounder.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_AD2CP" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_AD2CP</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if the provided file has a .ad2cp extension.</p>
<p>Parameters:
raw_file (str): The name of the file to check.</p>
<p>Returns:
bool: True if the file has a .ad2cp extension, False otherwise.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_AD2CP</span><span class="p">(</span><span class="n">raw_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the provided file has a .ad2cp extension.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    raw_file (str): The name of the file to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if the file has a .ad2cp extension, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if the input is a string</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Return False if the input is not a string</span>

    <span class="c1"># Use the str.lower() method to check for the .ad2cp extension</span>
    <span class="n">has_ad2cp_extension</span> <span class="o">=</span> <span class="n">raw_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ad2cp&quot;</span><span class="p">)</span>

    <span class="c1"># Return the result of the check</span>
    <span class="k">return</span> <span class="n">has_ad2cp_extension</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_AZFP" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_AZFP</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if the specified XML file contains an <InstrumentType> with string="AZFP".</p>
<p>Parameters:
raw_file (str): The base name of the XML file (with or without extension).</p>
<p>Returns:
bool: True if <InstrumentType> with string="AZFP" is found, False otherwise.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_AZFP</span><span class="p">(</span><span class="n">raw_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the specified XML file contains an &lt;InstrumentType&gt; with string=&quot;AZFP&quot;.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    raw_file (str): The base name of the XML file (with or without extension).</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if &lt;InstrumentType&gt; with string=&quot;AZFP&quot; is found, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if the filename ends with .xml or .XML, and strip the extension if it does</span>
    <span class="n">base_filename</span> <span class="o">=</span> <span class="n">raw_file</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.XML&quot;</span><span class="p">)</span>

    <span class="c1"># Create a list of possible filenames with both extensions</span>
    <span class="n">possible_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">.xml&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">.XML&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">full_filename</span> <span class="ow">in</span> <span class="n">possible_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">full_filename</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Parse the XML file</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">full_filename</span><span class="p">)</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

                <span class="c1"># Check for &lt;InstrumentType&gt; elements</span>
                <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//InstrumentType&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">instrument</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;AZFP&quot;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">ET</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing the XML file: </span><span class="si">{</span><span class="n">full_filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_AZFP6" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_AZFP6</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if the provided file has a .azfp extension.</p>
<p>Parameters:
raw_file (str): The name of the file to check.</p>
<p>Returns:
bool: True if the file has a .azfp extension, False otherwise.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_AZFP6</span><span class="p">(</span><span class="n">raw_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the provided file has a .azfp extension.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    raw_file (str): The name of the file to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if the file has a .azfp extension, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if the input is a string</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Return False if the input is not a string</span>

    <span class="c1"># Use the str.lower() method to check for the .azfp extension</span>
    <span class="n">has_azfp_extension</span> <span class="o">=</span> <span class="n">raw_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.azfp&quot;</span><span class="p">)</span>

    <span class="c1"># Return the result of the check</span>
    <span class="k">return</span> <span class="n">has_azfp_extension</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_EK60" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_EK60</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a raw data file is from Simrad EK60 echosounder.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_EK60</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a raw data file is from Simrad EK60 echosounder.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">RawSimradFile</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">config_datagram</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span>
            <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;[ns]&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Return True if the sounder name matches &quot;EK60&quot;</span>
            <span class="k">return</span> <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;sounder_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;ER60&quot;</span><span class="p">,</span> <span class="s2">&quot;EK60&quot;</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_EK80" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_EK80</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a raw data file is from Simrad EK80 echosounder.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_EK80</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a raw data file is from Simrad EK80 echosounder.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">RawSimradFile</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">config_datagram</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span>
            <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;[ns]&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Return True if &quot;configuration&quot; exists in config_datagram</span>
        <span class="k">return</span> <span class="s2">&quot;configuration&quot;</span> <span class="ow">in</span> <span class="n">config_datagram</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="aalibrary.utils.sonar_checker.sonar_checker.is_ER60" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_ER60</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a raw data file is from Simrad EK60 echosounder.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/sonar_checker/sonar_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_ER60</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a raw data file is from Simrad EK60 echosounder.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">RawSimradFile</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">config_datagram</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span>
            <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;[ns]&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Return True if the sounder name matches &quot;ER60&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config_datagram</span><span class="p">[</span><span class="s2">&quot;sounder_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;ER60&quot;</span><span class="p">,</span> <span class="s2">&quot;EK60&quot;</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="aalibrary.utils.timings" class="doc doc-heading">
            <code>timings</code>


</h2>

    <div class="doc doc-contents ">

        <p>"This script deals with the times associated with ingesting/preprocessing
data from various sources. It works as follows:
* A large file (usually 1 GB) is selected to repeatedly be downloaded and
    uploaded to a GCP bucket.
* Download and upload times are recorded for each of these n iterations.
* The average of these times are presented.</p>










<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="time_ingestion_and_upload_from_ncei(n=10, ncei_file_url='https://noaa-wcsd-pds.s3.amazonaws.com/data/raw/Reuben_Lasker/RL2107/EK80/2107RL_CW-D20210813-T220732.raw', ncei_bucket='noaa-wcsd-pds', download_location='./') (aalibrary.utils.timings.time_ingestion_and_upload_from_ncei)" href="#aalibrary.utils.timings.time_ingestion_and_upload_from_ncei">time_ingestion_and_upload_from_ncei</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Used for timing the ingestion from the NCEI AWS S3 bucket.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aalibrary.utils.timings.time_ingestion_and_upload_from_ncei" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time_ingestion_and_upload_from_ncei</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncei_file_url</span><span class="o">=</span><span class="s1">&#39;https://noaa-wcsd-pds.s3.amazonaws.com/data/raw/Reuben_Lasker/RL2107/EK80/2107RL_CW-D20210813-T220732.raw&#39;</span><span class="p">,</span> <span class="n">ncei_bucket</span><span class="o">=</span><span class="s1">&#39;noaa-wcsd-pds&#39;</span><span class="p">,</span> <span class="n">download_location</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Used for timing the ingestion from the NCEI AWS S3 bucket.</p>


            <details class="quote">
              <summary>Source code in <code>aalibrary/utils/timings.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">time_ingestion_and_upload_from_ncei</span><span class="p">(</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">ncei_file_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;https://noaa-wcsd-pds.s3.amazonaws.com/data/raw/&quot;</span>
        <span class="s2">&quot;Reuben_Lasker/RL2107/EK80/&quot;</span>
        <span class="s2">&quot;2107RL_CW-D20210813-T220732.raw&quot;</span>
    <span class="p">),</span>
    <span class="n">ncei_bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-wcsd-pds&quot;</span><span class="p">,</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used for timing the ingestion from the NCEI AWS S3 bucket.&quot;&quot;&quot;</span>

    <span class="n">download_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upload_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_file_name_from_url</span><span class="p">(</span><span class="n">ncei_file_url</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ingestion</span><span class="o">.</span><span class="n">download_single_file_from_aws</span><span class="p">(</span>
            <span class="n">file_url</span><span class="o">=</span><span class="n">ncei_file_url</span><span class="p">,</span>
            <span class="n">download_location</span><span class="o">=</span><span class="n">download_location</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Downloading took </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">That&#39;s </span><span class="si">{</span><span class="mi">1000</span><span class="o">/</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s2"> mb/sec.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Uploading file to cloud storage&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">cloud_utils</span><span class="o">.</span><span class="n">upload_file_to_gcp_bucket</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">blob_file_path</span><span class="o">=</span><span class="s2">&quot;timing_test_raw_upload.raw&quot;</span><span class="p">,</span>
            <span class="n">local_file_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Uploading took </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">That&#39;s </span><span class="si">{</span><span class="mi">1000</span><span class="o">/</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s2"> mb/sec.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;Average download time for this file:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">download_times</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">download_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;Average upload time for this file:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">upload_times</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">upload_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>